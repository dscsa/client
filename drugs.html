<template>
  <require from='./elems/md-table'></require>
  <require from='./elems/md-shadow'></require>
  <require from='./elems/md-drawer'></require>
  <require from="./elems/md-input"></require>
  <require from="./elems/md-select"></require>
  <require from="./elems/md-button"></require>
  <md-drawer>
    <md-input value.bind="filter" style="padding:0 8px; width:auto">Filter Drugs</md-input>
    <md-select
      options.bind="['', 'Retail', 'Wholesale', 'Name', 'Image']"
      style="padding:0 8px;">
      Empty Field
    </md-select>
    <div style="margin:0 auto">
      <md-button raised color>Import CSV</md-button>
      <md-button raised
        click.delegate="add()">
        Add Drug
      </md-button>
    </div>
  </md-drawer>
  <section class="mdl-grid">
    <div md-shadow="2" class="mdl-card mdl-cell mdl-cell--4-col">
      <div class="mdl-card__title mdl-grid" style="margin-left:0">
        <div class="mdl-card__title-text mdl-cell mdl-cell--12-col">
          ${ drug.name ? drug.name+' '+drug.strength : 'Drug Information'}
        </div>
        <div
          class="mdl-cell mdl-cell--12-col"
          style="margin-top:-8px;">
          ${drug.form || 'New drug'}
        </div>
        <div style="font-size:13px;margin:0 0 -15px 8px;">
          UPC: ${ "3"+(drug._id.replace('-', '')+"***********").slice(0, 11) }, NDC9: ${ ("00000"+drug._id.split('-')[0]).slice(-5)+("0000"+drug._id.split('-')[1]).slice(-4) }
        </div>
      </div>
      <div
        class="mdl-card__supporting-text"
        focusout.delegate="save($event, $this)"
        ref="$this"
        style="font-size:16px">
        <md-input
          style="width:100%"
          value.bind="drug._id"
          disabled.bind="drug._rev"
          pattern="\d{4}-\d{4}|\d{5}-\d{3}|\d{5}-\d{4}">
          NDC Product Code
        </md-input>
        <md-input
          style="width:100%"
          value.bind="drug.name">
          Drug Name
        </md-input>
        <md-input
          style="width:49%"
          value.bind="drug.strength">
          Strength
        </md-input>
        <md-select
          style="width:49%"
          value.bind="drug.form"
          options.bind="['', 'Tablet', 'Capsule', 'Injection', 'Patch']">
          Form
        </md-select>
        <md-input
          style="width:100%"
          value.bind="drug.brand">
          Brand Name
        </md-input>
        <md-input
          style="width:100%"
          value.bind="drug.labeler">
          Labeler
        </md-input>
        <md-input
          value.bind="drug[priceType].price"
          type="number"
          step=".01"
          style="width:49%">
          Price
        </md-input>
        <md-select
          style="width:49%"
          value.bind="priceType"
          options.bind="['retail', 'wholesale']">
        </md-select>
        <md-input
          value.bind="drug.image"
          focusout.delegate="save($event, $this)"
          ref="$this"
          style="width:100%; font-size:9px">
          Image
        </md-input>
        <img
          style="width:100%; margin:-10px 0 10px 0"
          if.bind="drug.image"
          src.bind="drug.image">
        <md-button color="accent" raised
          style="width:100%"
          click.delegate="delete()">
          Delete Drug
        </md-button>
      </div>
    </div>
    <div md-shadow="2" class="mdl-card mdl-cell mdl-cell--8-col">
      <table md-table style="margin:0 16px; width:calc(100% - 32px)">
        <thead>
          <tr>
            <th class="mdl-data-table__cell--non-numeric">Drug</th>
            <th>Strength</th>
            <th class="mdl-data-table__cell--non-numeric">Form</th>
            <th class="mdl-data-table__cell--non-numeric">NDC</th>
            <th class="mdl-data-table__cell--non-numeric">Price</th>
          </tr>
        </thead>
        <tr repeat.for="drug of drugs | filter:filter" click.delegate="$parent.select(drug)" class="${ drug._id == $parent.drug._id ? 'is-selected' : ''}">
          <td class="mdl-data-table__cell--non-numeric">
            ${ drug.name } ${ drug.brand ? '('+drug.brand+')' : ''}
          </td>
          <td>
            ${ drug.strength }
          </td>
          <td class="mdl-data-table__cell--non-numeric">
            ${ drug.form }
          </td>
          <td class="mdl-data-table__cell--non-numeric">
            ${ drug._id }
          </td>
          <td class="mdl-data-table__cell--non-numeric">
            ${ drug.wholesale.price | price } / ${ drug.retail.price | price }
          </td>
        </tr>
      </table>
    </div>
  </section>
</template>
