<template>
  <require from='./elems/md-shadow'></require>
  <require from='./elems/md-drawer'></require>
  <require from='./elems/md-table'></require>
  <require from="./elems/md-input"></require>
  <require from="./elems/md-select"></require>
  <require from="./elems/md-button"></require>
  <require from="./elems/md-switch"></require>
  <require from="./elems/md-snackbar"></require>
  <md-drawer>
    <md-input value.bind="filter" style="padding:0 8px;">Filter Inventory</md-input>
    <md-select
      value.bind="to"
      options.bind="['', 'All Ordered', 'Not Ordered', 'TLC', 'SET', 'BHP']"
      style="padding:0 8px;">
      Requested by
    </md-select>
    <div style="margin:0 auto">
      <md-button raised>Export</md-button>
    </div>
  </md-drawer>
  <section class="mdl-grid au-animate">
    <div md-shadow="2" class="mdl-card mdl-cell mdl-cell--4-col full-height"> <!-- ${ !repack || 'background:rgba(0,88,123,.3)' } -->
      <div
        class="mdl-card__supporting-text"
        style="font-size:13px;">
        <img style="width:100%; padding-bottom:8px" if.bind="group.image" src.bind="group.image">
        <div repeat.for="source of group.sources"   input.delegate="saveTransaction(source) & debounce:1000">
          <div style="display:inline-block; width:calc(100% - 90px)">
            <a if.bind="source.history[0].transaction._id" href.bind="'/#/records/'+source.history[0].transaction._id">${source.history[0].transaction._id}</a>
            ${ source.history[0].transaction._id ? '' : session.account.name }
            <a if.bind="!mode" style="float:right">
              <i class="material-icons" style="font-size:18px; vertical-align:text-top; padding-right:5px">print</i>
            </a>
          </div>
          <span style="white-space:nowrap;">
            <md-input
              disabled.bind="mode"
              pattern="(0?[1-9]|1[012])/\d{2}"
              style="width:40px"
              value.bind="source.exp.from | date"
              placeholder="Exp">
            </md-input>
            <md-input
              if.bind=" ! mode"
              type="number"
              style="width:40px"
              value.bind="source.qty.from"
              input.trigger="sumGroup()"
              placeholder="Qty">
            </md-input>
            <md-input
              if.bind="mode"
              type="number"
              style="width:40px"
              value.bind="repack[$index]"
              input.delegate="sumRepack()"
              placeholder="Qty"
              max.bind="source.qty.from">
            </md-input>
          </span>
        </div>
      </div>
      <div class="mdl-card__actions mdl-grid">
        <md-switch
          checked.one-way="mode"
          click.delegate="toggleRepack()"
          style="flex:1; align-self:flex-end">
        </md-switch>
        <md-button
          color raised
          if.bind="mode"
          disabled.bind="group.sources.length < 2"
          click.delegate="repackage()"
          style="width:140px">
          Repackage ${ repack.total }
        </md-button>
      </div>
    </div>
    <div md-shadow="2" class="mdl-card mdl-cell mdl-cell--8-col full-height"> <!-- ${ !repack || 'background:rgba(0,88,123,.3)' } -->
      <table md-table style="margin:8px 16px; width:calc(100% - 32px)">
        <thead>
          <tr>
            <th class="mdl-data-table__cell--non-numeric">Drug</th>
            <th class="mdl-data-table__cell--non-numeric">Ndc</th>
            <th>Items</th>
            <th>Qty</th>
          </tr>
        </thead>
        <tr repeat.for="group of groups | filter:filter" click.delegate="select(group)" class="${ $parent.group != group || 'is-selected'}">
          <td style="text-align:left; white-space: normal;">
            ${ group.sources[0] | drugName }
          </td>
          <td class="mdl-data-table__cell--non-numeric">
            ${ group.sources[0].drug._id }
          </td>
          <td>${ group.sources.length }</td>
          <td>${ group.total}</td>
        </tr>
      </table>
    </div>
    <md-snackbar ref="snackbar"></md-snackbar>
  </section>
</template>
