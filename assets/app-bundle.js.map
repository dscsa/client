{"version":3,"sources":["environment.js","resources/helpers.js","resources/value-converters.js","libs/csv.js","libs/environment.js","libs/pouch.js","elems/form.js","elems/md-autocomplete.js","elems/md-button.js","elems/md-checkbox.js","elems/md-drawer.js","elems/md-input.js","elems/md-loading.js","elems/md-menu.js","elems/md-select.js","elems/md-shadow.js","elems/md-snackbar.js","elems/md-switch.js","elems/md-table.js","views/account.js","views/drugs.js","views/index.js","views/inventory.js","views/join.js","views/login.js","views/public.js","views/records.js","views/routes.js","views/shipments.js","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-autocomplete.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-button.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-checkbox.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-drawer.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-input.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-loading.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-menu.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-select.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-snackbar.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/elems/md-switch.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/account.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/drugs.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/index.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/inventory.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/join.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/login.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/public.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/records.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/routes.html","/Users/akircher/Documents/Node/dscsa-repo/node_modules/client/src/views/shipments.html"],"names":["debug","testing","expShortcuts","qtyShortcuts","incrementBin","saveTransaction","scrollSelect","focusInput","toggleDrawer","drugSearch","parseUserDate","toJsonDate","waitForDrugsToIndex","canActivate","$event","$index","which","clearIfAsterick","transaction","location","slice","call","shiftKey","target","value","_saveTransaction","Promise","resolve","then","db","put","catch","snackbar","error","err","curr","list","cb","index","indexOf","last","length","selector","fallback","elem","document","querySelector","disabled","focus","console","log","drawer","firstChild","click","search","generic","clearCache","start","Date","now","terms","toLowerCase","replace","split","startsWith","_term","regex","RegExp","join","_drugs","drugs","filter","test","drug","query","range","map","addPkgCode","term","pkg","ndc9","upc","match","startkey","endkey","include_docs","res","rows","row","doc","ndc","all","deduped","results","_id","Object","keys","key","_savingDrug","trim","_search","date","year","pop","month","shift","setDate","toJSON","drugIsIndexed","get","drugsIndexed","placeholder","_","next","router","user","session","loggedIn","account","navigation","route","isVisible","config","roles","navModel","nav","currentInstruction","jsonValueConverter","toView","object","JSON","stringify","numberValueConverter","fromView","str","upperCaseValueConverter","toUpperCase","shipmentFilterValueConverter","shipments","shipment","from","name","to","tracking","status","drugFilterValueConverter","userFilterValueConverter","users","first","valueValueConverter","transactions","decimals","trigger","Array","isArray","reduce","total","price","qty","goodrx","nadac","toFixed","boldValueConverter","text","bold","dateValueConverter","model","view","includes","add","sub","toArrayValueConverter","obj","sort","arr","reverse","val","inventoryFilterValueConverter","isRepacked","ndcFilter","expFilter","repackFilter","formFilter","exp","form","repack","isChecked","count","csv","fromJSON","Db","pouchdbClient","FormCustomAttribute","Element","element","change","bind","inputElement","formElement","checkValidity","setAttribute","removeAttribute","attached","closest","addEventListener","setTimeout","MdAutocompleteCustomElement","defaultBindingMode","twoWay","toggleResults","showResults","MdButtonCustomElement","stopPropagation","disabledChanged","button","input","class","classList","color","fab","style","height","width","parentElement","tagName","padding","MdCheckboxCustomElement","tabindex","tabIndex","e","stopPropogation","checkedChanged","checked","label","MaterialCheckbox","checkToggleState","checkDisabled","componentHandler","upgradeAllRegistered","createElement","MdDrawerCustomElement","autofocus","hasAttribute","appendChild","header","parentNode","insertBefore","nextSibling","display","detached","children","removeChild","MdInputCustomElement","valueChanged","div","MaterialTextfield","checkDirty","upgradeElement","remove","input_","MdLoadingCustomElement","MaterialProgress","setProgress","Math","min","MdMenuCustomElement","observer","id","stopImmediatePropagation","setDisabled","li","getObserver","subscribe","querySelectorAll","MdSelectCustomElement","MdShadowCustomAttribute","getAttribute","MdSnackbarCustomElement","show","opts","message","timeout","MaterialSnackbar","showSnackbar","msg","MdSwitchCustomElement","MaterialSwitch","MdTableCustomAttribute","border","selectable","checkboxes","i","activate","allDocs","accounts","selectUser","saveUser","addUser","unshift","post","reason","deleteUser","splice","authorize","authorized","method","logout","disableLogout","delete","navigate","trace","scrollDrugs","deactivate","removeEventListener","params","ordered","selectDrug","selectDrawer","scrollGroups","group","groups","selectGroup","autoselectDrug","inventory","autoselectGroup","generics","strength","url","push","order","undefined","saveOrder","exportCSV","importCSV","capitalize","l","$file","files","errs","chain","brand","image","labeler","v","_err","addGeneric","removeGeneric","forms","dispatchEvent","Event","addDrug","_rev","rev","errors","saveDrug","deleteDrug","configure","aurelia","warnings","use","standardConfiguration","plugin","globalResources","a","setRoot","limit","size","reset","newURL","allChecked","setTransactions","window","pending","sortTransactions","createdAt","selectTerm","scrollTerms","b","aExp","bExp","aQty","bQty","aBin","bBin","aPack","bPack","checkTransaction","checkAllTransactions","signalFilter","selectPending","pendingAt","type","assign","updateNextOfSelected","updateFn","unpendInventory","pendInventory","selectedTransactions","dispenseInventory","dispensed","repackInventory","vials","verifiedAt","pendingIndex","excess","win","open","write","repeat","print","close","setRepackVials","floor","openMenu","binShortcuts","parse","http","license","street","city","state","zip","phone","password","loading","resources","progress","syncing","login","accumulate","selectAccount","records","history","days","scroll","recordTypes","group_level","months","collate","rxs","selectMonth","concat","selectDay","setHours","selectTransaction","k","o","pad","word","href","App","configureRouter","routes","title","moduleId","stati","expShortcutsKeydown","qtyShortcutsKeydown","senderAccounts","shipmentsReceived","descending","selected","accountRef","setStatus","role","selectShipment","emptyShipment","setUrl","setShipment","shipmentId","attachment","diffs","setCheckboxes","prev","swapRole","saveShipment","moveTransactionsToShipment","createShipment","expShortcutsInput","autoCheck","qtyShortcutsInput","removeTransactionIfQty0","doneeDelete","donorDelete","getLocation","getOrder","defaultLocation","_location","setLocation","aboveMinQty","defaultQty","minQty","aboveMinExp","minDays","belowMaxInventory","newInventory","maxInventory","isNaN","isWanted","setDestroyedMessage","destroyedMessage","clearDestroyedMessage","clearTimeout","verifiedMessage","manualCheck","moveItemsButton","offsetParent","toggleSelectedCheck","toggleVerifiedCheck","autocompleteShortcuts","addTransaction","isPharMerica","parsed"],"mappings":"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","file":"app-bundle.js","sourcesContent":["export default {\n  debug: true,\n  testing: true\n};\n","\nexport function expShortcuts($event, $index) {\n  //Enter should focus on quantity\n  if ($event.which == 13)\n    return this.focusInput(`#qty_${$index}`)\n\n  return true\n}\n\nexport function qtyShortcuts($event, $index) {\n  //Enter should focus on rx_input, unless it is hidden\n  if ($event.which == 13)\n    return this.focusInput(`#bin_${$index}`, `md-autocomplete`)\n\n  return clearIfAsterick($event)\n}\n\nexport function incrementBin($event, transaction) {\n  if ($event.which == 107 || $event.which == 187) { // + key on numpad, keyboard\n    transaction.location = transaction.location[0]+(+transaction.location.slice(1)+1)\n    saveTransaction.call(this, transaction)\n    return false //don't actually add the +\n  }\n\n  if ($event.which == 109 || $event.which == 189) {// - key on numpad, keyboard\n    transaction.location = transaction.location[0]+(+transaction.location.slice(1)-1)\n    saveTransaction.call(this, transaction)\n    return false //don't actually add the -\n  }\n\n  return clearIfAsterick($event)\n}\n\nfunction clearIfAsterick($event) {\n  return $event.which == 106 || ($event.shiftKey && $event.which == 56) ? $event.target.value = \"\" : true\n}\n\nexport function saveTransaction(transaction) {\n  return this._saveTransaction = Promise.resolve(this._saveTransaction).then(_ => {\n    return this.db.transaction.put(transaction)\n  }).catch(err => {\n    delete this._saveTransaction //otherwise subsequent saves will keep showing same error\n    //throw to continue to propogate error if our other code wants to catch\n    throw this.snackbar.error(err)\n  })\n}\n\n//Callback must take the selected item as its first argument\nexport function scrollSelect($event, curr, list = [], cb) {\n\n  let index = list.indexOf(curr)\n  let last  = list.length - 1\n\n  if ($event.which == 38) //Keyup\n    cb.call(this, list[index > 0 ? index - 1 : last])\n\n  if ($event.which == 40) //keydown\n    cb.call(this, list[index < last ? index+1 : 0])\n}\n\nexport function focusInput(selector, fallback) {\n  let elem = document.querySelector(`${selector} input`)\n\n  if (elem && ! elem.disabled)\n    elem.focus()\n  else if (fallback)\n    document.querySelector(`${fallback} input`).focus()\n  else\n    console.log(`Cannot find ${selector} input`)\n\n  return false\n}\n\nexport function toggleDrawer() {\n  let drawer = document.querySelector('.mdl-layout__header')\n  drawer && drawer.firstChild.click() //view might not be attached yet meaning selector is null\n}\n\n\nlet search = {\n  generic(generic, clearCache) {\n    const start = Date.now()\n    const terms = generic.toLowerCase().replace('.', '\\\\.').split(/, |[, ]/g)\n\n    //We do caching here if user is typing in ndc one digit at a time since PouchDB's speed varies a lot (50ms - 2000ms)\n    if (generic.startsWith(search._term) && ! clearCache) {\n      const regex = RegExp('(?=.*'+terms.join(')(?=.*( |0)')+')', 'i') //Use lookaheads to search for each word separately (no order).  Even the first term might be the 2nd generic\n      return search._drugs.then(drugs => drugs.filter(drug => regex.test(drug.generic))).then(drugs => {\n        console.log('generic filter returned', drugs.length, 'rows and took', Date.now() - start, 'term', generic, 'cache', search._term)\n        search._term = generic\n        return drugs\n      })\n    }\n\n    search._term = generic\n\n    return search._drugs = this.db.drug.query('generics.name', search.range(terms[0])).then(search.map(start))\n  },\n\n  addPkgCode(term, drug) {\n    var pkg, ndc9, upc\n    if (term.length > 8) {\n      ndc9 = '^'+drug.ndc9+'(\\\\d{2})$'\n      upc  = '^'+drug.upc+'(\\\\d{'+(10 - drug.upc.length)+'})$'\n      pkg  = term.match(RegExp(ndc9+'|'+upc))\n    }\n\n    drug.pkg = pkg ? pkg[1] || pkg[2] : ''\n    return drug\n  },\n\n  range(term) {\n    return {startkey:term, endkey:term+'\\uffff', include_docs:true}\n  },\n\n  map(start) {\n    return res => {\n      console.log('query returned', res.rows.length, 'rows and took', Date.now() - start)\n      return res.rows.map(row => row.doc)\n    }\n  },\n\n  //For now we make this function stateful (using \"this\") to cache results\n  ndc(ndc, clearCache) {\n    const start = Date.now()\n    var term = ndc.replace(/-/g, '')\n\n    //This is a UPC barcode ('3'+10 digit upc+checksum).\n    if (term.length == 12 && term[0] == '3')\n      term = term.slice(1, -1)\n\n    var ndc9 = term.slice(0, 9)\n    var upc  = term.slice(0, 8)\n\n    //We do caching here if user is typing in ndc one digit at a time since PouchDB's speed varies a lot (50ms - 2000ms)\n    if (term.startsWith(search._term) && ! clearCache) {\n      console.log('FILTER', 'ndc9', ndc9, 'upc', upc, 'term', term, 'this.term', search._term)\n      return search._drugs.then(drugs => drugs.filter(drug => {\n        search.addPkgCode(term, drug)\n        //If upc.length = 9 then the ndc9 code should yield a match, otherwise the upc  which is cutoff at 8 digits will have false positives\n        return drug.ndc9.startsWith(ndc9) || (drug.upc.length != 9 && term.length != 11 && drug.upc.startsWith(upc))\n      }))\n    }\n\n    console.log('QUERY', 'ndc9', ndc9, 'upc', upc, 'term', term, 'this.term', search._term)\n\n    search._term = term\n\n    ndc9 = this.db.drug.query('ndc9', search.range(ndc9)).then(search.map(start))\n\n    upc = this.db.drug.query('upc', search.range(upc)).then(search.map(start))\n\n    //TODO add in ES6 destructuing\n    return search._drugs = Promise.all([upc, ndc9]).then(results => {\n\n      let deduped = {}\n\n      for (const drug of results[0])\n        if (drug.upc.length != 9 && term.length != 11) //If upc.length = 9 then the ndc9 code should yield a match, otherwise the upc which is cutoff at 8 digits will have false positives\n          deduped[drug._id] = drug\n\n      for (const drug of results[1])\n          deduped[drug._id] = drug\n\n      deduped = Object.keys(deduped).map(key => search.addPkgCode(term, deduped[key]))\n      console.log('query returned', deduped.length, 'rows and took', Date.now() - start)\n      return deduped\n    })\n  }\n}\n\nexport function drugSearch() {\n  if ( ! this.term || this.term.length < 3)\n    return Promise.resolve([])\n\n  //When adding a new NDC for an existing drug search term is the same but we want the\n  //results to display the new drug too, so we need to disable filtering old results\n  const clearCache = this._savingDrug\n  const term = this.term.trim()\n\n  //always do searches serially\n  return this._search = Promise.resolve(this._search).then(_ => {\n    return search[/^[\\d-]+$/.test(term) ? 'ndc' : 'generic'].call(this, term, clearCache)\n  })\n}\n\n//whether mm/yy or mm/dd/yy, month is always first and year is always last\nexport function parseUserDate(date) {\n  date = (date || \"\").split('/') //can't do default arugment because can be null as well as undefined\n  return {\n    year:date.pop(),\n    month:date.shift()\n  }\n}\n\n//To get last day in month, set it to next month and subtract a day\nexport function toJsonDate({month, year}) {\n  let date = new Date('20'+year,month, 1)\n  date.setDate(0)\n  return date.toJSON()\n}\n\n//Calls the direct query to pouch to wait on the drug database being synced. Then it\n//reopens the search field and changes the placeholder.\nexport function waitForDrugsToIndex(){\n  this.db.drug.drugIsIndexed.get().then(_ => {\n   this.drugsIndexed = true\n   this.placeholder = \"Search Drugs By Generic Name Or NDC...\"\n  })\n}\n\nimport {Redirect} from 'aurelia-router'\n\nexport function canActivate(_, next, {router}) {\n  return this.db.user.session.get().then(session => {\n\n    let loggedIn = session && session.account\n\n    for (let route of router.navigation)\n        route.isVisible = loggedIn\n          ? route.config.roles && ~route.config.roles.indexOf('user')\n          : ! route.config.roles\n\n    let canActivate = next.navModel.isVisible || ! next.nav\n\n    return canActivate || router.currentInstruction\n      ? canActivate\n      : new Redirect(loggedIn ? 'shipments' : 'login')\n  })\n  .catch(err => console.log('loginRequired error', err))\n}\n"," import {toJsonDate, parseUserDate} from '../resources/helpers'\n\n//http://stackoverflow.com/questions/32017532/observe-property-on-an-array-of-objects-for-any-changes\nexport class jsonValueConverter {\n  toView(object = null){\n    return JSON.stringify(object, null, \" \")\n  }\n}\n\nexport class numberValueConverter {\n  fromView(str){\n    return str === '' ? null : +str\n  }\n}\n\nexport class upperCaseValueConverter {\n  fromView(str) {\n    return str == null ? null : str.toUpperCase()\n  }\n}\n\nexport class shipmentFilterValueConverter {\n  toView(shipments = [], filter = ''){\n    filter = filter.toLowerCase()\n    return shipments.filter(shipment => {\n      return ~ `${shipment.account.from.name} ${shipment.account.to.name} ${shipment.tracking} ${shipment.status} ${shipment._id && shipment._id.slice(0, 10)}`.toLowerCase().indexOf(filter)\n    })\n  }\n}\n\nexport class drugFilterValueConverter {\n  toView(drugs = [], filter = ''){\n    filter = filter.replace('.', '\\\\.').split(/, |[, ]/g)\n    var regex = RegExp('(?=.*'+filter.join(')(?=.*( |0)')+')', 'i') //Use lookaheads to search for each word separately (no order).  Even the first term might be the 2nd generic\n    return drugs.filter(drug => regex.test(drug.generic))\n  }\n}\n\n//TODO make this work with added items\nexport class userFilterValueConverter {\n  toView(users = [], filter = ''){\n    filter = filter.toLowerCase()\n    let res = users.filter(user => {\n      try {\n        return ~ `${user.name.first} ${user.name.last}`.toLowerCase().indexOf(filter)\n      }\n      catch (err) {\n        console.log('filter err', user, err)\n      }\n    })\n    return res\n  }\n}\n\nexport class valueValueConverter {\n  toView(transactions = [], decimals, trigger) {\n\n    transactions = Array.isArray(transactions) ? transactions : [transactions]\n\n    return transactions.reduce((total, transaction) => {\n      if ( ! transaction.drug.price || ! transaction.qty) return 0\n      let price = transaction.drug.price.goodrx || transaction.drug.price.nadac || 0\n      let   qty = transaction.qty.to || transaction.qty.from || 0\n      return total + qty * price\n    }, 0).toFixed(decimals)\n  }\n}\n\nexport class boldValueConverter {\n  toView(text, bold){\n    if ( ! bold || ! text) return text\n\n    if (typeof bold == 'string') //Handle a strength of 0.5mg and .5mg interchangeably\n      bold = RegExp('('+bold.replace(/ /g, '|').replace('.', '( | 0)?\\\\.')+')', 'gi')\n\n    return text.replace(bold, '<strong>$1</strong>')\n  }\n}\n\nexport class dateValueConverter {\n\n  toView(date) {\n    if ( ! date ) return ''\n    return date != this.model ? date.slice(5,7)+'/'+date.slice(2,4) : this.view\n  }\n\n  fromView(date){\n\n    if (date.includes('*'))\n      return null\n\n    let add = date.includes('+') || date.includes('=')\n    let sub = date.includes('-')\n\n    let {month, year} = parseUserDate(date.replace(/\\+|\\-|\\=/g, ''))\n\n    if (year.length > 2) //without this if user accidentally typed an extra character it would cause ongoing save error\n      year = year.slice(0, 2)\n\n    if (add) month++\n    if (sub) month--\n\n    if (month == 0) {\n      month = 12\n      year--\n    }\n\n    if (month == 13) {\n      month = 1\n      year++\n    }\n\n    //Keep zerp padding in front of the month which is lost when month changes\n    this.view = (\"00\"+month).slice(-2)+'/'+year\n\n    return this.model = toJsonDate({month, year})\n  }\n}\n\nexport class toArrayValueConverter {\n  toView(obj = {}, sort){\n\n    let arr = Object.keys(obj)\n\n    if (sort) arr.sort().reverse()\n\n    return arr.map(key => {\n      return {key, val:obj[key]}\n    })\n  }\n}\n\n//ADDED step of converting object to array\nexport class inventoryFilterValueConverter {\n  isRepacked(transaction) {\n    return transaction.shipment._id.indexOf('.') == -1 ? 'Repacked' : 'Inventory'\n  }\n  toView(transactions = [], filter = {}){\n\n    //restart filter on transaction changes but keep checks\n    //where they are if user is just modifying the filter\n    let ndcFilter    = {}\n    let expFilter    = {}\n    let repackFilter = {}\n    let formFilter   = {}\n\n    transactions = transactions.filter(transaction => {\n\n      //TODO we could reduce code by making this a loop of keys.  Lot's of redundancy here\n      let qty    = transaction.qty.to || transaction.qty.from\n      let exp    = transaction.exp.to || transaction.exp.from\n      let ndc    = transaction.drug._id\n      let form   = transaction.drug.form\n      let repack = this.isRepacked(transaction)\n\n      if ( ! expFilter[exp])\n        expFilter[exp] = {isChecked:filter.exp && filter.exp[exp] ? filter.exp[exp].isChecked : true, count:0, qty:0}\n\n      if ( ! ndcFilter[ndc])\n        ndcFilter[ndc] = {isChecked:filter.ndc && filter.ndc[ndc] ? filter.ndc[ndc].isChecked : true, count:0, qty:0}\n\n      if ( ! formFilter[form])\n        formFilter[form] = {isChecked:filter.form && filter.form[form] ? filter.form[form].isChecked : true, count:0, qty:0}\n\n      if ( ! repackFilter[repack])\n        repackFilter[repack] = {isChecked:filter.form && filter.repack[repack] ? filter.repack[repack].isChecked : true, count:0, qty:0}\n\n      if ( ! expFilter[exp].isChecked) {\n        if (ndcFilter[ndc].isChecked && formFilter[form].isChecked && repackFilter[repack].isChecked) {\n          expFilter[exp].count++\n          expFilter[exp].qty += qty\n        }\n        return false\n      }\n      if ( ! ndcFilter[ndc].isChecked) {\n        if (expFilter[exp].isChecked && formFilter[form].isChecked && repackFilter[repack].isChecked) {\n          ndcFilter[ndc].count++\n          ndcFilter[ndc].qty += qty\n        }\n        return false\n      }\n\n      if ( ! formFilter[form].isChecked) {\n        if (expFilter[exp].isChecked && ndcFilter[ndc].isChecked && repackFilter[repack].isChecked) {\n          formFilter[form].count++\n          formFilter[form].qty += qty\n        }\n        return false\n      }\n\n      if ( ! repackFilter[repack].isChecked) {\n        if (expFilter[exp].isChecked && ndcFilter[ndc].isChecked && formFilter[form].isChecked) {\n          repackFilter[repack].count++\n          repackFilter[repack].qty += qty\n        }\n        return false\n      }\n\n      expFilter[exp].count++\n      expFilter[exp].qty += qty\n\n      ndcFilter[ndc].count++\n      ndcFilter[ndc].qty += qty\n\n      formFilter[form].count++\n      formFilter[form].qty += qty\n\n      repackFilter[repack].count++\n      repackFilter[repack].qty += qty\n\n      return true\n    })\n\n    filter.exp    = expFilter\n    filter.ndc    = ndcFilter\n    filter.form   = formFilter\n    filter.repack = repackFilter\n\n    return transactions\n  }\n}\n","export let csv = {toJSON, fromJSON}\n","export default {\n  debug: true,\n  testing: true\n};\n","export class Db {\n  constructor() {\n    return pouchdbClient\n  }\n}\n","import {inject} from 'aurelia-framework';\n\n@inject(Element)\nexport class FormCustomAttribute {\n\n  constructor(element) {\n    this.element = element\n    this.change  = this.change.bind(this)\n  }\n\n  change() {\n    this.inputElement.disabled = this.formElement && ! this.formElement.checkValidity()\n\n    //Setting the disabled property alone did not seem to trigger MDL\n    this.inputElement.disabled\n      ? this.inputElement.setAttribute('disabled', true)\n      : this.inputElement.removeAttribute('disabled')\n  }\n\n  attached() {\n    //TODO allow attribute value to specify the form by name.\n    //TODO a detached method.  Are these event listeners leaking?\n    this.formElement = this.element.closest('form')\n    this.formElement.addEventListener('change', this.change)\n    this.formElement.addEventListener('input', this.change)\n\n    this.inputElement = this.element.querySelector('input,button,select') || this.element\n\n    //When going \"back\" to \"Create New Shipment\" form.checkValidity() would return true\n    //initially and then turn to false. setTimeout seems to eliminate this problem\n    setTimeout(this.change)\n  }\n}\n","import {bindable, bindingMode} from 'aurelia-framework';\n\n@bindable({name:'value', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('placeholder')\nexport class MdAutocompleteCustomElement {\n  toggleResults($event) {\n    //Foucusout removes the results from the view before the click on\n    //the selected result can register.  Delaying a bit prevents this\n    //http://stackoverflow.com/questions/18848738/click-event-not-triggered-after-focusout-event\n    setTimeout(() => this.showResults = ! this.showResults, 200)\n  }\n}\n","import {bindable, inject} from 'aurelia-framework';\n\n@bindable('form')\n@bindable('class')\n@bindable('raised')\n@bindable('fab')\n@bindable('disabled')\n@bindable('color')\n@inject(Element)\nexport class MdButtonCustomElement {\n\n  constructor(element) {\n    this.element = element\n    this.change  = this.change.bind(this)\n  }\n\n  //click.trigger won't trigger when button is disabled, but delegate will\n  //but we cant use trigger because $parent's delegate will still fire regardless\n  //so use delegate, but for some reason delegate stops bubbling even if we do\n  //\"return true\" so we need to to refire the event.\n  click($event) {\n    this.disabled && $event.stopPropagation()\n  }\n\n  disabledChanged() {\n    this.button && this.change()\n  }\n\n  change(input) {\n    this.disabled = this.disabled || this.disabled === ''\n  }\n\n  attached() {\n\n    //When going \"back\" to \"Create New Shipment\" form.checkValidity() would return true\n    //initially and then turn to false. setTimeout seems to eliminate this problem\n    setTimeout(this.change)\n\n    this.class && this.button.classList.add(...this.class.split(' '))\n    //attributes are made an empty string by default, so we can't just test for truthiness\n    //primary and accent are dynamic/reactive based on disable so need to be in the template.\n    if (typeof this.color == 'string' && this.color.slice(0, 4) != 'mdl-') {\n      this.color = 'mdl-button--'+(this.color || 'colored')\n    }\n\n    if (this.fab > 0) {\n      this.button.classList.add('mdl-button--fab')\n      this.button.style.height = this.fab+'px'\n      this.button.style.width  = this.fab+'px'\n      this.button.style['min-width'] = this.button.style.width\n      this.button.style['font-size'] = this.fab*.75+'px'\n      this.button.style['line-height'] = this.fab+'px'\n      //this.button.style['min-width'] = this.element.fab+'px'\n    }\n\n    if(this.element.parentElement.tagName == 'MD-DRAWER') {\n      this.button.style.width = \"100%\"\n      this.button.style.height = \"auto\"\n      this.button.style.padding = \"16px 8px\"\n      this.button.style['line-height'] = \"18px\"\n      //this.button.style['text-align'] = \"left\"\n    }\n  }\n\n}\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\n\n@bindable({name:'checked', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('required')\n@inject(Element)\nexport class MdCheckboxCustomElement {\n\n  constructor(element) {\n    this.tabindex = element.tabIndex\n    //Can't do this with <template click.delegate> since that overwrites authors delegate fn\n    element.addEventListener('click', e => this.disabled && e.stopPropagation())\n  }\n\n  //A click on input causes a UI change and then if aurelia is also listening for a\n  //click that causes a state change, then the two state changes cancel and it looks\n  //like the switch is locked.  Prevent this from happening.\n  stopPropogation() {\n    return true\n  }\n\n  //If we are relying on parent method returning true then this isn't needed,\n  //but if we are binding to check to change it programmatically we need this\n\n  checkedChanged() {\n    this.checked = !! this.checked //force boolean or we get weird behavior\n    setTimeout(_ => this.label && this.label.MaterialCheckbox && this.label.MaterialCheckbox.checkToggleState()) //checked hasn't actually been changed yet so wait for the change and then check\n  }\n\n  disabledChanged() {\n    setTimeout(_ => this.label && this.label.MaterialCheckbox.checkDisabled()) //disabled hasn't actually been changed yet so wait for the change and then check\n  }\n\n  attached() {\n    componentHandler.upgradeAllRegistered()\n    this.checkedChanged()\n    this.disabledChanged()\n  }\n}\n","import {inject} from 'aurelia-framework';\n\nlet drawer = document.createElement('nav')\ndrawer.classList.add(\"mdl-layout__drawer\")\n//console.log('drawer was created')\n\n@inject(Element)\nexport class MdDrawerCustomElement {\n\n  constructor(element) {\n    element.classList.add(\"mdl-navigation\")\n    element.style['padding-top'] = '6px'\n\n    this.autofocus = element.hasAttribute('autofocus')\n    //Move md-nav into the drawer\n    drawer.appendChild(element)\n    //console.log('drawer was constructed')\n  }\n\n  attached() {\n    this.header = document.querySelector('.mdl-layout__header')\n    this.header.parentNode.insertBefore(drawer, this.header.nextSibling)\n\n    componentHandler.upgradeAllRegistered()\n    //componentHandler.upgradeDom()\n\n    this.button = document.querySelector('.mdl-layout__drawer-button')\n\n    if (this.button)\n      this.button.style.display = 'block'\n\n    if (this.autofocus && this.header.firstChild)\n      this.header.firstChild.click()\n  }\n\n  detached() {\n    //New drawer is attached before old drawer is detached so children.length == 2\n    //except if going to view without a drawer (e.g login) in which length == 1\n    //console.log('detached', drawer.children.length)\n    if (drawer.children.length == 1 && this.button)\n      this.button.style.display = 'none'\n\n    //Empty the drawer\n    drawer.removeChild(drawer.firstChild)\n  }\n}\n","import {inject, bindable, bindingMode} from 'aurelia-framework';\n\n@bindable({name:'value', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('pattern')\n@bindable('step')\n@bindable('type')\n@bindable('placeholder')\n@bindable('input')\n@bindable('max')\n@bindable('required')\n@bindable('minlength')\n@bindable('maxlength')\n@bindable('autofocus')\nexport class MdInputCustomElement {\n\n  valueChanged() {\n    setTimeout(_=> {\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDirty()\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkValidity()\n    })\n  }\n\n  disabledChanged() {\n    setTimeout(_ => {\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDisabled()\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkValidity()\n    }) //disabled hasn't actually been changed yet so wait for the change and then check\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.div)\n\n    if ( ! this.placeholder)\n      this.div.classList.remove('has-placeholder')\n\n    if (this.autofocus || this.autofocus === '')\n      this.div.MaterialTextfield.input_.focus()\n  }\n}\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\n\n@bindable('value')\nexport class MdLoadingCustomElement {\n\n  valueChanged(val) {\n    setTimeout(_=> this.div && this.div.MaterialProgress.setProgress(Math.min(val, 100)))\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.div)\n  }\n}\n","import {ObserverLocator, bindable, inject} from 'aurelia-framework';\n\n@inject(ObserverLocator, Element)\nexport class MdMenuCustomElement {\n\n  constructor(observer, element) {\n    //Router add both pages to view at same time.  This confuses the MDL library\n    //which add the button's click handler to the previous page rather than the\n    //next page since the two ids are the same.  Prevent this by randomly generating\n    //the id.  Also 'for.bind' doesn't seem to work so using synomym data-md-for\n    this.id = 'id'+Date.now()\n    this.element = element\n    this.observer = observer\n  }\n\n  click($event) {\n    if ($event.target.tagName == 'INPUT' || $event.target.disabled)\n      $event.stopImmediatePropagation()\n\n    return true //needed to continue a propogation of an <a> link\n  }\n\n  setDisabled(li, disabled) {\n    disabled\n      ? li.setAttribute('disabled', '')\n      : li.removeAttribute('disabled')\n  }\n\n  attached() {\n    for (let li of this.element.querySelectorAll('li')) {\n      li.classList.add('mdl-menu__item')\n      this.setDisabled(li, li.disabled)\n      this.observer.getObserver(li, 'disabled').subscribe(disabled => {\n        this.setDisabled(li, disabled)\n      })\n    }\n  }\n}\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\n\n@bindable({name:'value', defaultBindingMode: bindingMode.twoWay})\n@bindable('style')\n@bindable('options')\n@bindable('disabled')\n@bindable('default')\n@bindable('required')\n@bindable('property')\nexport class MdSelectCustomElement {\n\n  //need when toggling back and forth on shipments page to make sure from/to account disables where updated\n  disabledChanged() {\n    setTimeout(_=> this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDisabled())\n  }\n\n  valueChanged() {\n    setTimeout(_=> this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDirty())\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.div)\n  }\n}\n","import {inject} from 'aurelia-framework';\n\n@inject(Element)\nexport class MdShadowCustomAttribute {\n\n  constructor(element) {\n    element.classList.add(\"mdl-shadow--\"+element.getAttribute('md-shadow')+\"dp\")\n  }\n}\n","import {bindable, inject} from 'aurelia-framework';\n\n@bindable('show')\n@inject(Element)\nexport class MdSnackbarCustomElement {\n\n  constructor(element) {\n    this.element = element\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.element)\n    this.element.show = opts => {\n      if (typeof opts == 'string')\n        opts = {message:opts, timeout:5000}\n\n      this.element.MaterialSnackbar.showSnackbar(opts)\n    }\n    this.element.error = (msg, err) => {\n      if ( ! err) {\n        err = msg\n        msg = ''\n      }\n      msg = `${msg} ${err.message}`\n      this.element.show(msg)\n      console.error(msg, err)\n      return err\n    }\n  }\n}\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\n\n@bindable({name:'checked', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('required')\n@inject(Element)\nexport class MdSwitchCustomElement {\n\n  constructor(elem) {\n    //Do not propogate click if element is disabled\n    //Can't do this with <template click.delegate> since that overwrites authors delegate fn\n    elem.addEventListener('click', e => this.disabled && e.stopPropagation())\n  }\n\n  //A click on input causes a UI change and then if aurelia is also listening for a\n  //click that causes a state change, then the two state changes cancel and it looks\n  //like the switch is locked.  Prevent this from happening.\n  //https://www.kirupa.com/html5/event_capturing_bubbling_javascript.htm\n  stopPropogation() {\n    return true\n  }\n\n  //If we are relying on parent returning true then this isn't needed, but\n  //if we are binding to check to change it programmatically we need this\n  checkedChanged() {\n    this.checked = !! this.checked\n    setTimeout(_ => this.label && this.label.MaterialSwitch.checkToggleState()) //checked hasn't actually been changed yet so wait for the change and then check\n  }\n\n  disabledChanged() {\n    setTimeout(_ => this.label && this.label.MaterialSwitch.checkDisabled()) //disabled hasn't actually been changed yet so wait for the change and then check\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.label)\n    this.checkedChanged()\n    this.disabledChanged()\n  }\n}\n","import {inject} from 'aurelia-framework';\n\n@inject(Element)\nexport class MdTableCustomAttribute {\n\n  constructor(element) {\n\n    element.classList.add(\"mdl-data-table\")\n    element.classList.add(\"mdl-js-data-table\")\n    element.style.border = \"none\"\n\n    if (element.getAttribute('md-table'))\n      element.classList.add(\"mdl-data-table--selectable\")\n\n    this.element = element\n    //this.checkboxes = element.querySelector('')\n  }\n\n  valueChanged(selectable) {\n\n    let checkboxes = this.element.querySelectorAll('input[type=\"checkbox\"]')\n\n    for (var i=0; i < checkboxes.length; i++) {\n      checkboxes[i].disabled = selectable == 'false'\n    }\n  }\n\n  attached() {\n\n    componentHandler.upgradeAllRegistered()\n  }\n}\n","import {inject} from 'aurelia-framework';\nimport {Db}     from '../libs/pouch'\nimport {Router} from 'aurelia-router'\nimport {canActivate} from '../resources/helpers'\n\n//TODO this is causing Router to revert route and switches to not be upgraded @pageState()\n@inject(Db, Router)\nexport class account {\n\n  constructor(db, router){\n    this.db           = db\n    this.router       = router\n    this.canActivate  = canActivate\n  }\n\n  activate() {\n\n    this.db.user.session.get().then(session => {\n\n      this.session = session\n\n      //TODO allow a valueConverter for each state or do a new search\n      this.db.account.allDocs({include_docs:true, endkey:'_design'}).then(accounts => {\n        this.accounts = accounts.rows.map(account => account.doc).filter(account => {\n          if (account._id != session.account._id)\n            return true\n          this.account = account\n        })\n      })\n\n      return this.db.user.query('account._id', { key:session.account._id, include_docs:true})\n      .then(users => {\n        this.users = users.rows.map(user => user.doc)\n        this.selectUser()\n      })\n    })\n  }\n\n  selectUser(user) {\n    this.user = user || this.users.filter(user => user._id == this.session._id)[0]\n  }\n\n  saveUser() {\n    this.user._id && this.db.user.put(this.user)\n    return true\n  }\n\n  addUser() {\n    this.users.unshift(this.user)\n    this.db.user.post(this.user)\n    .catch(err => {\n      this.users.shift()\n      this.snackbar.show(err.message || err.reason)\n    })\n  }\n\n  deleteUser() {\n    let index = this.users.indexOf(this.user)\n    this.db.user.remove(this.user).then(_ => {\n      this.users.splice(index, 1)\n      this.selectUser()\n    })\n    .catch(err => {\n      console.log(err)\n      this.snackbar.show(err.message || err.reason)\n    })\n  }\n\n  //Simple debounce doesn't work here to prevent double click\n  //because account is not authorized until the db returns\n  //which means isAuthorized isn't updated yet for the since click\n  authorize(_id) {\n    console.log('account.authorize', _id, this.account.authorized)\n    let index  = this.account.authorized.indexOf(_id)\n    let method = ~ index ? 'delete' : 'post'\n    this.db.account.authorized[method](_id).then(res => this.account.authorized = res.authorized)\n    //TODO reset checkbox and show snackbar if change not made\n  }\n\n  logout() {\n    this.disableLogout = 'Uninstalling...'\n    this.db.user.session.delete().then(_ => {\n      this.router.navigate('login', {trigger:true})\n    })\n    .catch(err => console.trace('Logout failed:',err))\n  }\n}\n","import {inject} from 'aurelia-framework'\nimport {Router} from 'aurelia-router'\nimport {Db}     from '../libs/pouch'\nimport {csv}    from '../libs/csv'\nimport {canActivate, scrollSelect, toggleDrawer, drugSearch} from '../resources/helpers'\n\n\n//@pageState()\n@inject(Db, Router)\nexport class drugs {\n  constructor(db, router){\n    console.log(1)\n    this.csv    = csv\n    this.db     = db\n    this.router = router\n    this.term   = ''\n    this.scrollDrugs = this.scrollDrugs.bind(this)\n\n    this.toggleDrawer = toggleDrawer\n    this.scrollSelect = scrollSelect\n    this.drugSearch   = drugSearch\n    this.canActivate = canActivate\n  }\n\n  deactivate() {\n    removeEventListener('keyup', this.scrollDrugs)\n  }\n\n  activate(params) {\n\n    addEventListener('keyup', this.scrollDrugs)\n    return this.db.user.session.get()\n    .then(session => {\n      return this.db.account.get(session.account._id)\n    })\n    .then(account => {\n      this.account = account\n      this.drawer  = {\n        ordered:Object.keys(this.account.ordered).sort()\n      }\n\n      if (params.id)\n        return this.db.drug.get(params.id).then(drug => {\n          this.selectDrug(drug, true)\n        })\n\n      if (this.drawer.ordered[0])\n        return this.selectDrawer(this.drawer.ordered[0])\n\n      return this.selectDrug()\n    })\n  }\n\n  scrollGroups($event) {\n    Promise.resolve(this._search).then(_ => {\n      //group won't be a reference so we must search manually\n      this.scrollSelect($event, this.group, this.groups, group => this.selectGroup(group, true))\n\n      if ($event.which == 13)//Enter get rid of the results\n        this.selectGroup(null, true)\n    })\n\n    $event.stopPropagation() //scrolling groups doesn't need to scroll drugs as well\n  }\n\n  scrollDrugs($event) {\n    this.group && this.scrollSelect($event, this.drug, this.group.drugs, this.selectDrug)\n  }\n\n  //Three entrances.\n  //1) User searches and then selects group from autocomplete (group already supplied)\n  //2) selectDrawer and we need to find the group with that particular generic name\n  //3) selectDrug and we need to find the group with that particular generic name\n  selectGroup(group, autoselectDrug) {\n    this.term = group.name\n    this.db.transaction.query('inventory.drug.generic', {key:group.name, include_docs:true}).then(inventory => {\n      this.inventory = inventory.rows[0] && inventory.rows[0].qty\n    })\n\n    if ( ! group.drugs) //Not set if called from selectDrug or selectDrawer\n      group.drugs = this.search().then(_ => {\n        //Use filter to get an exact match not just one ingredient\n        return this.groups.length ? this.groups.filter(group => this.term == group.name)[0].drugs : []\n      })\n\n    Promise.resolve(group.drugs).then(drugs => {\n      group.drugs = drugs\n      this.group  = group\n      //TODO if this was called by selectDrug then we should establish establish a reference\n      //between the approriate this.group.drugs and this.drug so that changes to the drug\n      //appear in realtime on the right hand side.  This works if selectGroup\n      if (autoselectDrug)\n        this.selectDrug(group.drugs[0])\n    })\n  }\n\n  selectDrug(drug, autoselectGroup) {\n    //Default is for Add Drug menu item in view\n    this.drug = drug || {\n      generics:this.drug ? this.drug.generics : [{name:'', strength:''}],\n      form:this.drug && this.drug.form\n    }\n\n    let url = this.drug._id ? 'drugs/'+this.drug._id : 'drugs'\n    this.router.navigate(url, { trigger: false })\n\n    if (autoselectGroup)\n      this.selectGroup({name:this.drug.generic || this.term})\n  }\n\n  selectDrawer(generic) {\n    this.selectGroup({name:generic}, true)\n    this.toggleDrawer()\n  }\n\n  search() {\n    return this.drugSearch().then(drugs => {\n      let groups = {}\n      for (let drug of drugs) {\n        groups[drug.generic] = groups[drug.generic] || {name:drug.generic, drugs:[]}\n        groups[drug.generic].drugs.push(drug)\n      }\n      this.groups = Object.keys(groups).map(key => groups[key])\n    })\n  }\n\n  //We might make a separate database and API out of this one day, but for now just save on account object.\n  //TODO: Warn on delete since we won't save save any of the preferences?\n  order() {\n    if (this.account.ordered[this.group.name]) {\n      //Delete this group from the drawer drawer\n      this.drawer.ordered = this.drawer.ordered.filter(generic => {\n        return generic != this.group.name\n      })\n\n      this.account.ordered[this.group.name] = undefined\n    } else {\n      //Add New Order but Keep Add New Item on Top\n      this.drawer.ordered.unshift(this.group.name)\n      this.account.ordered[this.group.name] = {}\n    }\n\n    this.saveOrder()\n  }\n\n  exportCSV(generic) {\n    this.db.drug.allDocs({include_docs:true, endkey:'_design'})\n    .then(res => {\n      return Promise.all(res.rows.map(row => {\n        return this.db.transaction.query('inventory', {key:[row.doc.generic, row.doc._id]})\n        .then(inventory => {\n          return {\n            order:this.account.ordered[row.doc.generic],\n            '':row.doc,\n            upc:\"UPC \"+row.doc.upc,\n            ndc9:\"NDC9 \"+row.doc.ndc9,\n            generics:row.doc.generics.map(generic => generic.name+\" \"+generic.strength).join(';'),\n            inventory:inventory.rows[0] && inventory.rows[0].value\n          }\n        })\n      }))\n    })\n    .then(rows => this.csv.fromJSON(`Drugs ${new Date().toJSON()}.csv`, rows))\n  }\n\n  importCSV() {\n    this.snackbar.show(`Parsing csv file`)\n    function capitalize(text) {\n      return text ? text.trim().toLowerCase().replace(/\\b[a-z]/g, l => l.toUpperCase()) : text\n    }\n    function trim(text) {\n      return text ? text.trim() : text\n    }\n\n    this.csv.toJSON(this.$file.files[0], drugs => {\n      this.$file.value = ''\n      let errs  = []\n      let chain = Promise.resolve()\n\n      for (let i in drugs) {\n        chain = chain\n        .then(_ => {\n          let drug = drugs[i]\n\n          drug = {\n            _id:trim(drug._id),\n            brand:trim(drug.brand),\n            form:capitalize(drug.form),\n            image:trim(drug.image),\n            labeler:capitalize(drug.labeler),\n            generics:drug.generics.split(\";\").filter(v => v).map(generic => {\n              let [name, strength] = generic.split(/(?= [\\d.]+)/)\n              return {\n                name:capitalize(name),\n                strength:trim(strength || '').toLowerCase().replace(/ /g, '')\n              }\n            }),\n            price:drug.price\n          }\n\n          return this.db.drug.post(drug)\n          .catch(err => {\n            drug._err = 'Upload Error: '+JSON.stringify(err)\n            errs.push(drug)\n          })\n          .then(_ => {\n            if (+i && (i % 100 == 0))\n              this.snackbar.show(`Imported ${i} of ${drugs.length}`)\n          })\n        })\n      }\n\n      return chain.then(_ => errs)  //return something so we do download errors\n    })\n    .then(rows => this.snackbar.show('Import Succesful'))\n    .catch(err => this.snackbar.error('Import Error', err))\n  }\n\n  addGeneric() {\n    this.drug.generics.push({name:'', strength:''})\n    return true\n  }\n\n  removeGeneric() {\n    this.drug.generics.pop()\n    setTimeout(_ => document.forms[0].dispatchEvent(new Event('change')))\n    return true\n  }\n\n  // addPkgSize() {\n  //   this.drug.pkgs.push({code:'', size:''})\n  //   return true\n  // }\n  //\n  // removePkgSize() {\n  //   this.drug.pkgs.pop()\n  //   return true\n  // }\n\n  saveOrder() {\n    return this.db.account.put(this.account).catch(_ => {\n      this.snackbar.show(`Order could not be saved: ${err.reason || err.message}`)\n    })\n  }\n\n  addDrug() {\n    this._savingDrug = true\n    this.db.drug.post(this.drug)\n    .then(res => {\n      this.drug._rev = res.rev\n      this.selectDrug(this.drug, true)\n      this._savingDrug = false\n    })\n    .catch(err => {\n      this._savingDrug = false\n      console.log(err)\n      this.snackbar.show(`Drug not added: ${err.reason || err.message || JSON.stringify(err.errors)}`)\n    })\n  }\n\n  saveDrug() {\n    this._savingDrug = true\n    this.db.drug.put(this.drug)\n    .then(res => {\n      //If we move the last drug out of the group, make sure we unorder it\n      if (\n        this.group.name != this.drug.generic &&\n        this.group.drugs.length == 1 &&\n        this.account.ordered[this.group.name]\n      ) this.order()\n\n      //Wait for the server PUT to replicate back to client\n      this.selectDrug(this.drug, true)\n      this._savingDrug = false\n    })\n    .catch(err => {\n      this._savingDrug = false\n      this.snackbar.show(`Drug not saved: ${err.reason || err.message}`)\n    })\n  }\n\n  deleteDrug() {\n    console.log('TO BE IMPLEMENETED')\n    //TODO complicated since drug might be used in a transaction.  Switch trans to a new drug\n  }\n}\n","export function configure(aurelia) {\n\n  Promise.config({warnings:false})\n  console.log = console.log.bind(console)\n\n  aurelia.use\n    .standardConfiguration()\n    .plugin('aurelia-animator-css')\n    .globalResources('resources/value-converters')\n\n  aurelia.start().then(a => a.setRoot('views/routes'));\n}\n","import {inject} from 'aurelia-framework';\nimport {Db}     from '../libs/pouch'\nimport {Router} from 'aurelia-router';\nimport {csv}    from '../libs/csv'\nimport {canActivate, expShortcuts, qtyShortcuts, incrementBin, saveTransaction, focusInput, scrollSelect, drugSearch, waitForDrugsToIndex, toggleDrawer} from '../resources/helpers'\n\n@inject(Db, Router)\nexport class inventory {\n\n  constructor(db, router){\n    this.db     = db\n    this.router = router\n    this.csv    = csv\n    this.limit  = 100\n    this.repack = {size:30}\n    this.transactions = []\n\n    this.placeholder     = \"Search by generic name, ndc, exp, or bin\" //Put in while database syncs\n    this.waitForDrugsToIndex = waitForDrugsToIndex\n    this.expShortcuts    = expShortcuts\n    this.qtyShortcuts    = qtyShortcuts\n    this.saveTransaction = saveTransaction\n    this.incrementBin    = incrementBin\n    this.focusInput      = focusInput\n    this.scrollSelect    = scrollSelect\n    this.drugSearch      = drugSearch\n    this.canActivate     = canActivate\n    this.toggleDrawer    = toggleDrawer\n    this.reset           = $event => {\n      if ($event.newURL.slice(-9) == 'inventory') {\n        this.term = ''\n        this.allChecked = false\n        this.setTransactions([])\n      }\n    }\n  }\n\n  deactivate() {\n    window.removeEventListener(\"hashchange\", this.reset)\n  }\n\n  activate(params) {\n    //TODO find a more elegant way to accomplish this\n    window.addEventListener(\"hashchange\", this.reset)\n\n    //TODO replace this with page state library\n    this.db.user.session.get().then(session => {\n\n      this.user    = session._id\n      this.account = session.account._id\n\n      this.db.transaction.query('inventory.pendingAt', {include_docs:true, startkey:[this.account], endkey:[this.account, {}]})\n      .then(res => {\n        this.pending = this.sortTransactions(res.rows.map(row => row.doc))\n        .reduce((pending, transaction) => {\n          transaction.isChecked = true //checked by default\n          let createdAt = transaction.next[0].createdAt\n          pending[createdAt] = pending[createdAt] || []\n          pending[createdAt].push(transaction)\n          return pending\n        }, {})\n      })\n      .then(_ => {\n        let keys = Object.keys(params)\n        if (keys[0])\n          this.selectTerm(keys[0], params[keys[0]])\n      })\n\n      return this.db.account.get(this.account)\n    }).then(account => this.ordered = account.ordered)\n  }\n\n  scrollTerms($event) {\n    this.scrollSelect($event, this.term, this.terms, term => this.selectTerm('drug.generic', term))\n\n    if ($event.which == 13)//Enter get rid of the results\n      this.focusInput(`#exp_0`)\n  }\n\n  sortTransactions(transactions) {\n    return transactions.sort((a, b) => {\n      let aExp  = a.exp.to || a.exp.from || ''\n      let bExp  = b.exp.to || b.exp.from || ''\n      let aQty  = a.qty.to || a.qty.from || ''\n      let bQty  = b.qty.to || b.qty.from || ''\n      let aBin  = a.location || ''\n      let bBin  = b.location || ''\n      let aPack = this.isRepacked(a)\n      let bPack = this.isRepacked(b)\n\n      if (aPack > bPack) return -1\n      if (aPack < bPack) return 1\n      if (aBin > bBin) return -1\n      if (aBin < bBin) return 1\n      if (aExp < bExp) return -1\n      if (aExp > bExp) return 1\n      if (aQty > bQty) return -1\n      if (aQty < bQty) return 1\n      return 0\n    })\n  }\n\n  checkTransaction(transaction) {\n    transaction.isChecked = ! transaction.isChecked\n\n    if ( ! transaction.isChecked)\n      this.allChecked = false\n  }\n\n  checkAllTransactions() {\n    this.allChecked = ! this.allChecked\n    for (let transaction of this.transactions)\n      transaction.isChecked = this.allChecked\n  }\n\n  isRepacked(transaction) {\n    return transaction.shipment._id.indexOf('.') == -1\n  }\n\n  setTransactions(transactions) {\n    if (transactions.length == this.limit)\n      this.snackbar.show(`Displaying first 100 results`)\n\n    this.transactions = this.sortTransactions(transactions)\n    this.signalFilter() //inventerFilterValueConverter sets the filter object, we need to make sure this triggers aurelia\n  }\n\n  search() {\n    if (/[A-Z][0-9]{3}/.test(this.term))\n      return this.selectTerm('location', this.term)\n\n    if (/20\\d\\d-\\d\\d-?\\d?\\d?/.test(this.term))\n      return this.selectTerm('exp', this.term, true)\n\n    //Drug search is by NDC and we want to group by generic\n    this.drugSearch().then(drugs => {\n      this.terms = drugs.map(drug => drug.generic).filter((generic, index, generics) => generics.indexOf(generic) == index);\n    })\n  }\n\n  selectPending(pendingAt) {\n    this.term = 'Pending '+pendingAt\n    this.allChecked = true\n    this.setTransactions(this.pending[pendingAt] || [])\n    this.toggleDrawer()\n  }\n\n  selectTerm(type, key) {\n\n    this.router.navigate(`inventory?${type}=${key}`, {trigger:false})\n\n    if (type == 'pending')\n      return this.selectPending(key)\n\n    this.term = key\n    this.allChecked = false\n\n    let opts = {include_docs:true, limit:this.limit}\n    if (type != 'generic') {\n      opts.startkey = [this.account, key]\n      opts.endkey   = [this.account, key+'\\uffff']\n    } else {\n      opts.key = [this.account, key]\n    }\n    const setTransactions = res => this.setTransactions(res.rows.map(row => row.doc))\n    this.db.transaction.query('inventory.'+type, opts).then(setTransactions)\n  }\n\n  signalFilter(obj) {\n    if (obj) obj.val.isChecked = ! obj.val.isChecked\n    this.filter = Object.assign({}, this.filter)\n  }\n\n  updateNextOfSelected(updateFn) {\n    let createdAt = new Date().toJSON() //must be exact same timestamp for group of pending items\n    let length    = this.transactions.length\n    let checked   = []\n    //since we may be deleting as we go, loop backward\n    for (let i = length - 1; i >= 0; i--)  {\n      let transaction = this.transactions[i]\n\n      if ( ! transaction.isChecked) continue\n\n      checked.push(transaction)\n\n      transaction.next = updateFn(transaction)\n      for (let val of transaction.next)\n        val.createdAt = createdAt\n\n      this.transactions.splice(i, 1)\n      this.db.transaction.put(transaction)\n      .catch(err => {\n        transaction.next.pop()\n        this.transactions.splice(i, 0, transaction)\n        this.snackbar.error('Error removing inventory', err)\n      })\n    }\n\n    if (this.term.slice(0,7) == 'Pending' && checked.length == length) {\n      delete this.pending[this.term.slice(8)]\n      this.term = ''\n      this.allChecked = false\n      this.router.navigate(`inventory`, {trigger:false}) //don't accidentally go back here on reload\n    }\n\n    return checked\n  }\n\n  unpendInventory() {\n    this.updateNextOfSelected(_ => [])\n  }\n\n  pendInventory() {\n    let next = [{pending:{}}]\n    let selectedTransactions = this.updateNextOfSelected(_ => next)\n    //Aurelia doesn't provide an Object setter to detect arbitrary keys so we need\n    //to trigger and update using Object.assign rather than just adding a property\n    this.pending = Object.assign({[next[0].createdAt]:selectedTransactions}, this.pending)\n  }\n\n  dispenseInventory() {\n    this.updateNextOfSelected(_ => [{dispensed:{}}])\n  }\n\n  //TODO this allows for mixing different NDCs with a common generic name, should we prevent this or warn the user?\n  repackInventory() {\n    let all = [], createdAt = new Date().toJSON()\n\n    //Create the new (repacked) transactions\n    for (let i=0; i<this.repack.vials; i++) {\n      this.transactions.unshift({\n        verifiedAt:new Date().toJSON(),\n        exp:{to:this.repack.exp, from:null},\n        qty:{to:this.repack.size, from:null},\n        user:{_id:this.user},\n        shipment:{_id:this.account},\n        location:this.repack.location,\n        drug:this.transactions[0].drug,\n        next:this.pendingIndex != null ? [{pending:{}, createdAt}] : [] //Keep it pending if we are on pending screen\n      })\n\n      all.push(this.db.transaction.post(this.transactions[0]))\n    }\n\n    //Keep record of any excess that is implicitly destroyed\n    let excess = this.repack.qty - (this.repack.size * this.repack.vials)\n    if (excess > 0)\n    {\n      all.push(this.db.transaction.post({\n        exp:{to:this.repack.exp, from:null},\n        qty:{to:excess, from:null},\n        user:{_id:this.user},\n        shipment:{_id:this.account},\n        drug:this.transactions[0].drug,\n        next:[] //Keep it pending if we are on pending screen\n      }))\n    }\n\n    //Once we have the new _ids insert them into the next property of the checked transactions\n    Promise.all(all).then(all => {\n\n      let label = [\n        `<p style=\"page-break-after:always;\">`,\n        `<strong>${this.transactions[0].drug.generic+' '+this.transactions[0].drug.form}</strong>`,\n        `Ndc ${this.transactions[0].drug._id}`,\n        `Exp ${this.repack.exp.slice(0, 10)}`,\n        `Bin ${this.repack.location}`,\n        `Qty ${this.repack.size}`,\n        `Pharmacist ________________`,\n        `</p>`\n      ]\n\n      this.updateNextOfSelected(_ => all.map(val => {\n        return {transaction:{_id:val.id}}\n      }))\n\n      let win = window.open()\n      if ( ! win)\n        return this.snackbar.show(`Enable browser pop-ups to print repack labels`)\n  \n      win.document.write(label.join('<br>').repeat(this.repack.vials))\n      win.print()\n      win.close()\n    }).catch(err => {\n      console.error(err)\n      this.snackbar.show(`Transactions could not repackaged: ${err.reason}`)\n    })\n  }\n\n  setRepackVials() {\n    this.repack.vials = +this.repack.size ? Math.floor(this.repack.qty / this.repack.size) : ''\n  }\n\n  openMenu($event) {\n    if ($event.target.tagName != 'I')\n      return true //only calculate for the parent element, <i vertical menu icon>, and not children //true needed so public inventory link works\n\n    this.repack.qty = 0,\n    this.repack.exp = '2099-01-01T00:00:00'\n    for (let transaction of this.transactions) {\n      if (transaction.isChecked) {\n        this.repack.qty += transaction.qty.to\n        this.repack.exp  = this.repack.exp < transaction.exp.to ? this.repack.exp : transaction.exp.to\n      }\n    }\n    this.setRepackVials()\n  }\n\n  binShortcuts($event, $index) {\n    if ($event.which == 13) //Enter should focus on next row's exp\n      return this.focusInput(`#exp_${$index+1}`)\n\n    return this.incrementBin($event, this.transactions[$index])\n  }\n\n  exportCSV() {\n    this.db.transaction.query('inventory.drug.generic', {include_docs:true, startkey:[this.account], endkey:[this.account, {}]})\n    .then(res => {\n      return res.rows.map(row => {\n        row.doc.next = JSON.stringify(row.doc.next)\n        return row.doc\n      })\n    })\n    .then(rows => this.csv.fromJSON(`Inventory ${new Date().toJSON()}.csv`, rows))\n  }\n\n  // importCSV() {\n  //   this.csv.toJSON(this.$file.files[0], parsed => {\n  //     this.$file.value = ''\n  //     return Promise.all(parsed.map(transaction => {\n  //       transaction._err        = undefined\n  //       transaction._id          = undefined\n  //       transaction._rev         = undefined\n  //       transaction.next         = JSON.parse(transaction.next)\n  //       //This will add drugs upto the point where a drug cannot be found rather than rejecting all\n  //       return this.db.drug.get(transaction.drug._id)\n  //       .then(drug => {\n  //         transaction.drug = {\n  //           _id:drug._id,\n  //           brand:drug.brand,\n  //           generic:drug.generic,\n  //           generics:drug.generics,\n  //           form:drug.form,\n  //           price:drug.price,\n  //           pkg:drug.pkg\n  //         }\n  //\n  //         return this.db.transaction.post(transaction)\n  //       })\n  //       .then(_ => { //do not return anything so we don't download successes\n  //         this.transactions.unshift(transaction)\n  //       })\n  //       .catch(err => {\n  //         transaction._err = 'Upload Error: '+JSON.stringify(err)\n  //         return transaction //return something so we do download errors\n  //       })\n  //     }))\n  //   })\n  //   .then(rows => this.snackbar.show('Import Succesful'))\n  //   .catch(err => this.snackbar.error('Import Error', err))\n  // }\n\n  importCSV() {\n    this.snackbar.show(`Parsing csv file`)\nconsole.log(1)\n    this.csv.toJSON(this.$file.files[0], transactions => {\n      this.$file.value = ''\n      let errs  = []\n      let chain = Promise.resolve()\nconsole.log(2)\n      for (let i in transactions) {\n        chain = chain\n        .then(_ => {\n          let transaction = transactions[i]\nconsole.log(3)\n          transaction._err = undefined\n          transaction._id  = undefined\n          transaction._rev = undefined\n          transaction.next = JSON.parse(transaction.next)\n          //This will add drugs upto the point where a drug cannot be found rather than rejecting all\n          return this.db.drug.get(transaction.drug._id)\n          .then(drug => {\n            console.log(4)\n            transaction.drug = {\n              _id:drug._id,\n              brand:drug.brand,\n              generic:drug.generic,\n              generics:drug.generics,\n              form:drug.form,\n              price:drug.price,\n              pkg:drug.pkg\n            }\n\n            return this.db.transaction.post(transaction)\n          })\n          .catch(err => {\n            console.log(5)\n            transaction._err = 'Upload Error: '+JSON.stringify(err)\n            errs.push(transaction)\n          })\n          .then(_ => {\n            console.log(6)\n            if (+i && (i % 100 == 0))\n              this.snackbar.show(`Imported ${i} of ${transactions.length}`)\n          })\n        })\n      }\n\n      return chain.then(_ => errs)  //return something so we do download errors\n    })\n    .then(rows => this.snackbar.show('Import Succesful'))\n    .catch(err => this.snackbar.error('Import Error', err))\n  }\n\n  // importCSV() {\n  //   console.log('this.$file.value', this.$file.value)\n  //   this.csv.parse(this.$file.files[0]).then(parsed => {\n  //     return Promise.all(parsed.map(transaction => {\n  //       this.$file.value = ''  //Change event only fires if filename changed.  Manually set to blank in case user re-uploads same file (name)\n  //       transaction._id          = undefined\n  //       transaction._rev         = undefined\n  //       transaction.next         = JSON.parse(transaction.next || \"[]\")\n  //       return this.db.drug.get({_id:transaction.drug._id}).then(drugs => {\n  //         //This will add drugs upto the point where a drug cannot be found rather than rejecting all\n  //         if ( ! drugs[0])\n  //           throw 'Cannot find drug with _id '+transaction.drug._id\n  //\n  //         transaction.drug = {\n  //           _id:drugs[0]._id,\n  //           brand:drugs[0].brand,\n  //           generic:drugs[0].generic,\n  //           generics:drugs[0].generics,\n  //           form:drugs[0].form,\n  //           price:drugs[0].price,\n  //           pkg:drugs[0].pkg\n  //         }\n  //\n  //         return transaction\n  //       })\n  //       .catch(drug => {\n  //         console.log('Missing drug', transaction.drug._id, transaction.drug)\n  //         throw drug\n  //       })\n  //     }))\n  //   })\n  //   .then(rows => {\n  //     let chain = Promise.resolve()\n  //     for (let i = 0; i < rows.length; i += 36*30-1) {\n  //       chain = chain.then(_ => {\n  //         let args = rows.slice(i, i+36*30-1)\n  //         args = args.map(row => this.db.transaction.post(row))\n  //         args.push(new Promise(r => setTimeout(r, 4000)))\n  //         return Promise.all(args)\n  //       })\n  //       .catch(err => {\n  //         console.log('importCSV error',  i, i+36*30-1, err)\n  //         this.snackbar.show('Error Importing Inventory: '+JSON.stringify(err))\n  //       })\n  //     }\n  //     return chain\n  //   })\n  //   .then(_ => this.snackbar.show(`Imported Inventory Items`))\n  // }\n}\n","import {inject}     from 'aurelia-framework'\nimport {Router}     from 'aurelia-router'\nimport {Db}         from '../libs/pouch'\nimport {HttpClient} from 'aurelia-http-client'\nimport {canActivate} from '../resources/helpers'\n\n//@pageState()\n@inject(Db, Router, HttpClient)\nexport class join {\n\n  constructor(db, router, http){\n    this.db     = db\n    this.router = router\n    this.http   = http\n\n    this.account = {\n      name:'',\n      license:'Pharmacy',\n      street:'',\n      city:'',\n      state:'OR',\n      zip:'',\n      ordered:{}\n    }\n\n    this.user = {\n      name:{first:'Guest',last:'User'},\n      phone:'650.488.7434'\n    }\n    this.canActivate = canActivate\n  }\n\n  join() {\n    console.log('this.account.phone', this.account.phone)\n    this.db.account.post(this.account)\n    .then(res => {\n      this.user.account = {_id:res.id}\n      console.log('this.user.phone', this.user.phone)\n      let password = this.user.password\n      return this.db.user.post(this.user)\n      .then(_ => this.user.password = password)\n    })\n    .then(_ => {\n      console.log(1)\n      //local user is created but now replicator must call bulk docs which then triggers creation of a\n      //_user login. Since, we don't know exactly how long this will take so we must do a timeout here\n      return new Promise(resolve => setTimeout(resolve, 1000))\n    })\n    .then(_ => {\n      console.log(2)\n      return this.db.user.session.post(this.user)\n    })\n    .then(loading => {\n      console.log(3)\n      //wait for all resources except 'drugs' to sync .filter(r => r.name != 'drugs')\n      this.disabled = true\n      this.loading  = loading.resources\n      this.progress = loading.progress\n\n      return Promise.all(loading.syncing)\n    })\n    .then(_ => {\n      console.log('join success', _)\n      return this.router.navigate('shipments')\n    })\n    .catch(err => this.snackbar.error('Join failed', err))\n  }\n}\n","import {inject} from 'aurelia-framework'\nimport {Router} from 'aurelia-router'\nimport {Db}     from '../libs/pouch'\nimport {canActivate} from '../resources/helpers'\n\n\n@inject(Db, Router)\nexport class login {\n\n  constructor(db, router){\n    this.db          = db\n    this.router      = router\n    this.phone       = '650.488.7434'\n    this.password    = ''\n    this.canActivate = canActivate\n  }\n\n  login() {\n    this.db.user.session.post({phone:this.phone, password:this.password})\n    .then(loading => {\n      this.disabled = true\n\n      //wait for all resources except 'drugs' to sync\n      this.loading  = loading.resources\n      this.progress = loading.progress\n\n      return Promise.all(loading.syncing)\n    })\n    .then(resources => {\n      this.router.navigate('shipments')\n    })\n    .catch(err => {\n      this.disabled = false\n      this.snackbar.error('Login failed', err)\n    })\n  }\n}\n","import {inject} from 'aurelia-framework';\nimport {Db}     from '../libs/pouch'\nimport {Router} from 'aurelia-router';\nimport {canActivate} from '../resources/helpers'\n\n@inject(Db, Router)\nexport class inventory {\n\n  constructor(db, router){\n    this.db = db\n    this.router = router\n    this.canActivate = canActivate\n  }\n\n  activate(params) {\n    function reduce(accumulate, account, index) {\n      return account._id == params.id ? index : accumulate\n    }\n\n    this.db.account.get().then(accounts => {\n      this.accounts = accounts\n      this.selectAccount(this.accounts.reduce(reduce))\n    })\n  }\n\n  selectAccount($index) {\n    this.account = this.accounts[$index]._id\n    this.router.navigate('inventory/'+this.account, {trigger:false})\n    this.db.transaction.get({inventory:\"sum\", account:this.account}).then(inventory => this.inventory = inventory)\n  }\n}\n","//TODO\n//Autofocus on new drug\n//Disable From/To based on Filter's switch\n\nimport {inject}     from 'aurelia-framework';\nimport {Router}     from 'aurelia-router';\nimport {Db}         from '../libs/pouch'\nimport {HttpClient} from 'aurelia-http-client';\nimport {canActivate, toggleDrawer} from '../resources/helpers'\n\n//@pageState()\n@inject(Db, Router, HttpClient)\nexport class records {\n\n  constructor(db, router, http){\n    this.db      = db\n    this.router  = router\n    this.http    = http\n    this.history = ''\n    this.days    = []\n    this.scroll  = this.scroll.bind(this)\n    this.toggleDrawer = toggleDrawer\n    this.canActivate = canActivate\n    this.recordTypes = [\n      {label:'Received', value:'received'},\n      {label:'Accepted', value:'verified'},\n      {label:'Dispensed', value:'dispensed'},\n      {label:'Disposed', value:'disposed'}\n    ]\n  }\n\n  deactivate() {\n    removeEventListener('keyup', this.scroll)\n  }\n\n  activate(params) {\n    addEventListener('keyup', this.scroll)\n    return this.db.user.session.get().then(session => {\n      this.account = session.account //this is not a full account, just an _id\n      let opts = {group_level:3, startkey:[this.account._id], endkey:[this.account._id, {}]}\n      return Promise.all([\n        this.db.transaction.query('count', opts),\n        this.db.transaction.query('rxs', opts),\n        this.db.transaction.query('value', opts)\n      ])\n      .then(all => this.months = this.collate(all, true))\n    })\n  }\n\n  collate([count, rxs, value], reverse) {\n    let arr = count.rows.map((count, i) => {\n      return {\n        date:count.key.slice(1).join('-'),\n        key:count.key,\n        count:count.value,\n        rxs:rxs.rows[i].value,\n        value:value.rows[i].value\n      }\n    })\n    console.log('collate', arr)\n    return reverse ? arr.reverse() : arr\n  }\n\n  selectMonth(month) {\n    this.month = month\n    let opts = {group_level:4, startkey:month.key, endkey:month.key.concat({})}\n    return Promise.all([\n      this.db.transaction.query('count', opts),\n      this.db.transaction.query('rxs', opts),\n      this.db.transaction.query('value', opts)\n    ])\n    .then(all => this.days = this.collate(all))\n  }\n\n  selectDay(date, $event) {\n    this.month = null\n    this.days = []\n\n    if ($event) {\n      this.toggleDrawer()\n      $event.stopPropagation() //prevent select month from firing\n    }\n\n    //Just in case the user inverts the to & from dates.\n    // let from = fromDate <= toDate ? fromDate : toDate\n    // let to   = fromDate > toDate ? fromDate : toDate\n    let to = new Date(date)\n    to.setHours(24*2)\n\n    //Do not show inventory $eq, $lt, $gt,\n    let opts = {\n      startkey:[this.account._id, date],\n      endkey:[this.account._id, to.toJSON().slice(0, 10)],\n      include_docs:true\n    }\n\n    this.db.transaction.query('createdAt', opts).then(transactions => {\n      this.transactions = transactions.rows.map(row => row.doc)\n      return this.selectTransaction()\n    })\n  }\n\n  scroll($event) {\n    let index = this.transactions.indexOf(this.transaction)\n    let last  = this.transactions.length - 1\n\n    if ($event.which == 38) //Keyup\n      this.selectTransaction(this.transactions[index > 0 ? index - 1 : last])\n\n    if ($event.which == 40) //keydown\n      this.selectTransaction(this.transactions[index < last ? index+1 : 0])\n  }\n\n  //Activated from constructor and each time a transaction is selected\n  selectTransaction(transaction) {\n    this.transaction = transaction || this.transactions[0]\n\n    if ( ! this.transaction) return\n\n    this.db.transaction.history.get(this.transaction._id)\n    .then(history => {\n      //TODO move this to /history?text=true. Other formatting options?\n      function id(k,o) {\n        //console.log(o, typeof o)\n        if (Array.isArray(o))\n          return o\n        return o.shipment.from.name+' '+o._id\n      }\n      //console.log('history', JSON.stringify(history.content, id, \"*\"))\n      function pad(word) {\n        return (word+' '.repeat(25)).slice(0, 25)\n      }\n      this.history = JSON.stringify(\n        history.reverse(),\n        (k,v) => {\n          if (Array.isArray(v))\n            return v\n\n            let status = this.status || 'pickup' //Might not be initialized yet\n            let href   = '/#/shipments/'+v.shipment._id\n\n            return pad('From: '+v.shipment.account.from.name)+pad('To: '+v.shipment.account.to.name)+\"<a href='\"+href+\"'>\"+v.type+\" <i class='material-icons' style='font-size:12px; vertical-align:text-top; padding-top:1px'>exit_to_app</i></a><br>\"+\n                   pad(v.shipment.account.from.street)+pad(v.shipment.account.to.street)+'Date '+v._id.slice(2, 10)+'<br>'+\n                   pad(v.shipment.account.from.city+', '+v.shipment.account.from.state+' '+v.shipment.account.from.zip)+pad(v.shipment.account.to.city+', '+v.shipment.account.to.state+' '+v.shipment.account.to.zip)+'Quantity '+(v.qty.to || v.qty.from)\n        },\n        \"   \"\n      )\n      .replace(/\\[\\n?\\s*/g, \"<div style='margin-top:-12px'>\")\n      .replace(/\\n?\\s*\\],?/g, '</div>')\n      .replace(/ *\"/g, '')\n      .replace(/\\n/g, '<br><br>')\n    })\n  }\n\n  exportCSV() {\n\n  }\n}\n","//@pageState()\nexport class App {\n\n  configureRouter(config, router){\n    this.routes  = router.navigation\n    config.title = 'SIRUM'\n    config.map([\n      { route: 'login',                            moduleId: 'views/login',     title:'Login',     nav:true},\n      { route: 'join',                             moduleId: 'views/join',      title:'Join',      nav:true},\n      { route: 'inventory',                        moduleId: 'views/inventory', title:'Inventory', nav:true, roles:[\"user\"]},\n      { route: ['shipments', 'shipments/:id', ''], moduleId: 'views/shipments', title:'Shipments', nav:true, roles:[\"user\"]},\n      { route: ['drugs', 'drugs/:id'],             moduleId: 'views/drugs',     title:'Drugs',     nav:true, roles:[\"user\"]},\n      { route: ['records', 'records/:id'],         moduleId: 'views/records',   title:'Records',   nav:true, roles:[\"user\"]},\n      { route: 'account',                          moduleId: 'views/account',   title:'Account',   nav:true, roles:[\"user\"]}\n    ])\n  }\n}\n","import {inject}     from 'aurelia-framework'\nimport {Router}     from 'aurelia-router'\nimport {Db}         from '../libs/pouch'\nimport {HttpClient} from 'aurelia-http-client'\nimport {csv}        from '../libs/csv'\nimport {canActivate, expShortcuts, qtyShortcuts, incrementBin, saveTransaction, focusInput, scrollSelect, toggleDrawer, drugSearch, waitForDrugsToIndex} from '../resources/helpers'\n\n//@pageState()\n@inject(Db, Router, HttpClient)\nexport class shipments {\n\n  constructor(db, router, http){\n    this.csv    = csv\n    this.db     = db\n    this.drugs  = []\n    this.router = router\n    this.http   = http\n    this.stati  = ['pickup', 'shipped', 'received']\n    this.shipments = {}\n    this.term  = ''\n\n    this.waitForDrugsToIndex = waitForDrugsToIndex\n    this.expShortcutsKeydown = expShortcuts\n    this.qtyShortcutsKeydown = qtyShortcuts\n    this.incrementBin    = incrementBin\n    this.saveTransaction = saveTransaction\n    this.focusInput      = focusInput\n    this.scrollSelect    = scrollSelect\n    this.toggleDrawer    = toggleDrawer\n    this.drugSearch      = drugSearch\n    this.canActivate     = canActivate\n  }\n\n  activate(params) {\n    return this.db.user.session.get()\n    .then(session  => {\n      this.user = session._id\n      return this.db.account.get(session.account._id)\n    })\n    .then(account => {\n      this.account = {_id:account._id, name:account.name}\n      this.ordered = {[account._id]:account.ordered}\n\n      //TODO From View\n      //Get all accounts that this account has authorized\n      //let doneeAccounts = this.db.account.allDocs({keys:account.authorized, include_docs:true})\n      //let shipmentsSent = this.db.shipment.query({'account.from._id':account._id})\n\n      //let recipientAccounts    = this.db.account.query('authorized', {key:account._id, include_docs:true}) //Get all accounts that have authorized this account\n      let senderAccounts    = this.db.account.allDocs({keys:account.authorized, include_docs:true})\n      let shipmentsReceived = this.db.shipment.allDocs({startkey:account._id+'\\uffff', endkey:account._id, descending:true, include_docs:true}) //Get all shipments to this account\n      return Promise.all([senderAccounts, shipmentsReceived]).then(all => {\n\n        [{rows:senderAccounts}, {rows:shipmentsReceived}] = all\n\n        //This abbreviated denormalized account information will be assigned to account.to/from\n        let selected, map = {to:{},from:{}}\n\n        this.accounts  = {\n          from:[''].concat(senderAccounts.map(({doc}) => {\n            this.ordered[doc._id] = doc.ordered\n            return map.from[doc._id] = {_id:doc._id, name:doc.name}\n          }))\n        }\n\n        //for (let account of recipientAccounts) makeMap(recipientMap, account)\n        //to:['', ...Object.keys(toMap).map(key => toMap[key])]\n\n        //Selected account != shipment.account.to because they are not references\n        this.shipment = {}\n        //, sent:shipmentsSent}\n        //shipmentsSent.forEach(makeReference)\n        //console.log('this.accounts', this.accounts)\n        //Sneak this in since we are already making the loop\n        let accountRef = role => {\n         return ({doc}) => {\n           this.setStatus(doc)\n\n           if (map[role][doc.account[role]._id])\n             doc.account[role] = map[role][doc.account[role]._id]\n\n           // if (toMap[doc.account.from._id])\n           //   doc.account.from = toMap[doc.account.from._id]\n           if (params.id === doc._id)\n             selected = doc\n\n           return doc\n         }\n        }\n\n        //Sent shipments get references to toAccount (since fromAccount will always be us)\n        //this.shipments.from = shipmentsSent.map(accountRef('to'))\n\n\n        this.role = selected //switch default role depending on shipment selection\n        ? {accounts:'to', shipments:'from'}\n        : {accounts:'from', shipments:'to'}\n\n        //Received shipments get references to fromAccount (since toAccount will always be us)\n        this.shipments.to = shipmentsReceived.map(accountRef('from'))\n\n        this.selectShipment(selected)\n        //this.waitForDrugsToIndex()\n      })\n      .catch(err => console.log('promise all err', err))\n\n\n      //this.db.account.find({selector:{authorized:account._id}})\n      // return Promise.all([\n      //   //Start all of our async tasks\n      //   this.db.account.get({authorized:accounts[0]._id}),\n      //   this.db.account.get({_id:{$gt:null, $in:accounts[0].authorized}}),\n      //   this.db.shipment.get({'account.from._id':accounts[0]._id}), //TODO this should be duplicative with _security doc.  We should be able to do _all_docs or no selector\n      //   this.db.shipment.get({'account.to._id':accounts[0]._id})\n      // ])\n    })\n    // .then(([fromAccounts, toAccounts, fromShipments, toShipments]) => {\n    //\n    // })\n  }\n\n  //Activated by activate() and each time a shipment is selected from drawer\n  selectShipment(shipment, toggleDrawer) {\n    if (toggleDrawer)\n      this.toggleDrawer()\n\n    if ( ! shipment) return this.emptyShipment()\n    this.setUrl('/'+shipment._id)\n    this.setShipment(shipment)\n    this.setTransactions(shipment._id)\n  }\n\n  emptyShipment() {\n    this.setUrl('')\n\n    if (this.role.shipments == 'to') {  //shipments received\n      this.setShipment({account:{to:this.account, from:{}}})\n      this.setTransactions()\n    } else { //shipments sent\n      this.setShipment({account:{from:this.account, to:{}}})\n      this.setTransactions(this.account._id)\n    }\n  }\n\n  setShipment(shipment) {\n    this.shipment     = shipment\n    this.shipmentId   = shipment._id  //freeze this if user started playing with \"move shipment\" select\n    this.attachment   = null\n  }\n\n  setUrl(url) {\n    this.router.navigate('shipments'+url, { trigger: false})\n  }\n\n  setTransactions(shipmentId) {\n\n    this.diffs = [] //Newly checked or unchecked checkboxes. Used to disable buttons if user has not done anything yet\n\n    if ( ! shipmentId)\n      return this.transactions = []\n\n    this.db.transaction.query('shipment._id', {key:[this.account._id, shipmentId], include_docs:true, descending:true}).then(res => {\n      this.transactions = res.rows.map(row => row.doc)\n      this.setCheckboxes()\n    })\n    .catch(err => console.log('err', err))\n  }\n\n  setCheckboxes() {\n    for (let transaction of this.transactions) {\n      transaction.isChecked = this.shipmentId == this.shipment._id ? transaction.verifiedAt : null\n    }\n  }\n\n  setStatus(shipment) {\n    shipment.status = this.stati.reduce((prev, curr) => shipment[curr+'At'] ? curr : prev)\n  }\n\n  swapRole() { //Swap donor-donee roles\n    [this.role.accounts, this.role.shipments] = [this.role.shipments, this.role.accounts]\n    this.selectShipment()\n    return true\n  }\n\n  //Save the donation if someone changes the status/date\n  saveShipment() {\n    //don't want to save status, but deleting causes weird behavior\n    //so instead copy the shipment and delete from copy then assign new rev\n    return this.db.shipment.put(this.shipment).then(res => {\n      this.setStatus(this.shipment)\n    })\n    //TODO reschedule pickup if a date was changed\n  }\n\n  //Move these items to a different \"alternative\" shipment then select it\n  //TODO need to select the new shipment once user confirms the move\n  moveTransactionsToShipment(shipment) {\n    //Change all selected transactions to the new or existing shipment\n    Promise.all(this.transactions.map(transaction => {\n      if (transaction.isChecked) {\n        transaction.shipment = {_id:shipment._id}\n        return this.db.transaction.put(transaction)\n      }\n    }))\n    .then(_ => this.selectShipment(shipment)) //Display existing shipment or the newly created shipment\n  }\n\n  //Create shipment then move inventory transactions to it\n  createShipment() {\n    if (this.shipment.tracking == 'New Tracking #')\n      delete this.shipment.tracking\n\n    //For some reason if you move this unshift() later, into the .then(), it will clear out the shipment\n    //TODO investigate why this is true?  Is it the filter function that causes problems?\n    this.shipments[this.role.shipments].unshift(this.shipment)\n    this.setStatus(this.shipment)\n\n    this.db.shipment.post(this.shipment)\n    .then(res => this.moveTransactionsToShipment(this.shipment)) //_id is needed for move but has not been set until now\n    .catch(err => console.error('createShipment error', err, this.shipment))\n  }\n\n  //Split functionality into Keydown and Input listeners because (keydown is set in constructor)\n  //Don't put this code into input because enter (which == 13) does not trigger input event.\n  //Don't put input code here because would then need a setTimeout for the quantity to actually change\n  //and you would need to ignore non-input key values.  So it cleaner to just keep these listeners separate\n  expShortcutsInput($index) {\n    this.autoCheck($index)\n  }\n\n  //Split functionality into Keydown and Input listeners because (keydown is set in constructor)\n  //Don't put this code into input because enter (which == 13) does not trigger input event.\n  //Don't put input code here because would then need a setTimeout for the quantity to actually change\n  //and you would need to ignore non-input key values.  So it cleaner to just keep these listeners separate\n  qtyShortcutsInput($event, $index) {\n    //Only run autocheck if the transaction was not deleted\n    this.removeTransactionIfQty0($event, $index) && this.autoCheck($index)\n  }\n\n  removeTransactionIfQty0($event, $index) {\n    //Delete an item in the qty is 0.  Instead of having a delete button\n\n    let transaction = this.transactions[$index]\n    let doneeDelete = ! transaction.qty.from && transaction.qty.to === 0\n    let donorDelete = ! transaction.qty.to   && transaction.qty.from === 0\n\n    if ( ! donorDelete && ! doneeDelete)\n      return true\n\n    this.drugs = [] //get rid of previous results since someone might press enter and accidentally readd the same drug\n    this.transactions.splice($index, 1) //Important to call splice before promise resolves since it will cancel the saveTransaction which would cause a conflict\n    //TODO get rid of this.diff as well in case this transaction was selected\n    this.db.transaction.remove(transaction)\n    this.focusInput(`md-autocomplete`)\n  }\n\n\n  binShortcuts($event, $index) {\n    if ($event.which == 13)\n      return this.focusInput(`md-autocomplete`)\n\n    return this.incrementBin($event, this.transactions[$index])\n  }\n\n  getLocation(transaction) {\n    return (this.getOrder(transaction) || {}).defaultLocation || this._location\n  }\n\n  setLocation(transaction) {\n    if (this.getLocation(transaction) != transaction.location)\n      this._location = transaction.location //Only prepopulate non-default locations into next transaction\n  }\n\n  aboveMinQty(order, transaction) {\n    let qty = transaction.qty[this.role.shipments]\n    if ( ! qty) return false\n    console.log('aboveMinQty', transaction)\n    let price      = transaction.drug.price.goodrx || transaction.drug.price.nadac || 0\n    let defaultQty = price > 1 ? 1 : 1 //keep expensive meds\n    let aboveMinQty = qty >= (+order.minQty || defaultQty)\n    if ( ! aboveMinQty) console.log('Ordered drug but qty', qty, 'is less than', +order.minQty || defaultQty)\n    return qty >= (+order.minQty || defaultQty)\n  }\n\n  aboveMinExp(order, transaction) {\n    let exp = transaction.exp[this.role.shipments]\n    if ( ! exp) return ! order.minDays\n    let minDays = order.minDays || 60\n    let aboveMinExp = new Date(exp) - Date.now() >= minDays*24*60*60*1000\n    if ( ! aboveMinExp) console.log('Ordered drug but expiration', exp, 'is before', minDays)\n    return aboveMinExp\n  }\n\n  belowMaxInventory(order, transaction) {\n    let newInventory = transaction.qty[this.role.shipments] + order.inventory\n    let maxInventory = order.maxInventory || 3000\n    let belowMaxInventory = isNaN(newInventory) ? true : newInventory < maxInventory //in case of an inventory error let's keep the drug\n    if ( ! belowMaxInventory) console.log('Ordered drug but inventory', newInventory, 'would be above max of', maxInventory) //\n    return belowMaxInventory\n  }\n\n  getOrder(transaction) {\n    return this.ordered[this.shipment.account.to._id][transaction.drug.generic]\n  }\n\n  isWanted(order, transaction) {\n    return order ? this.belowMaxInventory(order, transaction) && this.aboveMinQty(order, transaction) && this.aboveMinExp(order, transaction) : false\n  }\n\n  //If qty is 30 and user types \"3\" then destroyed message will display before user can type \"0\"\n  //this code puts a delay on the destroyed message and then clears it out if the user does type a \"0\"\n  //an alternative would be wait to trigger autocheck until enter is pressed but this would delay all messages\n  setDestroyedMessage(order) {\n    if (order && order.destroyedMessage && ! this.destroyedMessage)\n      this.destroyedMessage = setTimeout(_ => {\n        delete this.destroyedMessage\n        this.snackbar.show(order.destroyedMessage)\n      }, 500)\n  }\n\n  clearDestroyedMessage() {\n    clearTimeout(this.destroyedMessage)\n    delete this.destroyedMessage\n  }\n\n  //TODO should this only be run for the recipient?  Right now when donating to someone else this still runs and displays order messages\n  autoCheck($index) {\n    let transaction = this.transactions[$index]\n    let isChecked   = transaction.isChecked\n    let order       = this.getOrder(transaction)\n\n    if(this.isWanted(order, transaction) == isChecked)\n      return ! isChecked && transaction.qty.to > 0 && this.setDestroyedMessage(order) //isChecked may have never alternated for a destroyed drug so need to check\n\n    if (isChecked)\n      this.setDestroyedMessage(order)\n\n    if ( ! isChecked) {//manual check has not switched the boolean yet\n      this.snackbar.show(order.verifiedMessage || 'Drug is ordered')\n      this.clearDestroyedMessage()\n    }\n\n    this.manualCheck($index)\n  }\n\n  manualCheck($index) {\n    let transaction = this.transactions[$index]\n    transaction.isChecked = ! transaction.isChecked\n    //If user is not moving items, the shipment exists, and they are the recipient, then autosave their verificaton\n    //offsetParent is null when buttons are hidden.  This keeps us from duplicating the show logic of the buttons here\n    this.moveItemsButton.offsetParent\n      ? this.toggleSelectedCheck(transaction)\n      : this.toggleVerifiedCheck(transaction)\n  }\n\n  toggleVerifiedCheck(transaction) {\n\n    let verifiedAt = transaction.verifiedAt\n    let location   = transaction.location\n\n    if (verifiedAt) {\n      transaction.verifiedAt = null\n      transaction.location   = null\n    } else {\n      transaction.verifiedAt = new Date().toJSON()\n      transaction.location   = this.getLocation(transaction)\n    }\n\n    this.saveTransaction(transaction).catch(err => {\n      transaction.isChecked  = ! transaction.isChecked\n      transaction.verifiedAt = verifiedAt\n      transaction.location   = location\n    })\n  }\n\n  toggleSelectedCheck(transaction) {\n    let index = this.diffs.indexOf(transaction)\n    ~ index\n      ? this.diffs.splice(index, 1)\n      : this.diffs.push(transaction)\n  }\n\n  search() {\n    this.drugSearch().then(drugs => {\n      this.drugs = drugs\n      this.drug  = drugs[0]\n    })\n  }\n\n  //Enter in the autocomplete adds the selected transaction\n  //TODO support up/down arrow keys to pick different transaction?\n  autocompleteShortcuts($event) {\n\n    this.scrollSelect($event, this.drug, this.drugs, drug => this.drug = drug)\n\n    //Enter with a selected drug.  Force term to be falsey so a barcode scan which is entering digits does not trigger\n    if ($event.which == 13) {//Barcode scan means search might not be done yet\n      Promise.resolve(this._search).then(_ => this.addTransaction(this.drug))\n      return false //Enter was also triggering exp to qty focus\n    }\n\n    if ($event.which == 106 || ($event.shiftKey && $event.which == 56)) //* clearing autocomplete field with an asterick (to match exp date clearing and make numberpad compatible)\n      this.term = \"\"\n\n    return true  //still allow typing into autocomplete\n  }\n\n  addTransaction(drug, transaction) {\n\n    if ( ! drug)\n      return this.snackbar.show(`Cannot find drug matching this search`)\n\n    transaction = transaction || {\n      qty:{from:null, to:null},\n      exp:{\n        from:this.transactions[0] ? this.transactions[0].exp.from : null,\n        to:this.transactions[0] ? this.transactions[0].exp.to : null\n      }\n    }\n\n    transaction.drug = {\n      _id:drug._id,\n      brand:drug.brand,\n      generic:drug.generic,\n      generics:drug.generics,\n      form:drug.form,\n      price:drug.price,\n      pkg:drug.pkg\n    }\n\n    transaction.user       = {_id:this.user}\n    transaction.shipment   = {_id:this.shipment._id || this.account._id}\n\n    this.term = '' //Reset search's auto-complete\n\n    //Assume db query works.\n    this.transactions.unshift(transaction) //Add the drug to the view\n\n    let order        = this.getOrder(transaction)\n    let isPharMerica = /pharmerica.*/i.test(this.shipment.account.from.name)\n\n    //We set current inventory when adding a new transaction.  This is a tradeoff of frequency vs accurracy.  This will be inaccurate\n    //if user goes back and adjusts previous quantities to be higher since \"updating\" transaction would not trigger this code.  However,\n    //this is rare enough to be okay.  We also don't want to have to fetch current inventory on every input event.\n    order && this.db.transaction.query('inventory', {startkey:[drug.generic], endkey:[drug.generic+'\\uffff']})\n    .then(inventory => {\n      console.log('inventory', inventory)\n      order.inventory = inventory.rows[0] ? inventory.rows[0].value.total : 0\n      console.log('order.inventory', order.inventory)\n    })\n\n    isPharMerica && ! order //Kiah's idea of not making people duplicate logs for PharMerica, saving us some time\n      ? this.snackbar.show(`Destroy, record already exists`)\n      : setTimeout(_ => this.focusInput('#exp_0'), 50) // Select the row.  Wait for repeat.for to refresh (needed for dev env not live)\n\n    return this._saveTransaction = Promise.resolve(this._saveTransaction).then(_ => {\n      return this.db.transaction.post(transaction)\n      .catch(err => {\n        this.snackbar.error(`Transaction could not be added: `, err)\n        this.transactions.shift()\n      })\n    })\n  }\n\n  exportCSV() {\n    let name = 'Shipment '+this.shipment._id+'.csv'\n    this.csv.fromJSON(name, this.transactions.map(transaction => {\n      return {\n        '':transaction,\n        'next':JSON.stringify(transaction.next || []),\n        'drug._id':\" \"+transaction.drug._id,\n        'drug.generics':transaction.drug.generics.map(generic => generic.name+\" \"+generic.strength).join(';'),\n        shipment:this.shipment\n      }\n    }))\n  }\n\n  importCSV() {\n    this.csv.toJSON(this.$file.files[0], parsed => {\n      this.$file.value = ''\n      return Promise.all(parsed.map(transaction => {\n        transaction._err        = undefined\n        transaction._id          = undefined\n        transaction._rev         = undefined\n        transaction.shipment._id = this.shipment._id\n        transaction.next         = JSON.parse(transaction.next)\n        //This will add drugs upto the point where a drug cannot be found rather than rejecting all\n        return this.db.drug.get(transaction.drug._id)\n        .then(drug => this.addTransaction(drug, transaction))\n        .then(_ => undefined) //do not download successes\n        .catch(err => {\n          transaction._err = 'Upload Error: '+JSON.stringify(err)\n          return transaction //do download errors\n        })\n      }))\n    })\n    .then(rows => this.snackbar.show('Import Succesful'))\n    .catch(err => this.snackbar.error('Import Error', err))\n  }\n\n  // setAttachment(attachment) {\n  //   attachment._id  = this.attachment.name\n  //   attachment._rev = this.shipment._rev\n  //   this.db.shipment.attachment.put({_id:this.shipment._id, attachment:attachment})\n  //   .then(res => {\n  //     this.shipment._rev   = res.rev\n  //     this.attachment.type = attachment.type\n  //     //TODO use service worker to rename this URL so title bar isn't nasty\n  //     //http://stackoverflow.com/questions/283956/is-there-any-way-to-specify-a-suggested-filename-when-using-data-uri\n  //     this.attachment.url  = URL.createObjectURL(attachment)\n  //     console.log('setAttachment', attachment, _)\n  //   })\n  // }\n  //\n  // getAttachment() {\n  //   this.db.shipment.attachment.get({_id:this.shipment._id, name:this.attachment.name})\n  //   .then(attachment => {\n  //     this.attachment.type = attachment.type\n  //     this.attachment.url  = URL.createObjectURL(attachment)\n  //     console.log('getAttachment', attachment, this.attachment.url)\n  //   })\n  //   .catch(this.attachment.url = null)\n  // }\n}\n",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"sourceRoot":"../src"}