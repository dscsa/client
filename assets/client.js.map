{"version":3,"sources":["environment.js","elems/form.js","elems/md-autocomplete.js","elems/md-button.js","elems/md-checkbox.js","elems/md-drawer.js","elems/md-input.js","elems/md-loading.js","elems/md-menu.js","elems/md-select.js","elems/md-shadow.js","elems/md-snackbar.js","elems/md-switch.js","elems/md-table.js","elems/md-text.js","libs/csv.js","libs/pouch.js","resources/helpers.js","resources/value-converters.js","views/account.js","views/drugs.js","views/index.js","views/inventory.js","views/join.js","views/login.js","views/routes.js","views/shipments.js","/Users/adam/Dscsa/node_modules/client/src/elems/md-autocomplete.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-button.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-checkbox.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-drawer.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-input.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-loading.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-menu.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-select.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-snackbar.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-switch.html","/Users/adam/Dscsa/node_modules/client/src/elems/md-text.html","/Users/adam/Dscsa/node_modules/client/src/views/account.html","/Users/adam/Dscsa/node_modules/client/src/views/drugs.html","/Users/adam/Dscsa/node_modules/client/src/views/index.html","/Users/adam/Dscsa/node_modules/client/src/views/inventory.html","/Users/adam/Dscsa/node_modules/client/src/views/join.html","/Users/adam/Dscsa/node_modules/client/src/views/login.html","/Users/adam/Dscsa/node_modules/client/src/views/routes.html","/Users/adam/Dscsa/node_modules/client/src/views/shipments.html"],"names":["debug","testing","FormCustomAttribute","Element","element","change","bind","value","serialize","initialValue","inputElement","disabled","valid","formElement","checkValidity","cache","attached","closest","addEventListener","querySelector","setTimeout","s","elements","field","type","push","options","option","selected","join","MdAutocompleteCustomElement","name","defaultBindingMode","twoWay","toggleResults","$event","showResults","MdButtonCustomElement","click","stopPropagation","disabledChanged","button","input","class","classList","add","split","color","slice","fab","style","height","width","parentElement","tagName","padding","MdCheckboxCustomElement","tabindex","tabIndex","e","stopPropogation","checkedChanged","checked","label","MaterialCheckbox","checkToggleState","checkDisabled","componentHandler","upgradeAllRegistered","drawer","document","createElement","MdDrawerCustomElement","autofocus","hasAttribute","appendChild","header","parentNode","insertBefore","nextSibling","display","firstChild","detached","children","length","removeChild","MdInputCustomElement","valueChanged","div","MaterialTextfield","checkDirty","input_","dispatchEvent","Event","bubbles","upgradeElement","placeholder","remove","focus","MdLoadingCustomElement","val","MaterialProgress","setProgress","Math","min","MdMenuCustomElement","observer","id","Date","now","target","stopImmediatePropagation","setDisabled","li","setAttribute","removeAttribute","getObserver","subscribe","querySelectorAll","MdSelectCustomElement","MdShadowCustomAttribute","getAttribute","MdSnackbarCustomElement","show","opts","message","timeout","MaterialSnackbar","showSnackbar","error","msg","err","console","MdSwitchCustomElement","elem","MaterialSwitch","MdTableCustomAttribute","border","selectable","checkboxes","i","MdTextCustomElement","csv","toJSON","fromJSON","Pouch","pouchdbClient","expShortcuts","qtyShortcuts","removeTransactionIfQty0","incrementBin","saveTransaction","scrollSelect","focusInput","toggleDrawer","drugSearch","parseUserDate","toJsonDate","waitForDrugsToIndex","canActivate","$index","which","clearIfAsterick","transaction","transactions","doneeDelete","qty","from","to","donorDelete","drugs","splice","db","bin","call","shiftKey","_saveTransaction","Promise","resolve","then","put","catch","snackbar","curr","list","cb","index","indexOf","last","selector","fallback","log","search","generic","clearCache","start","terms","toLowerCase","replace","startsWith","_term","regex","RegExp","_drugs","filter","test","drug","query","range","map","addPkgCode","term","pkg","ndc9","upc","match","startkey","endkey","include_docs","res","rows","row","doc","ndc","all","deduped","results","_id","Object","keys","key","_savingDrug","trim","_search","date","year","pop","month","shift","drugIsIndexed","get","drugsIndexed","_","next","router","user","session","loggedIn","account","navigation","route","isVisible","config","roles","navModel","nav","currentInstruction","jsonValueConverter","toView","object","JSON","stringify","numberValueConverter","fromView","str","upperCaseValueConverter","toUpperCase","shipmentFilterValueConverter","shipments","shipment","tracking","status","drugFilterValueConverter","userFilterValueConverter","users","first","valueValueConverter","decimals","trigger","Array","isArray","reduce","total","price","goodrx","nadac","toFixed","boldValueConverter","text","bold","dateValueConverter","model","view","includes","sub","toArrayValueConverter","obj","sort","arr","reverse","csvHref","window","location","protocol","hostname","csvDate","activate","allDocs","accounts","selectUser","saveUser","addUser","unshift","post","reason","deleteUser","authorize","authorized","method","logout","disableLogout","delete","navigate","trace","importCSV","href","ajax","url","body","files","json","scrollDrugs","deactivate","removeEventListener","params","ordered","selectDrug","selectDrawer","scrollGroups","group","groups","selectGroup","autoselectDrug","inventory","autoselectGroup","generics","strength","form","order","undefined","saveOrder","exportCSV","ndcMap","capitalize","l","$file","errs","chain","brand","image","labeler","v","_err","addGeneric","removeGeneric","forms","addDrug","_rev","rev","errors","saveDrug","deleteDrug","configure","aurelia","warnings","use","standardConfiguration","plugin","globalResources","a","setRoot","limit","repack","pending","qtyShortcutsKeydown","reset","newURL","setTransactions","setPending","refreshPending","selectTerm","scrollTerms","sortTransactions","b","aPack","isRepacked","bPack","aBin","bBin","aExp","exp","bExp","aQty","bQty","toggleCheck","setCheck","isChecked","toggleVisibleChecks","setVisibleChecks","visible","filtered","inventoryFilterValueConverter","prototype","count","selectPending","pendingKey","pendingAt","selectInventory","refreshFilter","assign","updateSelected","updateFn","unsetPending","unpendInventory","pendInventory","createdAt","pendedAt","dispenseInventory","dispensed","disposeInventory","verifiedAt","repackInventory","repackQty","vialQty","vials","excessQty","totalQty","newTransactions","newTransaction","win","open","write","repeat","print","close","saveAndReconcileTransaction","qtyChange","excess","setRepackVials","floor","openMenu","qtyShortcutsInput","binShortcuts","ndcFilter","expFilter","repackFilter","formFilter","checkVisible","http","license","street","city","state","zip","phone","password","loading","resources","progress","syncing","login","App","configureRouter","routes","title","moduleId","stati","expShortcutsKeydown","senderAccounts","shipmentsReceived","descending","concat","accountRef","setStatus","role","selectShipment","emptyShipment","setUrl","setShipment","shipmentId","attachment","diffs","setCheckboxes","prev","swapRole","saveShipment","moveTransactionsToShipment","createShipment","expShortcutsInput","autoCheck","getBin","getOrder","defaultBin","_bin","setBin","aboveMinQty","defaultQty","minQty","aboveMinExp","minDays","belowMaxInventory","newInventory","maxInventory","isNaN","isWanted","setDestroyedMessage","destroyedMessage","clearDestroyedMessage","clearTimeout","verifiedMessage","manualCheck","moveItemsButton","offsetParent","toggleSelectedCheck","toggleVerifiedCheck","autocompleteShortcuts","addTransaction","warning","dialog","showModal","isPharMerica","dialogClose","parsed","parse"],"mappings":"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","file":"assets/client.js","sourcesContent":["export default {\n  debug: false,  //when either of these is true sourcemap is included\n  testing: false //when either of these is true sourcemap is included\n};\n","import {inject, bindable} from 'aurelia-framework';\n\n@bindable('disabled')\n@inject(Element)\nexport class FormCustomAttribute {\n\n  constructor(element) {\n    this.element = element\n    this.change  = this.change.bind(this)\n  }\n\n  change() {\n\n    if (this.value == 'onchange' && this.serialize() == this.initialValue)\n      return this.inputElement.disabled = true\n\n    //Here we cached response because assigning to elem.disabled everytime\n    //does not work if more than one input toggles on disabled (e.g., repacking form)\n    const valid = this.formElement && this.formElement.checkValidity()\n\n    if ( ! valid && ! this.cache) {\n      this.cache = ! this.inputElement.disabled\n      this.inputElement.disabled = true\n    }\n\n    if ( valid && this.cache) {\n      this.cache = false\n      this.inputElement.disabled = false\n    }\n  }\n\n  attached() {\n    //TODO allow attribute value to specify the form by name.\n    //TODO a detached method.  Are these event listeners leaking?\n    this.formElement = this.element.closest('form')\n    this.formElement.addEventListener('change', this.change)\n    this.formElement.addEventListener('input', this.change)\n\n    this.inputElement = this.element.querySelector('input,button,select') || this.element\n\n    this.initialValue = this.serialize()\n    //When going \"back\" to \"Create New Shipment\" form.checkValidity() would return true\n    //initially and then turn to false. setTimeout seems to eliminate this problem\n    setTimeout(this.change)\n  }\n\n  serialize() {\n    let s = []\n    for (let field of this.formElement.elements) {\n      if (field.type != 'select-multiple')\n        s.push(field.value)\n      else\n        for (let option of field.options)\n          if(option.selected)\n            s.push(option.value)\n    }\n    return s.join('&')\n  }\n}\n","import {bindable, bindingMode} from 'aurelia-framework';\n\n@bindable({name:'value', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('placeholder')\nexport class MdAutocompleteCustomElement {\n  toggleResults($event) {\n    //Foucusout removes the results from the view before the click on\n    //the selected result can register.  Delaying a bit prevents this\n    //http://stackoverflow.com/questions/18848738/click-event-not-triggered-after-focusout-event\n    setTimeout(() => this.showResults = ! this.showResults, 200)\n  }\n}\n","import {bindable, inject} from 'aurelia-framework';\n\n@bindable('form')\n@bindable('class')\n@bindable('raised')\n@bindable('fab')\n@bindable('disabled')\n@bindable('color')\n@inject(Element)\nexport class MdButtonCustomElement {\n\n  constructor(element) {\n    this.element = element\n    this.change  = this.change.bind(this)\n  }\n\n  //click.trigger won't trigger when button is disabled, but delegate will\n  //but we cant use trigger because $parent's delegate will still fire regardless\n  //so use delegate, but for some reason delegate stops bubbling even if we do\n  //\"return true\" so we need to to refire the event.\n  click($event) {\n    this.disabled && $event.stopPropagation()\n  }\n\n  disabledChanged() {\n    this.button && this.change()\n  }\n\n  change(input) {\n    this.disabled = this.disabled || this.disabled === ''\n  }\n\n  attached() {\n\n    //When going \"back\" to \"Create New Shipment\" form.checkValidity() would return true\n    //initially and then turn to false. setTimeout seems to eliminate this problem\n    setTimeout(this.change)\n\n    this.class && this.button.classList.add(...this.class.split(' '))\n    //attributes are made an empty string by default, so we can't just test for truthiness\n    //primary and accent are dynamic/reactive based on disable so need to be in the template.\n    if (typeof this.color == 'string' && this.color.slice(0, 4) != 'mdl-') {\n      this.color = 'mdl-button--'+(this.color || 'colored')\n    }\n\n    if (this.fab > 0) {\n      this.button.classList.add('mdl-button--fab')\n      this.button.style.height = this.fab+'px'\n      this.button.style.width  = this.fab+'px'\n      this.button.style['min-width'] = this.button.style.width\n      this.button.style['font-size'] = this.fab*.75+'px'\n      this.button.style['line-height'] = this.fab+'px'\n      //this.button.style['min-width'] = this.element.fab+'px'\n    }\n\n    if(this.element.parentElement.tagName == 'MD-DRAWER') {\n      this.button.style.width = \"100%\"\n      this.button.style.height = \"auto\"\n      this.button.style.padding = \"16px 8px\"\n      this.button.style['line-height'] = \"18px\"\n      //this.button.style['text-align'] = \"left\"\n    }\n  }\n\n}\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\n\n@bindable({name:'checked', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('required')\n@inject(Element)\nexport class MdCheckboxCustomElement {\n\n  constructor(element) {\n    this.tabindex = element.tabIndex\n    //Can't do this with <template click.delegate> since that overwrites authors delegate fn\n    element.addEventListener('click', e => this.disabled && e.stopPropagation())\n  }\n\n  //A click on input causes a UI change and then if aurelia is also listening for a\n  //click that causes a state change, then the two state changes cancel and it looks\n  //like the switch is locked.  Prevent this from happening.\n  stopPropogation() {\n    return true\n  }\n\n  //If we are relying on parent method returning true then this isn't needed,\n  //but if we are binding to check to change it programmatically we need this\n\n  checkedChanged() {\n    this.checked = !! this.checked //force boolean or we get weird behavior\n    setTimeout(_ => this.label && this.label.MaterialCheckbox && this.label.MaterialCheckbox.checkToggleState()) //checked hasn't actually been changed yet so wait for the change and then check\n  }\n\n  disabledChanged() {\n    setTimeout(_ => this.label && this.label.MaterialCheckbox.checkDisabled()) //disabled hasn't actually been changed yet so wait for the change and then check\n  }\n\n  attached() {\n    componentHandler.upgradeAllRegistered()\n    this.checkedChanged()\n    this.disabledChanged()\n  }\n}\n","import {inject} from 'aurelia-framework';\n\nlet drawer = document.createElement('nav')\ndrawer.classList.add(\"mdl-layout__drawer\")\n//console.log('drawer was created')\n\n@inject(Element)\nexport class MdDrawerCustomElement {\n\n  constructor(element) {\n    element.classList.add(\"mdl-navigation\")\n    element.style['padding-top'] = '6px'\n\n    this.autofocus = element.hasAttribute('autofocus')\n    //Move md-nav into the drawer\n    drawer.appendChild(element)\n    //console.log('drawer was constructed')\n  }\n\n  attached() {\n    this.header = document.querySelector('.mdl-layout__header')\n    this.header.parentNode.insertBefore(drawer, this.header.nextSibling)\n\n    componentHandler.upgradeAllRegistered()\n    //componentHandler.upgradeDom()\n\n    this.button = document.querySelector('.mdl-layout__drawer-button')\n\n    if (this.button)\n      this.button.style.display = 'block'\n\n    if (this.autofocus && this.header.firstChild)\n      this.header.firstChild.click()\n  }\n\n  detached() {\n    //New drawer is attached before old drawer is detached so children.length == 2\n    //except if going to view without a drawer (e.g login) in which length == 1\n    //console.log('detached', drawer.children.length)\n    if (drawer.children.length == 1 && this.button)\n      this.button.style.display = 'none'\n\n    //Empty the drawer\n    drawer.removeChild(drawer.firstChild)\n  }\n}\n","import {inject, bindable, bindingMode} from 'aurelia-framework';\n\n@bindable({name:'value', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('pattern')\n@bindable('step')\n@bindable('type')\n@bindable('placeholder')\n@bindable('input')\n@bindable('max')\n@bindable('min')\n@bindable('required')\n@bindable('minlength')\n@bindable('maxlength')\n@bindable('autofocus')\nexport class MdInputCustomElement {\n\n  valueChanged() {\n    setTimeout(_=> {\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDirty()\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkValidity()\n      this.div.MaterialTextfield.input_.dispatchEvent(new Event('change', {bubbles:true})) //this is to trigger formCustomAttribute and others to reevaluate\n    })\n  }\n\n  disabledChanged() {\n    setTimeout(_ => {\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDisabled()\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkValidity()\n      this.div.MaterialTextfield.input_.dispatchEvent(new Event('change', {bubbles:true})) //this is to trigger formCustomAttribute and others to reevaluate\n    })  //disabled hasn't actually been changed yet so wait for the change and then check\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.div)\n\n    if ( ! this.placeholder)\n      this.div.classList.remove('has-placeholder')\n\n    if (this.autofocus || this.autofocus === '')\n      this.div.MaterialTextfield.input_.focus()\n  }\n}\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\n\n@bindable('value')\nexport class MdLoadingCustomElement {\n\n  valueChanged(val) {\n    setTimeout(_=> this.div && this.div.MaterialProgress.setProgress(Math.min(val, 100)))\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.div)\n  }\n}\n","import {ObserverLocator, bindable, inject} from 'aurelia-framework';\n\n@inject(ObserverLocator, Element)\nexport class MdMenuCustomElement {\n\n  constructor(observer, element) {\n    //Router add both pages to view at same time.  This confuses the MDL library\n    //which add the button's click handler to the previous page rather than the\n    //next page since the two ids are the same.  Prevent this by randomly generating\n    //the id.  Also 'for.bind' doesn't seem to work so using synomym data-md-for\n    this.id = 'id'+Date.now()\n    this.element = element\n    this.observer = observer\n  }\n\n  click($event) {\n    if ($event.target.tagName == 'INPUT' || $event.target.disabled)\n      $event.stopImmediatePropagation()\n\n    return true //needed to continue a propogation of an <a> link\n  }\n\n  setDisabled(li, disabled) {\n    disabled\n      ? li.setAttribute('disabled', '')\n      : li.removeAttribute('disabled')\n  }\n\n  attached() {\n    for (let li of this.element.querySelectorAll('li')) {\n      li.classList.add('mdl-menu__item')\n      this.setDisabled(li, li.disabled)\n      this.observer.getObserver(li, 'disabled').subscribe(disabled => {\n        this.setDisabled(li, disabled)\n      })\n    }\n  }\n}\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\n\n@bindable({name:'value', defaultBindingMode: bindingMode.twoWay})\n@bindable('style')\n@bindable('options')\n@bindable('disabled')\n@bindable('default')\n@bindable('required')\n@bindable('property')\nexport class MdSelectCustomElement {\n\n  //need when toggling back and forth on shipments page to make sure from/to account disables where updated\n  disabledChanged() {\n    setTimeout(_=> this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDisabled())\n  }\n\n  valueChanged() {\n    setTimeout(_=> this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDirty())\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.div)\n  }\n}\n","import {inject} from 'aurelia-framework';\n\n@inject(Element)\nexport class MdShadowCustomAttribute {\n\n  constructor(element) {\n    element.classList.add(\"mdl-shadow--\"+element.getAttribute('md-shadow')+\"dp\")\n  }\n}\n","import {bindable, inject} from 'aurelia-framework';\n\n@bindable('show')\n@inject(Element)\nexport class MdSnackbarCustomElement {\n\n  constructor(element) {\n    this.element = element\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.element)\n    this.element.show = opts => {\n      if (typeof opts == 'string')\n        opts = {message:opts, timeout:5000}\n\n      this.element.MaterialSnackbar.showSnackbar(opts)\n    }\n    this.element.error = (msg, err) => {\n      if ( ! err) {\n        err = msg\n        msg = ''\n      }\n      msg = `${msg} ${err.message}`\n      this.element.show(msg)\n      console.error(msg, err)\n      return err\n    }\n  }\n}\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\n\n@bindable({name:'checked', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('required')\n@inject(Element)\nexport class MdSwitchCustomElement {\n\n  constructor(elem) {\n    //Do not propogate click if element is disabled\n    //Can't do this with <template click.delegate> since that overwrites authors delegate fn\n    elem.addEventListener('click', e => this.disabled && e.stopPropagation())\n  }\n\n  //A click on input causes a UI change and then if aurelia is also listening for a\n  //click that causes a state change, then the two state changes cancel and it looks\n  //like the switch is locked.  Prevent this from happening.\n  //https://www.kirupa.com/html5/event_capturing_bubbling_javascript.htm\n  stopPropogation() {\n    return true\n  }\n\n  //If we are relying on parent returning true then this isn't needed, but\n  //if we are binding to check to change it programmatically we need this\n  checkedChanged() {\n    this.checked = !! this.checked\n    setTimeout(_ => this.label && this.label.MaterialSwitch.checkToggleState()) //checked hasn't actually been changed yet so wait for the change and then check\n  }\n\n  disabledChanged() {\n    setTimeout(_ => this.label && this.label.MaterialSwitch.checkDisabled()) //disabled hasn't actually been changed yet so wait for the change and then check\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.label)\n    this.checkedChanged()\n    this.disabledChanged()\n  }\n}\n","import {inject} from 'aurelia-framework';\n\n@inject(Element)\nexport class MdTableCustomAttribute {\n\n  constructor(element) {\n\n    element.classList.add(\"mdl-data-table\")\n    element.classList.add(\"mdl-js-data-table\")\n    element.style.border = \"none\"\n\n    if (element.getAttribute('md-table'))\n      element.classList.add(\"mdl-data-table--selectable\")\n\n    this.element = element\n    //this.checkboxes = element.querySelector('')\n  }\n\n  valueChanged(selectable) {\n\n    let checkboxes = this.element.querySelectorAll('input[type=\"checkbox\"]')\n\n    for (var i=0; i < checkboxes.length; i++) {\n      checkboxes[i].disabled = selectable == 'false'\n    }\n  }\n\n  attached() {\n\n    componentHandler.upgradeAllRegistered()\n  }\n}\n","import {bindable, bindingMode} from 'aurelia-framework';\n\n@bindable({name:'value', defaultBindingMode: bindingMode.twoWay})\n@bindable('disabled')\n@bindable('placeholder')\n@bindable('required')\n@bindable('autofocus')\nexport class MdTextCustomElement {\n\n  valueChanged() {\n    setTimeout(_=> {\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDirty()\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkValidity()\n    })\n  }\n\n  disabledChanged() {\n    setTimeout(_ => {\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkDisabled()\n      this.div && this.div.MaterialTextfield && this.div.MaterialTextfield.checkValidity()\n    }) //disabled hasn't actually been changed yet so wait for the change and then check\n  }\n\n  attached() {\n    componentHandler.upgradeElement(this.div)\n\n    if ( ! this.placeholder)\n      this.div.classList.remove('has-placeholder')\n\n    if (this.autofocus || this.autofocus === '')\n      this.div.MaterialTextfield.input_.focus()\n  }\n}\n","export let csv = {toJSON, fromJSON}\n","export class Pouch {\n  constructor() {\n    return pouchdbClient\n  }\n}\n","\nexport function expShortcuts($event, $index) {\n  //Enter should focus on quantity\n  if ($event.which == 13)\n    return this.focusInput(`#qty_${$index}`)\n\n  return true\n}\n\nexport function qtyShortcuts($event, $index) {\n  //Enter should focus on rx_input, unless it is hidden\n  if ($event.which == 13)\n    return this.focusInput(`#bin_${$index}`, `md-autocomplete`)\n\n  return clearIfAsterick($event)\n}\n\nexport function removeTransactionIfQty0($event, $index) {\n  //Delete an item in the qty is 0.  Instead of having a delete button\n\n  let transaction = this.transactions[$index]\n  let doneeDelete = ! transaction.qty.from && transaction.qty.to === 0\n  let donorDelete = ! transaction.qty.to   && transaction.qty.from === 0\n\n  if ( ! donorDelete && ! doneeDelete)\n    return true\n\n  this.drugs = [] //get rid of previous results since someone might press enter and accidentally readd the same drug\n  this.transactions.splice($index, 1) //Important to call splice before promise resolves since it will cancel the saveTransaction which would cause a conflict\n  //TODO get rid of this.diff as well in case this transaction was selected\n  this.db.transaction.remove(transaction)\n  this.focusInput(`md-autocomplete`)\n}\n\nexport function incrementBin($event, transaction) {\n  if ($event.which == 107 || $event.which == 187) { // + key on numpad, keyboard\n    transaction.bin = transaction.bin[0]+(+transaction.bin.slice(1)+1)\n    saveTransaction.call(this, transaction)\n    return false //don't actually add the +\n  }\n\n  if ($event.which == 109 || $event.which == 189) {// - key on numpad, keyboard\n    transaction.bin = transaction.bin[0]+(+transaction.bin.slice(1)-1)\n    saveTransaction.call(this, transaction)\n    return false //don't actually add the -\n  }\n\n  return clearIfAsterick($event)\n}\n\nfunction clearIfAsterick($event) {\n  return $event.which == 106 || ($event.shiftKey && $event.which == 56) ? $event.target.value = \"\" : true\n}\n\nexport function saveTransaction(transaction) {\n  return this._saveTransaction = Promise.resolve(this._saveTransaction).then(_ => {\n    return this.db.transaction.put(transaction)\n  }).catch(err => {\n    delete this._saveTransaction //otherwise subsequent saves will keep showing same error\n    //throw to continue to propogate error if our other code wants to catch\n    throw this.snackbar.error(err)\n  })\n}\n\n//Callback must take the selected item as its first argument\nexport function scrollSelect($event, curr, list = [], cb) {\n\n  let index = list.indexOf(curr)\n  let last  = list.length - 1\n\n  if ($event.which == 38) //Keyup\n    cb.call(this, list[index > 0 ? index - 1 : last])\n\n  if ($event.which == 40) //keydown\n    cb.call(this, list[index < last ? index+1 : 0])\n}\n\nexport function focusInput(selector, fallback) {\n  let elem = document.querySelector(`${selector} input`)\n\n  if (elem && ! elem.disabled)\n    elem.focus()\n  else if (fallback)\n    document.querySelector(`${fallback} input`).focus()\n  else\n    console.log(`Cannot find ${selector} input`)\n\n  return false\n}\n\nexport function toggleDrawer() {\n  let drawer = document.querySelector('.mdl-layout__header')\n  drawer && drawer.firstChild.click() //view might not be attached yet meaning selector is null\n}\n\n\nlet search = {\n  generic(generic, clearCache) {\n    const start = Date.now()\n    const terms = generic.toLowerCase().replace('.', '\\\\.').split(/, |[, ]/g)\n\n    //We do caching here if user is typing in ndc one digit at a time since PouchDB's speed varies a lot (50ms - 2000ms)\n    if (generic.startsWith(search._term) && ! clearCache) {\n      const regex = RegExp('(?=.*'+terms.join(')(?=.*( |0)')+')', 'i') //Use lookaheads to search for each word separately (no order).  Even the first term might be the 2nd generic\n      return search._drugs.then(drugs => drugs.filter(drug => regex.test(drug.generic))).then(drugs => {\n        console.log('generic filter returned', drugs.length, 'rows and took', Date.now() - start, 'term', generic, 'cache', search._term)\n        search._term = generic\n        return drugs\n      })\n    }\n\n    search._term = generic\n\n    return search._drugs = this.db.drug.query('generics.name', search.range(terms[0])).then(search.map(start))\n  },\n\n  addPkgCode(term, drug) {\n    var pkg, ndc9, upc\n    if (term.length > 8) {\n      ndc9 = '^'+drug.ndc9+'(\\\\d{2})$'\n      upc  = '^'+drug.upc+'(\\\\d{'+(10 - drug.upc.length)+'})$'\n      pkg  = term.match(RegExp(ndc9+'|'+upc))\n    }\n\n    drug.pkg = pkg ? pkg[1] || pkg[2] : ''\n    return drug\n  },\n\n  range(term) {\n    return {startkey:term, endkey:term+'\\uffff', include_docs:true}\n  },\n\n  map(start) {\n    return res => {\n      console.log('query returned', res.rows.length, 'rows and took', Date.now() - start)\n      return res.rows.map(row => row.doc)\n    }\n  },\n\n  //For now we make this function stateful (using \"this\") to cache results\n  ndc(ndc, clearCache) {\n    const start = Date.now()\n    var term = ndc.replace(/-/g, '')\n\n    //This is a UPC barcode ('3'+10 digit upc+checksum).\n    if (term.length == 12 && term[0] == '3')\n      term = term.slice(1, -1)\n\n    var ndc9 = term.slice(0, 9)\n    var upc  = term.slice(0, 8)\n\n    //We do caching here if user is typing in ndc one digit at a time since PouchDB's speed varies a lot (50ms - 2000ms)\n    if (term.startsWith(search._term) && ! clearCache) {\n      console.log('FILTER', 'ndc9', ndc9, 'upc', upc, 'term', term, 'this.term', search._term)\n      return search._drugs.then(drugs => drugs.filter(drug => {\n        search.addPkgCode(term, drug)\n        //If upc.length = 9 then the ndc9 code should await a match, otherwise the upc  which is cutoff at 8 digits will have false positives\n        return drug.ndc9.startsWith(ndc9) || (drug.upc.length != 9 && term.length != 11 && drug.upc.startsWith(upc))\n      }))\n    }\n\n    console.log('QUERY', 'ndc9', ndc9, 'upc', upc, 'term', term, 'this.term', search._term)\n\n    search._term = term\n\n    ndc9 = this.db.drug.query('ndc9', search.range(ndc9)).then(search.map(start))\n\n    upc = this.db.drug.query('upc', search.range(upc)).then(search.map(start))\n\n    //TODO add in ES6 destructuing\n    return search._drugs = Promise.all([upc, ndc9]).then(results => {\n\n      let deduped = {}\n\n      for (const drug of results[0])\n        if (drug.upc.length != 9 && term.length != 11) //If upc.length = 9 then the ndc9 code should await a match, otherwise the upc which is cutoff at 8 digits will have false positives\n          deduped[drug._id] = drug\n\n      for (const drug of results[1])\n          deduped[drug._id] = drug\n\n      deduped = Object.keys(deduped).map(key => search.addPkgCode(term, deduped[key]))\n      console.log('query returned', deduped.length, 'rows and took', Date.now() - start)\n      return deduped\n    })\n  }\n}\n\nexport function drugSearch() {\n  if ( ! this.term || this.term.length < 3)\n    return Promise.resolve([])\n\n  //When adding a new NDC for an existing drug search term is the same but we want the\n  //results to display the new drug too, so we need to disable filtering old results\n  const clearCache = this._savingDrug\n  const term = this.term.trim()\n\n  //always do searches serially\n  return this._search = Promise.resolve(this._search).then(_ => {\n    return search[/^[\\d-]+$/.test(term) ? 'ndc' : 'generic'].call(this, term, clearCache)\n  })\n}\n\n//whether mm/yy or mm/dd/yy, month is always first and year is always last\nexport function parseUserDate(date) {\n  date = (date || \"\").split('/') //can't do default arugment because can be null as well as undefined\n  return {\n    year:date.pop(),\n    month:date.shift()\n  }\n}\n\n//To get last day in month, set it to next month and subtract a day\n// export function toJsonDate({month, year}) {\n//   let date = new Date('20'+year,month, 1)\n//   date.setDate(0)\n//   return date.toJSON()\n// }\n//Can't round up must round down\nexport function toJsonDate({month, year}) {\n  console.log('date', month, year, new Date('20'+year,month-1, 1).toJSON())\n  return new Date('20'+year,month-1, 1).toJSON()\n}\n\n//Calls the direct query to pouch to wait on the drug database being synced. Then it\n//reopens the search field and changes the placeholder.\nexport function waitForDrugsToIndex(){\n  this.db.drug.drugIsIndexed.get().then(_ => {\n   this.drugsIndexed = true\n   this.placeholder = \"Search Drugs By Generic Name Or NDC...\"\n  })\n}\n\nimport {Redirect} from 'aurelia-router'\n\nexport function canActivate(_, next, {router}) {\n  return this.db.user.session.get().then(session => {\n\n    let loggedIn = session && session.account\n\n    for (let route of router.navigation)\n        route.isVisible = loggedIn\n          ? route.config.roles && ~route.config.roles.indexOf('user')\n          : ! route.config.roles\n\n    let canActivate = next.navModel.isVisible || ! next.nav\n\n    return canActivate || router.currentInstruction\n      ? canActivate\n      : new Redirect(loggedIn ? 'shipments' : 'login')\n  })\n  .catch(err => console.log('loginRequired error', err))\n}\n"," import {toJsonDate, parseUserDate} from '../resources/helpers'\n\n//http://stackoverflow.com/questions/32017532/observe-property-on-an-array-of-objects-for-any-changes\nexport class jsonValueConverter {\n  toView(object = null){\n    return JSON.stringify(object, null, \" \")\n  }\n}\n\nexport class numberValueConverter {\n  fromView(str){\n    return str === '' ? null : +str\n  }\n}\n\nexport class upperCaseValueConverter {\n  fromView(str) {\n    return str == null ? null : str.toUpperCase()\n  }\n}\n\nexport class shipmentFilterValueConverter {\n  toView(shipments = [], filter = ''){\n    filter = filter.toLowerCase()\n    return shipments.filter(shipment => {\n      return ~ `${shipment.account.from.name} ${shipment.account.to.name} ${shipment.tracking} ${shipment.status} ${shipment._id && shipment._id.slice(0, 10)}`.toLowerCase().indexOf(filter)\n    })\n  }\n}\n\nexport class drugFilterValueConverter {\n  toView(drugs = [], filter = ''){\n    filter = filter.replace('.', '\\\\.').split(/, |[, ]/g)\n    var regex = RegExp('(?=.*'+filter.join(')(?=.*( |0)')+')', 'i') //Use lookaheads to search for each word separately (no order).  Even the first term might be the 2nd generic\n    return drugs.filter(drug => regex.test(drug.generic))\n  }\n}\n\n//TODO make this work with added items\nexport class userFilterValueConverter {\n  toView(users = [], filter = ''){\n    filter = filter.toLowerCase()\n    let res = users.filter(user => {\n      try {\n        return ~ `${user.name.first} ${user.name.last}`.toLowerCase().indexOf(filter)\n      }\n      catch (err) {\n        console.log('filter err', user, err)\n      }\n    })\n    return res\n  }\n}\n\nexport class valueValueConverter {\n  toView(transactions = [], decimals, trigger) {\n\n    transactions = Array.isArray(transactions) ? transactions : [transactions]\n\n    return transactions.reduce((total, transaction) => {\n      if ( ! transaction.drug.price || ! transaction.qty) return 0\n      let price = transaction.drug.price.goodrx || transaction.drug.price.nadac || 0\n      let   qty = transaction.qty.to || transaction.qty.from || 0\n      return total + qty * price\n    }, 0).toFixed(decimals)\n  }\n}\n\nexport class boldValueConverter {\n  toView(text, bold){\n    if ( ! bold || ! text) return text\n\n    if (typeof bold == 'string') //Handle a strength of 0.5mg and .5mg interchangeably\n      bold = RegExp('('+bold.replace(/ /g, '|').replace('.', '( | 0)?\\\\.')+')', 'gi')\n\n    return text.replace(bold, '<strong>$1</strong>')\n  }\n}\n\nexport class dateValueConverter {\n\n  toView(date) {\n    if ( ! date ) return ''\n    return date != this.model ? date.slice(5,7)+'/'+date.slice(2,4) : this.view\n  }\n\n  fromView(date){\n\n    if (date.includes('*'))\n      return null\n\n    let add = date.includes('+') || date.includes('=')\n    let sub = date.includes('-')\n\n    let {month, year} = parseUserDate(date.replace(/\\+|\\-|\\=/g, ''))\n\n    if (year.length > 2) //without this if user accidentally typed an extra character it would cause ongoing save error\n      year = year.slice(0, 2)\n\n    if (add) month++\n    if (sub) month--\n\n    if (month == 0) {\n      month = 12\n      year--\n    }\n\n    if (month == 13) {\n      month = 1\n      year++\n    }\n\n    //Keep zerp padding in front of the month which is lost when month changes\n    this.view = (\"00\"+month).slice(-2)+'/'+year\n\n    return this.model = toJsonDate({month, year})\n  }\n}\n\nexport class toArrayValueConverter {\n  toView(obj = {}, sort){\n\n    let arr = Object.keys(obj)\n\n    if (sort) arr.sort().reverse()\n\n    return arr.map(key => {\n      return {key, val:obj[key]}\n    })\n  }\n}\n","import {inject} from 'aurelia-framework';\nimport {Pouch}     from '../libs/pouch'\nimport {Router} from 'aurelia-router'\nimport {canActivate} from '../resources/helpers'\n\n//TODO this is causing Router to revert route and switches to not be upgraded @pageState()\n@inject(Pouch, Router)\nexport class account {\n\n  constructor(db, router){\n    this.db           = db\n    this.router       = router\n    this.canActivate  = canActivate\n    this.csvHref = window.location.protocol+'//'+window.location.hostname\n    this.csvDate = `${new Date().toJSON().slice(0, -8)}`\n  }\n\n  activate() {\n\n    this.db.user.session.get().then(session => {\n\n      this.session = session\n\n      //TODO allow a valueConverter for each state or do a new search\n      this.db.account.allDocs({include_docs:true, endkey:'_design'}).then(accounts => {\n        this.accounts = accounts.rows.map(account => account.doc).filter(account => {\n          if (account._id != session.account._id)\n            return true\n          this.account = account\n        })\n      })\n\n      return this.db.user.query('account._id', { key:session.account._id, include_docs:true})\n      .then(users => {\n        this.users = users.rows.map(user => user.doc)\n        this.selectUser()\n      })\n    })\n  }\n\n  selectUser(user) {\n    this.user = user || this.users.filter(user => user._id == this.session._id)[0]\n  }\n\n  saveUser() {\n    this.user._id && this.db.user.put(this.user)\n    return true\n  }\n\n  addUser() {\n    this.users.unshift(this.user)\n    this.db.user.post(this.user)\n    .catch(err => {\n      this.users.shift()\n      this.snackbar.show(err.message || err.reason)\n    })\n  }\n\n  deleteUser() {\n    let index = this.users.indexOf(this.user)\n    this.db.user.remove(this.user).then(_ => {\n      this.users.splice(index, 1)\n      this.selectUser()\n    })\n    .catch(err => {\n      console.log(err)\n      this.snackbar.show(err.message || err.reason)\n    })\n  }\n\n  //Simple debounce doesn't work here to prevent double click\n  //because account is not authorized until the db returns\n  //which means isAuthorized isn't updated yet for the since click\n  authorize(_id) {\n    console.log('account.authorize', _id, this.account.authorized)\n    let index  = this.account.authorized.indexOf(_id)\n    let method = ~ index ? 'delete' : 'post'\n    this.db.account.authorized[method](_id).then(res => this.account.authorized = res.authorized)\n    //TODO reset checkbox and show snackbar if change not made\n  }\n\n  logout() {\n    this.disableLogout = 'Uninstalling...'\n    this.db.user.session.delete().then(_ => {\n      this.router.navigate('login', {trigger:true})\n    })\n    .catch(err => console.trace('Logout failed:',err))\n  }\n\n  importCSV($event) {\n    this.snackbar.show(`Uploading CSV File`) //'transaction.csv'\n    const elem = $event.target\n    console.log(elem.parentNode.parentNode.getAttribute('href'), elem.parentNode.parentNode.href, elem.parentNode.parentNode)\n    return this.db.ajax({method:'post', url:elem.parentNode.parentNode.getAttribute('href'), body:elem.files[0], json:false})\n    .then(rows => this.snackbar.show('Import Succesful'))\n    .catch(err => this.snackbar.error('Import Error', err))\n  }\n}\n","import {inject} from 'aurelia-framework'\nimport {Router} from 'aurelia-router'\nimport {Pouch}     from '../libs/pouch'\nimport {csv}    from '../libs/csv'\nimport {canActivate, scrollSelect, toggleDrawer, drugSearch} from '../resources/helpers'\n\n\n//@pageState()\n@inject(Pouch, Router)\nexport class drugs {\n  constructor(db, router){\n    this.csv    = csv\n    this.db     = db\n    this.router = router\n    this.term   = ''\n    this.scrollDrugs = this.scrollDrugs.bind(this)\n\n    this.toggleDrawer = toggleDrawer\n    this.scrollSelect = scrollSelect\n    this.drugSearch   = drugSearch\n    this.canActivate = canActivate\n  }\n\n  deactivate() {\n    removeEventListener('keyup', this.scrollDrugs)\n  }\n\n  activate(params) {\n\n    addEventListener('keyup', this.scrollDrugs)\n    return this.db.user.session.get()\n    .then(session => {\n      return this.db.account.get(session.account._id)\n    })\n    .then(account => {\n      this.account = account\n      this.drawer  = {\n        ordered:Object.keys(this.account.ordered).sort()\n      }\n\n      if (params.id)\n        return this.db.drug.get(params.id).then(drug => {\n          this.selectDrug(drug, true)\n        })\n\n      if (this.drawer.ordered[0])\n        return this.selectDrawer(this.drawer.ordered[0])\n\n      return this.selectDrug()\n    })\n  }\n\n  scrollGroups($event) {\n    Promise.resolve(this._search).then(_ => {\n      //group won't be a reference so we must search manually\n      this.scrollSelect($event, this.group, this.groups, group => this.selectGroup(group, true))\n\n      if ($event.which == 13)//Enter get rid of the results\n        this.selectGroup(null, true)\n    })\n\n    $event.stopPropagation() //scrolling groups doesn't need to scroll drugs as well\n  }\n\n  scrollDrugs($event) {\n    this.group && this.scrollSelect($event, this.drug, this.group.drugs, this.selectDrug)\n  }\n\n  //Three entrances.\n  //1) User searches and then selects group from autocomplete (group already supplied)\n  //2) selectDrawer and we need to find the group with that particular generic name\n  //3) selectDrug and we need to find the group with that particular generic name\n  selectGroup(group, autoselectDrug) {\n    console.log('selectGroup()', group.name, this.drug && this.drug.generic)\n\n    this.term = group.name\n    this.db.transaction.query('inventory.drug.generic', {key:[this.account._id, group.name], include_docs:true}).then(inventory => {\n      this.inventory = inventory.rows[0] && inventory.rows[0].qty\n    })\n\n    if ( ! group.drugs) //Not set if called from selectDrug or selectDrawer\n      group.drugs = this.search().then(_ => {\n        //Use filter to get an exact match not just one ingredient\n        return this.groups.length ? this.groups.filter(group => this.term == group.name)[0].drugs : []\n      })\n\n    Promise.resolve(group.drugs).then(drugs => {\n      group.drugs = drugs\n      this.group  = group\n      //TODO if this was called by selectDrug then we should establish establish a reference\n      //between the approriate this.group.drugs and this.drug so that changes to the drug\n      //appear in realtime on the right hand side.  This works if selectGroup\n      if (autoselectDrug)\n        this.selectDrug(group.drugs[0])\n    })\n  }\n\n  selectDrug(drug, autoselectGroup) {\n    //Default is for Add Drug menu item in view\n    console.log('selectDrug()', this.group && this.group.name, drug && drug.generic)\n    this.drug = drug || {\n      generics:this.drug ? this.drug.generics : [{name:'', strength:''}],\n      form:this.drug && this.drug.form\n    }\n\n    let url = this.drug._id ? 'drugs/'+this.drug._id : 'drugs'\n    this.router.navigate(url, { trigger: false })\n\n    if (autoselectGroup)\n      this.selectGroup({name:this.drug.generic || this.term})\n  }\n\n  selectDrawer(generic) {\n    this.selectGroup({name:generic}, true)\n    this.toggleDrawer()\n  }\n\n  search() {\n    return this.drugSearch().then(drugs => {\n      let groups = {}\n      for (let drug of drugs) {\n        groups[drug.generic] = groups[drug.generic] || {name:drug.generic, drugs:[]}\n        groups[drug.generic].drugs.push(drug)\n      }\n      this.groups = Object.keys(groups).map(key => groups[key])\n    })\n  }\n\n  //We might make a separate database and API out of this one day, but for now just save on account object.\n  //TODO: Warn on delete since we won't save save any of the preferences?\n  order() {\n    console.log('before order()', this.group.name, this.drug.generic)\n\n    if (this.account.ordered[this.group.name]) {\n      //Delete this group from the drawer drawer\n      this.drawer.ordered = this.drawer.ordered.filter(generic => {\n        return generic != this.group.name\n      })\n\n      this.account.ordered[this.group.name] = undefined\n    } else {\n      //Add New Order but Keep Add New Item on Top\n      this.drawer.ordered.unshift(this.group.name)\n      this.account.ordered[this.group.name] = {}\n    }\n    console.log('after order()', this.group.name, this.drug.generic)\n    this.saveOrder()\n  }\n\n  exportCSV(generic) {\n    let inventory = this.db.transaction.query('inventory', {key:[this.account._id]})\n    let drugs = this.db.drug.allDocs({include_docs:true, endkey:'_design'})\n    Promise.all([inventory, drugs]).then(([inventory, drugs]) => {\n      console.log('Export queries run')\n      let ndcMap = {}\n      for (const row of inventory.rows) {\n        ndcMap[row.key[2]] = row.value\n      }\n      console.log('Inital map complete')\n      this.csv.fromJSON(`Drugs ${new Date().toJSON()}.csv`, drugs.rows.map(row => {\n        return {\n          order:this.account.ordered[row.doc.generic],\n          '':row.doc,\n          upc:\"UPC \"+row.doc.upc,\n          ndc9:\"NDC9 \"+row.doc.ndc9,\n          generics:row.doc.generics.map(generic => generic.name+\" \"+generic.strength).join(';'),\n          inventory:ndcMap[row.doc._id]\n        }\n      }))\n    })\n  }\n\n  importCSV() {\n    this.snackbar.show(`Parsing csv file`)\n    function capitalize(text) {\n      return text ? text.trim().toLowerCase().replace(/\\b[a-z]/g, l => l.toUpperCase()) : text\n    }\n    function trim(text) {\n      return text ? text.trim() : text\n    }\n\n    this.csv.toJSON(this.$file.files[0], drugs => {\n      this.$file.value = ''\n      let errs  = []\n      let chain = Promise.resolve()\n\n      for (let i in drugs) {\n        chain = chain\n        .then(_ => {\n          let drug = drugs[i]\n\n          drug = {\n            _id:trim(drug._id),\n            brand:trim(drug.brand),\n            form:capitalize(drug.form),\n            image:trim(drug.image),\n            labeler:capitalize(drug.labeler),\n            generics:drug.generics.split(\";\").filter(v => v).map(generic => {\n              let [name, strength] = generic.split(/(?= [\\d.]+)/)\n              return {\n                name:capitalize(name),\n                strength:trim(strength || '').toLowerCase().replace(/ /g, '')\n              }\n            }),\n            price:drug.price\n          }\n\n          return this.db.drug.post(drug)\n          .catch(err => {\n            drug._err = 'Upload Error: '+JSON.stringify(err)\n            errs.push(drug)\n          })\n          .then(_ => {\n            if (+i && (i % 100 == 0))\n              this.snackbar.show(`Imported ${i} of ${drugs.length}`)\n          })\n        })\n      }\n\n      return chain.then(_ => errs)  //return something so we do download errors\n    })\n    .then(rows => this.snackbar.show('Import Succesful'))\n    .catch(err => this.snackbar.error('Import Error', err))\n  }\n\n  addGeneric() {\n    this.drug.generics.push({name:'', strength:''})\n    return true\n  }\n\n  removeGeneric() {\n    this.drug.generics.pop()\n    setTimeout(_ => document.forms[0].dispatchEvent(new Event('change')))\n    return true\n  }\n\n  // addPkgSize() {\n  //   this.drug.pkgs.push({code:'', size:''})\n  //   return true\n  // }\n  //\n  // removePkgSize() {\n  //   this.drug.pkgs.pop()\n  //   return true\n  // }\n\n  saveOrder() {\n    console.log('before saveOrder()', this.group.name, this.drug.generic)\n    return this.db.account.put(this.account).catch(_ => {\n      console.log('after saveOrder()', this.group.name, this.drug.generic)\n      this.snackbar.show(`Order could not be saved: ${err.reason || err.message}`)\n    })\n  }\n\n  addDrug() {\n    this._savingDrug = true\n    this.db.drug.post(this.drug)\n    .then(res => {\n      this.drug._rev = res.rev\n      this.selectDrug(this.drug, true)\n      this._savingDrug = false\n    })\n    .catch(err => {\n      this._savingDrug = false\n      console.log(err)\n      this.snackbar.show(`Drug not added: ${err.reason || err.message || JSON.stringify(err.errors)}`)\n    })\n  }\n\n  saveDrug() {\n    this._savingDrug = true\n    this.db.drug.put(this.drug)\n    .then(res => {\n      //If we move the last drug out of the group, make sure we unorder it\n      if (\n        this.group.name != this.drug.generic &&\n        this.group.drugs.length == 1 &&\n        this.account.ordered[this.group.name]\n      ) this.order()\n\n      //Wait for the server PUT to replicate back to client\n      this.selectDrug(this.drug, true)\n      this._savingDrug = false\n    })\n    .catch(err => {\n      this._savingDrug = false\n      this.snackbar.show(`Drug not saved: ${err.reason || err.message}`)\n    })\n  }\n\n  deleteDrug() {\n    console.log('TO BE IMPLEMENETED')\n    //TODO complicated since drug might be used in a transaction.  Switch trans to a new drug\n  }\n}\n","export function configure(aurelia) {\n\n  Promise.config({warnings:false})\n  console.log = console.log.bind(console)\n\n  aurelia.use\n    .standardConfiguration()\n    .plugin('aurelia-animator-css')\n    .globalResources('client/src/resources/value-converters')\n\n  aurelia.start().then(a => a.setRoot('client/src/views/routes'));\n}\n","import {inject} from 'aurelia-framework';\nimport {Pouch}     from '../libs/pouch'\nimport {Router} from 'aurelia-router';\nimport {csv}    from '../libs/csv'\nimport {canActivate, expShortcuts, qtyShortcuts, removeTransactionIfQty0, incrementBin, saveTransaction, focusInput, scrollSelect, drugSearch, waitForDrugsToIndex, toggleDrawer} from '../resources/helpers'\n\n@inject(Pouch, Router)\nexport class inventory {\n\n  constructor(db, router){\n    this.db     = db\n    this.router = router\n    this.csv    = csv\n    this.limit  = 100\n    this.repack = {}\n    this.transactions = []\n    this.pending = {}\n\n    this.placeholder     = \"Search by generic name, ndc, exp, or bin\" //Put in while database syncs\n    this.waitForDrugsToIndex = waitForDrugsToIndex\n    this.expShortcuts    = expShortcuts\n    this.qtyShortcutsKeydown    = qtyShortcuts\n    this.removeTransactionIfQty0 = removeTransactionIfQty0\n    this.saveTransaction = saveTransaction\n    this.incrementBin    = incrementBin\n    this.focusInput      = focusInput\n    this.scrollSelect    = scrollSelect\n    this.drugSearch      = drugSearch\n    this.canActivate     = canActivate\n    this.toggleDrawer    = toggleDrawer\n    this.reset           = $event => {\n      if ($event.newURL.slice(-9) == 'inventory') {\n        this.term = ''\n        this.setTransactions()\n      }\n    }\n  }\n\n  deactivate() {\n    window.removeEventListener(\"hashchange\", this.reset)\n  }\n\n  activate(params) {\n    //TODO find a more elegant way to accomplish this\n    window.addEventListener(\"hashchange\", this.reset)\n\n    //TODO replace this with page state library\n\n    this.db.user.session.get().then(session => {\n\n      this.user    = session._id\n      this.account = session.account._id\n\n      this.db.account.get(this.account).then(account => this.ordered = account.ordered)\n      this.db.transaction.query('inventory.pendingAt', {include_docs:true, startkey:[this.account], endkey:[this.account, {}]})\n      .then(res => {\n        for (let row of res.rows)\n          this.setPending(row.doc)\n\n        this.refreshPending() //not needed on development without this on production, blank drawer on inital load\n      })\n      .then(_ => {\n        let keys = Object.keys(params)\n        if (keys[0])\n          this.selectTerm(keys[0], params[keys[0]])\n      })\n    })\n  }\n\n  scrollTerms($event) {\n    this.scrollSelect($event, this.term, this.terms, term => this.selectTerm('drug.generic', term))\n\n    if ($event.which == 13)//Enter get rid of the results\n      this.focusInput(`#exp_0`)\n  }\n\n  sortTransactions(transactions) {\n    return transactions.sort((a, b) => {\n\n      let aPack = this.isRepacked(a)\n      let bPack = this.isRepacked(b)\n\n      //For repacked, sort repacked first (descending)\n      if (aPack > bPack) return -1\n      if (aPack < bPack) return 1\n\n      let aBin  = a.bin ? a.bin[0]+a.bin[2]+a.bin[1]+(a.bin[3] || '') : ''\n      let bBin  = b.bin ? b.bin[0]+b.bin[2]+b.bin[1]+(b.bin[3] || '') : ''\n\n      //For bin sory acsending alphabetically\n      //Swap second (row) and third (column) digits.  Because it's easier to\n      //to shop by column first because it doesn't require the shopper to move\n      if (aBin > bBin) return 1\n      if (aBin < bBin) return -1\n\n      let aExp  = a.exp.to || a.exp.from || ''\n      let bExp  = b.exp.to || b.exp.from || ''\n\n      if (aExp < bExp) return 1\n      if (aExp > bExp) return -1\n\n      let aQty  = a.qty.to || a.qty.from || ''\n      let bQty  = b.qty.to || b.qty.from || ''\n\n      if (aQty > bQty) return 1\n      if (aQty < bQty) return -1\n\n      return 0\n    })\n  }\n\n  toggleCheck(transaction) {\n    console.log('toggleCheck transaction',  transaction)\n    this.setCheck(transaction, ! transaction.isChecked)\n  }\n\n  //Check all visible (non-filtered) transactions\n  toggleVisibleChecks() {\n    this.setVisibleChecks( ! this.filter.checked.visible)\n  }\n\n  setVisibleChecks(isChecked) {\n    if ( ! this.filter) return\n\n    let filtered = inventoryFilterValueConverter.prototype.toView(this.transactions, this.filter)\n\n    for (let transaction of filtered)\n      this.setCheck(transaction, isChecked)\n\n    this.filter.checked.visible = isChecked\n  }\n\n  //Cannot rely on 'this' other than this.filter\n  //because used by inventoryFilterValueConverter\n  setCheck(transaction, isChecked) {\n\n    const qty = transaction.qty.to || transaction.qty.from || 0\n\n    if (isChecked && ! transaction.isChecked) {\n      this.filter.checked.qty += qty\n      this.filter.checked.count++\n    }\n\n    if ( ! isChecked && transaction.isChecked) {\n      this.filter.checked.qty -= qty\n      this.filter.checked.count--\n      this.filter.checked.visible = false\n    }\n\n    return transaction.isChecked = isChecked\n  }\n\n  isRepacked(transaction) {\n    return transaction.bin && transaction.bin.length == 3\n  }\n\n  setTransactions(transactions = []) {\n    if (transactions.length == this.limit)\n      this.snackbar.show(`Displaying first 100 results`)\n\n    this.transactions = this.sortTransactions(transactions)\n    console.log('reset filter')\n    this.filter = {} //after new transactions set, we need to set filter so checkboxes don't carry over\n  }\n\n  search() {\n    if (/[A-Z][0-9]{3}/.test(this.term))\n      return this.selectTerm('bin', this.term)\n\n    if (/20\\d\\d-\\d\\d-?\\d?\\d?/.test(this.term))\n      return this.selectTerm('exp', this.term, true)\n\n    //Drug search is by NDC and we want to group by generic\n    this.drugSearch().then(drugs => {\n      this.terms = drugs.map(drug => drug.generic).filter((generic, index, generics) => generics.indexOf(generic) == index);\n    })\n  }\n\n  selectPending(pendingKey) {\n\n    const [generic, pendingAt] = pendingKey.split(': ')\n\n    let transactions = this.pending[generic] ? this.pending[generic][pendingAt] : []\n\n    if (transactions)\n      this.term = 'Pending '+generic+': '+pendingAt.slice(5, 19)\n\n    console.log('select pending', this.term)\n    this.setTransactions(transactions)\n    this.toggleDrawer()\n  }\n\n  selectInventory(type, key) {\n    this.term = key\n\n    let opts = {include_docs:true, limit:this.limit}\n    if (type != 'generic') {\n      opts.startkey = [this.account, key]\n      opts.endkey   = [this.account, key+'\\uffff']\n    } else {\n      opts.key = [this.account, key]\n    }\n    const setTransactions = res => this.setTransactions(res.rows.map(row => row.doc))\n    this.db.transaction.query('inventory.'+type, opts).then(setTransactions)\n  }\n\n  selectTerm(type, key) {\n\n    this.setVisibleChecks(false) //reset selected qty back to 0\n\n    type == 'pending'\n      ? this.selectPending(key)\n      : this.selectInventory(type, key)\n\n    this.router.navigate(`inventory?${type}=${key}`, {trigger:false})\n  }\n\n  refreshFilter(obj) {\n    if (obj) obj.val.isChecked = ! obj.val.isChecked\n    this.filter = Object.assign({}, this.filter)\n  }\n\n  refreshPending() {\n    console.log('refreshPending')\n    //Aurelia doesn't provide an Object setter to detect arbitrary keys so we need\n    //to trigger and update using Object.assign rather than just adding a property\n    this.pending = Object.assign({}, this.pending)\n  }\n\n  updateSelected(updateFn) {\n    const length = this.transactions.length\n    let all = []\n    //since we may be deleting as we go, loop backward\n    for (let i = length - 1; i >= 0; i--)  {\n      let transaction = this.transactions[i]\n\n      if ( ! transaction.isChecked) continue\n\n      //Remove from transactions displayed. This currently works because all actions\n      //pend, unpend, dispense, and repack remove transaction from the current list\n      //if we add another action where this is not true, we will need to pass an additional parameter.\n      this.setCheck(transaction, false)\n      this.transactions.splice(i, 1)\n\n      //If pending we want to move it.  Dispense/disposed/unpend all remove from pending\n      this.unsetPending(transaction)\n\n      updateFn(transaction)\n\n      //Save the transaction\n      all.unshift(this.db.transaction.put(transaction)\n      .catch(err => {\n        transaction.next.pop()\n        this.transactions.splice(i, 0, transaction)\n        this.snackbar.error('Error removing inventory', err)\n      }))\n    }\n\n    this.refreshPending() //unsetPending and updateFn may (un)pend some items\n\n    this.filter.checked.visible = false\n\n    return Promise.all(all)\n  }\n\n  unpendInventory() {\n    const term = this.transactions[0].drug.generic\n    this.updateSelected(transaction => {\n      transaction.isChecked = false\n      transaction.next = []\n    })\n    //We must let these transactions save without next for them to appear back in inventory\n   .then(_ => this.selectTerm('drug.generic', term))\n  }\n\n  pendInventory(createdAt = new Date().toJSON()) {\n    const term = this.transactions[0].drug.generic+': '+createdAt\n    this.updateSelected(transaction => {\n      transaction.isChecked = false\n      transaction.next = [{pending:{}, createdAt}]\n      this.setPending(transaction) //this must happen last so we have next info\n    })\n    //Since transactions pushed to pendying syncronously we get need to wait for the save to complete\n    this.selectTerm('pending', term)\n  }\n\n  //Group pending into this structure {drug:{pendedAt1:[...drugs], pendedAt2:[...drugs]}}\n  //this will allow easy functionality of the \"Pend to\" feature in case someone forgot to\n  //pend a drug with the original group.\n  setPending(transaction) {\n    const generic  = transaction.drug.generic\n    const pendedAt = transaction.next[0].createdAt\n\n    this.pending[generic] = this.pending[generic] || {}\n    this.pending[generic][pendedAt] = this.pending[generic][pendedAt] || []\n    this.pending[generic][pendedAt].push(transaction)\n  }\n\n  unsetPending(transaction) {\n\n    if ( ! transaction.next[0] || ! transaction.next[0].pending)\n      return //called indiscriminately from updateSelected\n\n    const pendingAt = transaction.next[0].createdAt\n    const generic = transaction.drug.generic\n    console.log('unsetPending', pendingAt, generic)\n    //Don't need to splice the pendingAt array because updateSelected does that automatically\n    this.refreshPending() //updateFn may pend some items\n\n    if ( ! this.pending[generic][pendingAt].length)\n      delete this.pending[generic][pendingAt]\n\n    if ( ! Object.keys(this.pending[generic]).length)\n      delete this.pending[generic]\n  }\n\n  dispenseInventory() {\n    const next = [{dispensed:{}, createdAt:new Date().toJSON()}]\n    this.updateSelected(transaction => transaction.next = next)\n  }\n\n  disposeInventory() {\n    this.updateSelected(transaction => {\n      transaction.next = []\n      transaction.verifiedAt = null\n      transaction.bin = null\n    })\n  }\n\n  //TODO this allows for mixing different NDCs with a common generic name, should we prevent this or warn the user?\n  repackInventory() {\n\n    let repackQty = this.repack.vialQty * this.repack.vials\n    let excessQty = this.repack.totalQty - repackQty\n\n    if (excessQty < 0) //html validation should prevent this, but some seemed to slip passed\n      return this.snackbar.show(`Selected qty of ${this.repack.totalQty} less than the ${ repackQty } needed`)\n\n\n    let newTransactions = [],\n        next = [],\n        createdAt = new Date().toJSON()\n\n    //Create the new (repacked) transactions\n    for (let i=0; i<this.repack.vials; i++) {\n\n      let newTransaction = {\n        verifiedAt:createdAt,\n        exp:{to:this.repack.exp, from:null},\n        qty:{to:+this.repack.vialQty, from:null},\n        user:{_id:this.user},\n        shipment:{_id:this.account},\n        bin:this.repack.bin,\n        drug:this.transactions[0].drug,\n        next:next\n      }\n\n      //Only add to display if we are not in pending screen\n      //if pended we don't want it to appear\n      if (this.term.slice(0,7) != 'Pending')\n        this.transactions.unshift(newTransaction)\n\n      newTransactions.push(this.db.transaction.post(newTransaction))\n    }\n\n    //Keep record of any excess that is implicitly destroyed.  Excess must be >= 0 for recordkeeping\n    //and negative excess (repack has more quantity than bins) is disallowed by html5 validation\n    //because we don't know where the extra pills came from.  If 0 still keep record in case we need to\n    //adjust it after the fact (on sever with reconcileRepackQty)\n    newTransactions.push(this.db.transaction.post({\n      exp:{to:this.repack.exp, from:null},\n      qty:{to:excessQty, from:null},\n      user:{_id:this.user},\n      shipment:{_id:this.account},\n      drug:this.transactions[0].drug,\n      next:[] //Keep it pending if we are on pending screen\n    }))\n\n    //Once we have the new _ids insert them into the next property of the checked transactions\n    Promise.all(newTransactions).then(newTransactions => {\n\n      let label = [\n        `<p style=\"page-break-after:always;\">`,\n        `<strong>${this.transactions[0].drug.generic}</strong>`,\n        `Ndc ${this.transactions[0].drug._id}`,\n        `Exp ${this.repack.exp.slice(0, 7)}`,\n        `Bin ${this.repack.bin}`,\n        `Qty ${this.repack.vialQty}`,\n        `Pharmacist ________________`,\n        `</p>`\n      ]\n\n      const next = newTransactions.map(newTransaction => {\n        return {transaction:{_id:newTransaction.id}, createdAt}\n      })\n\n      this.updateSelected(transaction => transaction.next = next)\n\n      let win = window.open()\n      if ( ! win)\n        return this.snackbar.show(`Enable browser pop-ups to print repack labels`)\n\n      win.document.write(label.join('<br>').repeat(this.repack.vials))\n      win.print()\n      win.close()\n\n    }).catch(err => {\n      console.error(err)\n      this.snackbar.show(`Transactions could not repackaged: ${err.reason}`)\n    })\n  }\n\n  //Upon repacking, excess forced to be >= 0 and is recorded as a new transaction that was \"disposed\"\n  //However we want to allow users to adjust repack quantities after being made.  To do this we need to\n  //adjust the excess quantity up or down accordingly.\n  saveAndReconcileTransaction(transaction) {\n    console.log('saveAndReconcileTransaction')\n    //Get current qty so we can see if the qty changed\n    this.db.transaction.get(transaction._id).then(repack => {\n      const qtyChange = transaction.qty.to - repack.qty.to\n\n      if ( ! qtyChange) {\n        return this.saveTransaction(transaction)\n      }\n\n      return this.db.transaction.query('next.transaction._id', {key:[this.account, transaction._id], include_docs:true}).then(res => {\n\n        if ( ! res.rows.length) {\n          return this.saveTransaction(transaction)\n        }\n\n        let excess = res.rows.pop().doc.next.pop().transaction._id\n\n        return this.db.transaction.get(excess).then(excess => {\n            excess.qty.to -= qtyChange\n\n            if (excess.qty.to < 0) {\n              transaction.qty.to = repack.qty.to\n              return this.snackbar.show(`Cannot set repack qty to be more than qty orginally repacked, ${repack.qty.to+excess.qty.to+qtyChange}`)\n            }\n\n            this.db.transaction.put(excess)\n            return this.saveTransaction(transaction)\n        })\n      })\n    })\n  }\n\n  setRepackVials() {\n    this.repack.vials = this.repack.totalQty && +this.repack.vialQty ? Math.floor(this.repack.totalQty / this.repack.vialQty) : ''\n  }\n\n  openMenu($event) {\n    if ($event.target.tagName != 'I' || ! this.transactions.length)\n      return true //only calculate for the parent element, <i vertical menu icon>, and not children //true needed so public inventory link works\n\n    console.log('openMenu', this.ordered[this.term], this.repack, this.transactions[0]);\n\n    const term = this.term.replace('Pending ', '')\n\n    this.repack.vialQty = this.ordered[term] && this.ordered[term].vialQty ? this.ordered[term].vialQty : 90\n    this.repack.totalQty = 0,\n    this.repack.exp = ''\n    for (let transaction of this.transactions) {\n      if (transaction.isChecked) {\n        this.repack.totalQty += transaction.qty.to\n        this.repack.exp  = this.repack.exp && this.repack.exp < transaction.exp.to ? this.repack.exp : transaction.exp.to\n      }\n    }\n\n    this.setRepackVials()\n  }\n\n  //Split functionality into Keydown and Input listeners because (keydown is set in constructor)\n  //Don't put this code into input because enter (which == 13) does not trigger input event.\n  //Don't put input code here because would then need a setTimeout for the quantity to actually change\n  //and you would need to ignore non-input key values.  So it cleaner to just keep these listeners separate\n  qtyShortcutsInput($event, $index) {\n    //Only run autocheck if the transaction was not deleted\n    this.removeTransactionIfQty0($event, $index)\n  }\n\n  binShortcuts($event, $index) {\n    if ($event.which == 13) //Enter should focus on next row's exp\n      this.focusInput(`#exp_${$index+1}`)\n    else\n      this.incrementBin($event, this.transactions[$index])\n\n    return true\n  }\n}\n\n//ADDED step of converting object to array\nexport class inventoryFilterValueConverter {\n  toView(transactions = [], filter = {}){\n    //restart filter on transaction changes but keep checks\n    //where they are if user is just modifying the filter\n    let ndcFilter     = {}\n    let expFilter     = {}\n    let repackFilter  = {}\n    let formFilter    = {}\n    let checkVisible  = true\n\n    filter.checked = filter.checked || {}\n    filter.checked.qty = filter.checked.qty || 0\n    filter.checked.count = filter.checked.count || 0\n\n    transactions = transactions.filter((transaction, i) => {\n\n      //TODO we could reduce code by making this a loop of keys.  Lot's of redundancy here\n      let qty    = transaction.qty.to || transaction.qty.from\n      let exp    = transaction.exp.to || transaction.exp.from\n      let ndc    = transaction.drug._id\n      let form   = transaction.drug.form\n      let repack = inventory.prototype.isRepacked(transaction) ? 'Repacked' : 'Inventory'\n      let pending = transaction.next[0] && transaction.next[0].pending\n\n      if ( ! expFilter[exp]) {\n        //console.log('pending', !!pending, 'exp', exp, 'filter.exp', filter.exp, 'filter.exp[exp]', filter.exp && filter.exp[exp], 'filter.exp[exp].isChecked', filter.exp && filter.exp[exp] && filter.exp[exp].isChecked)\n        expFilter[exp] = {isChecked:filter.exp && filter.exp[exp] ? filter.exp[exp].isChecked : pending || false, count:0, qty:0}\n      }\n\n      if ( ! ndcFilter[ndc])\n        ndcFilter[ndc] = {isChecked:filter.ndc && filter.ndc[ndc] ? filter.ndc[ndc].isChecked : pending || ! i, count:0, qty:0}\n\n      if ( ! formFilter[form])\n        formFilter[form] = {isChecked:filter.form && filter.form[form] ? filter.form[form].isChecked : pending || ! i, count:0, qty:0}\n\n      if ( ! repackFilter[repack])\n        repackFilter[repack] = {isChecked:filter.repack && filter.repack[repack] ? filter.repack[repack].isChecked : pending || ! repackFilter['Repacked'], count:0, qty:0}\n\n      if ( ! expFilter[exp].isChecked) {\n        if (ndcFilter[ndc].isChecked && formFilter[form].isChecked && repackFilter[repack].isChecked) {\n          expFilter[exp].count++\n          expFilter[exp].qty += qty\n        }\n\n        return inventory.prototype.setCheck.call({filter}, transaction, false)\n      }\n      if ( ! ndcFilter[ndc].isChecked) {\n        if (expFilter[exp].isChecked && formFilter[form].isChecked && repackFilter[repack].isChecked) {\n          ndcFilter[ndc].count++\n          ndcFilter[ndc].qty += qty\n        }\n\n        return inventory.prototype.setCheck.call({filter}, transaction, false)\n      }\n\n      if ( ! formFilter[form].isChecked) {\n        if (expFilter[exp].isChecked && ndcFilter[ndc].isChecked && repackFilter[repack].isChecked) {\n          formFilter[form].count++\n          formFilter[form].qty += qty\n        }\n        return inventory.prototype.setCheck.call({filter}, transaction, false)\n      }\n\n      if ( ! repackFilter[repack].isChecked) {\n        if (expFilter[exp].isChecked && ndcFilter[ndc].isChecked && formFilter[form].isChecked) {\n          repackFilter[repack].count++\n          repackFilter[repack].qty += qty\n        }\n\n        return inventory.prototype.setCheck.call({filter}, transaction, false)\n      }\n\n      if ( ! transaction.isChecked)\n        checkVisible = false\n\n\n      expFilter[exp].count++\n      expFilter[exp].qty += qty\n\n      ndcFilter[ndc].count++\n      ndcFilter[ndc].qty += qty\n\n      formFilter[form].count++\n      formFilter[form].qty += qty\n\n      repackFilter[repack].count++\n      repackFilter[repack].qty += qty\n\n      return true\n    })\n\n    filter.exp     = expFilter\n    filter.ndc     = ndcFilter\n    filter.form    = formFilter\n    filter.repack  = repackFilter\n    filter.checked.visible = transactions.length ? checkVisible : false //unchecked if not transactions\n\n    return transactions\n  }\n}\n","import {inject}     from 'aurelia-framework'\nimport {Router}     from 'aurelia-router'\nimport {Pouch}         from '../libs/pouch'\nimport {HttpClient} from 'aurelia-http-client'\nimport {canActivate} from '../resources/helpers'\n\n//@pageState()\n@inject(Pouch, Router, HttpClient)\nexport class join {\n\n  constructor(db, router, http){\n    this.db     = db\n    this.router = router\n    this.http   = http\n\n    this.account = {\n      name:'',\n      license:'Pharmacy',\n      street:'',\n      city:'',\n      state:'',\n      zip:'',\n      ordered:{}\n    }\n\n    this.user = {\n      name:{first:'Guest',last:'User'},\n      phone:'650.488.7434'\n    }\n    this.canActivate = canActivate\n  }\n\n  join() {\n\n    this.db.account.post(this.account)\n    .then(res => {\n      this.user.account = {_id:res.id}\n      console.log('this.account.phone', this.account.phone, res)\n      let password = this.user.password\n      return this.db.user.post(this.user)\n      .then(res => this.user.password = password, res)\n    })\n    .then(res => {\n      console.log('this.user.phone', this.user.phone, res)\n      //local user is created but now replicator must call bulk docs which then triggers creation of a\n      //_user login. Since, we don't know exactly how long this will take so we must do a timeout here\n      return new Promise(resolve => setTimeout(resolve, 2000))\n    })\n    .then(_ => {\n      console.log(2)\n\n      return this.db.user.session.post(this.user)\n    })\n    .then(loading => {\n      console.log(3)\n      //wait for all resources except 'drugs' to sync .filter(r => r.name != 'drugs')\n      this.disabled = true\n      this.loading  = loading.resources\n      this.progress = loading.progress\n\n      return Promise.all(loading.syncing)\n    })\n    .then(_ => {\n      console.log('join success', _)\n      return this.router.navigate('shipments')\n    })\n    .catch(err => this.snackbar.error('Join failed', {err, account:this.account, user:this.user}))\n  }\n}\n","import {inject} from 'aurelia-framework'\nimport {Router} from 'aurelia-router'\nimport {Pouch}     from '../libs/pouch'\nimport {canActivate} from '../resources/helpers'\n\n\n@inject(Pouch, Router)\nexport class login {\n\n  constructor(db, router){\n    this.db          = db\n    this.router      = router\n    this.phone       = ''\n    this.password    = ''\n    this.canActivate = canActivate\n  }\n\n  login() {\n    this.db.user.session.post({phone:this.phone, password:this.password})\n    .then(loading => {\n      this.disabled = true\n\n      //wait for all resources except 'drugs' to sync\n      this.loading  = loading.resources\n      this.progress = loading.progress\n\n      return Promise.all(loading.syncing)\n    })\n    .then(resources => {\n      this.router.navigate('shipments')\n    })\n    .catch(err => {\n      this.disabled = false\n      this.snackbar.error('Login failed', err)\n    })\n  }\n}\n","//@pageState()\nexport class App {\n\n  configureRouter(config, router){\n    this.routes  = router.navigation\n    config.title = 'SIRUM'\n    config.map([\n      { route: 'login',                            moduleId: 'client/src/views/login',     title:'Login',     nav:true},\n      { route: 'join',                             moduleId: 'client/src/views/join',      title:'Join',      nav:true},\n      { route: 'inventory',                        moduleId: 'client/src/views/inventory', title:'Inventory', nav:true, roles:[\"user\"]},\n      { route: ['shipments', 'shipments/:id', ''], moduleId: 'client/src/views/shipments', title:'Shipments', nav:true, roles:[\"user\"]},\n      { route: ['drugs', 'drugs/:id'],             moduleId: 'client/src/views/drugs',     title:'Drugs',     nav:true, roles:[\"user\"]},\n      { route: 'account',                          moduleId: 'client/src/views/account',   title:'Account',   nav:true, roles:[\"user\"]}\n    ])\n  }\n}\n","import {inject}     from 'aurelia-framework'\nimport {Router}     from 'aurelia-router'\nimport {Pouch}         from '../libs/pouch'\nimport {HttpClient} from 'aurelia-http-client'\nimport {csv}        from '../libs/csv'\nimport {canActivate, expShortcuts, qtyShortcuts, removeTransactionIfQty0, incrementBin, saveTransaction, focusInput, scrollSelect, toggleDrawer, drugSearch, waitForDrugsToIndex} from '../resources/helpers'\n\n//@pageState()\n@inject(Pouch, Router, HttpClient)\nexport class shipments {\n\n  constructor(db, router, http){\n    this.csv    = csv\n    this.db     = db\n    this.drugs  = []\n    this.router = router\n    this.http   = http\n    this.stati  = ['pickup', 'shipped', 'received']\n    this.shipments = {}\n    this.term  = ''\n\n    this.waitForDrugsToIndex = waitForDrugsToIndex\n    this.expShortcutsKeydown = expShortcuts\n    this.qtyShortcutsKeydown = qtyShortcuts\n    this.removeTransactionIfQty0 = removeTransactionIfQty0\n    this.incrementBin    = incrementBin\n    this.saveTransaction = saveTransaction\n    this.focusInput      = focusInput\n    this.scrollSelect    = scrollSelect\n    this.toggleDrawer    = toggleDrawer\n    this.drugSearch      = drugSearch\n    this.canActivate     = canActivate\n  }\n\n  activate(params) {\n    return this.db.user.session.get()\n    .then(session  => {\n      this.user = session._id\n      return this.db.account.get(session.account._id)\n    })\n    .then(account => {\n      this.account = {_id:account._id, name:account.name}\n      this.ordered = {[account._id]:account.ordered}\n\n      //TODO From View\n      //Get all accounts that this account has authorized\n      //let doneeAccounts = this.db.account.allDocs({keys:account.authorized, include_docs:true})\n      //let shipmentsSent = this.db.shipment.query({'account.from._id':account._id})\n\n      //let recipientAccounts    = this.db.account.query('authorized', {key:account._id, include_docs:true}) //Get all accounts that have authorized this account\n      let senderAccounts    = this.db.account.allDocs({keys:account.authorized, include_docs:true})\n      let shipmentsReceived = this.db.shipment.allDocs({startkey:account._id+'\\uffff', endkey:account._id, descending:true, include_docs:true}) //Get all shipments to this account\n      return Promise.all([senderAccounts, shipmentsReceived]).then(all => {\n\n        [{rows:senderAccounts}, {rows:shipmentsReceived}] = all\n\n        //This abbreviated denormalized account information will be assigned to account.to/from\n        let selected, map = {to:{},from:{}}\n\n        this.accounts  = {\n          from:[''].concat(senderAccounts.map(({doc}) => {\n            this.ordered[doc._id] = doc.ordered\n            return map.from[doc._id] = {_id:doc._id, name:doc.name}\n          }))\n        }\n\n        //for (let account of recipientAccounts) makeMap(recipientMap, account)\n        //to:['', ...Object.keys(toMap).map(key => toMap[key])]\n\n        //Selected account != shipment.account.to because they are not references\n        this.shipment = {}\n        //, sent:shipmentsSent}\n        //shipmentsSent.forEach(makeReference)\n        //console.log('this.accounts', this.accounts)\n        //Sneak this in since we are already making the loop\n        let accountRef = role => {\n         return ({doc}) => {\n           this.setStatus(doc)\n\n           if (map[role][doc.account[role]._id])\n             doc.account[role] = map[role][doc.account[role]._id]\n\n           // if (toMap[doc.account.from._id])\n           //   doc.account.from = toMap[doc.account.from._id]\n           if (params.id === doc._id)\n             selected = doc\n\n           return doc\n         }\n        }\n\n        //Sent shipments get references to toAccount (since fromAccount will always be us)\n        //this.shipments.from = shipmentsSent.map(accountRef('to'))\n\n\n        this.role = selected //switch default role depending on shipment selection\n        ? {accounts:'to', shipments:'from'}\n        : {accounts:'from', shipments:'to'}\n\n        //Received shipments get references to fromAccount (since toAccount will always be us)\n        this.shipments.to = shipmentsReceived.map(accountRef('from'))\n\n        this.selectShipment(selected)\n        //this.waitForDrugsToIndex()\n      })\n      .catch(err => console.log('promise all err', err))\n\n\n      //this.db.account.find({selector:{authorized:account._id}})\n      // return Promise.all([\n      //   //Start all of our async tasks\n      //   this.db.account.get({authorized:accounts[0]._id}),\n      //   this.db.account.get({_id:{$gt:null, $in:accounts[0].authorized}}),\n      //   this.db.shipment.get({'account.from._id':accounts[0]._id}), //TODO this should be duplicative with _security doc.  We should be able to do _all_docs or no selector\n      //   this.db.shipment.get({'account.to._id':accounts[0]._id})\n      // ])\n    })\n    // .then(([fromAccounts, toAccounts, fromShipments, toShipments]) => {\n    //\n    // })\n  }\n\n  //Activated by activate() and each time a shipment is selected from drawer\n  selectShipment(shipment, toggleDrawer) {\n    if (toggleDrawer)\n      this.toggleDrawer()\n\n    if ( ! shipment) return this.emptyShipment()\n    this.setUrl('/'+shipment._id)\n    this.setShipment(shipment)\n    this.setTransactions(shipment._id)\n  }\n\n  emptyShipment() {\n    this.setUrl('')\n\n    if (this.role.shipments == 'to') {  //shipments received\n      this.setShipment({account:{to:this.account, from:{}}})\n      this.setTransactions()\n    } else { //shipments sent\n      this.setShipment({account:{from:this.account, to:{}}})\n      this.setTransactions(this.account._id)\n    }\n  }\n\n  setShipment(shipment) {\n    this.shipment     = shipment\n    this.shipmentId   = shipment._id  //freeze this if user started playing with \"move shipment\" select\n    this.attachment   = null\n  }\n\n  setUrl(url) {\n    this.router.navigate('shipments'+url, { trigger: false})\n  }\n\n  setTransactions(shipmentId) {\n\n    this.diffs = [] //Newly checked or unchecked checkboxes. Used to disable buttons if user has not done anything yet\n\n    if ( ! shipmentId)\n      return this.transactions = []\n\n    this.db.transaction.query('shipment._id', {key:[this.account._id, shipmentId], include_docs:true, descending:true}).then(res => {\n      this.transactions = res.rows.map(row => row.doc)\n      this.setCheckboxes()\n    })\n    .catch(err => console.log('err', err))\n  }\n\n  setCheckboxes() {\n    for (let transaction of this.transactions) {\n      transaction.isChecked = this.shipmentId == this.shipment._id ? transaction.verifiedAt : null\n    }\n  }\n\n  setStatus(shipment) {\n    shipment.status = this.stati.reduce((prev, curr) => shipment[curr+'At'] ? curr : prev)\n  }\n\n  swapRole() { //Swap donor-donee roles\n    [this.role.accounts, this.role.shipments] = [this.role.shipments, this.role.accounts]\n    this.selectShipment()\n    return true\n  }\n\n  //Save the donation if someone changes the status/date\n  saveShipment() {\n    //don't want to save status, but deleting causes weird behavior\n    //so instead copy the shipment and delete from copy then assign new rev\n    return this.db.shipment.put(this.shipment).then(res => {\n      this.setStatus(this.shipment)\n    })\n    //TODO reschedule pickup if a date was changed\n  }\n\n  //Move these items to a different \"alternative\" shipment then select it\n  //TODO need to select the new shipment once user confirms the move\n  moveTransactionsToShipment(shipment) {\n    //Change all selected transactions to the new or existing shipment\n    Promise.all(this.transactions.map(transaction => {\n      if (transaction.isChecked) {\n        transaction.shipment = {_id:shipment._id}\n        return this.db.transaction.put(transaction)\n      }\n    }))\n    .then(_ => this.selectShipment(shipment)) //Display existing shipment or the newly created shipment\n  }\n\n  //Create shipment then move inventory transactions to it\n  createShipment() {\n    if (this.shipment.tracking == 'New Tracking #')\n      delete this.shipment.tracking\n\n    //For some reason if you move this unshift() later, into the .then(), it will clear out the shipment\n    //TODO investigate why this is true?  Is it the filter function that causes problems?\n    this.shipments[this.role.shipments].unshift(this.shipment)\n    this.setStatus(this.shipment)\n\n    this.db.shipment.post(this.shipment)\n    .then(res => this.moveTransactionsToShipment(this.shipment)) //_id is needed for move but has not been set until now\n    .catch(err => console.error('createShipment error', err, this.shipment))\n  }\n\n  //Split functionality into Keydown and Input listeners because (keydown is set in constructor)\n  //Don't put this code into input because enter (which == 13) does not trigger input event.\n  //Don't put input code here because would then need a setTimeout for the quantity to actually change\n  //and you would need to ignore non-input key values.  So it cleaner to just keep these listeners separate\n  expShortcutsInput($index) {\n    this.autoCheck($index)\n  }\n\n  //Split functionality into Keydown and Input listeners because (keydown is set in constructor)\n  //Don't put this code into input because enter (which == 13) does not trigger input event.\n  //Don't put input code here because would then need a setTimeout for the quantity to actually change\n  //and you would need to ignore non-input key values.  So it cleaner to just keep these listeners separate\n  qtyShortcutsInput($event, $index) {\n    //Only run autocheck if the transaction was not deleted\n    this.removeTransactionIfQty0($event, $index) && this.autoCheck($index)\n  }\n\n  binShortcuts($event, $index) {\n    if ($event.which == 13)\n      return this.focusInput(`md-autocomplete`)\n\n    return this.incrementBin($event, this.transactions[$index])\n  }\n\n  getBin(transaction) {\n    return (this.getOrder(transaction) || {}).defaultBin || this._bin\n  }\n\n  setBin(transaction) {\n    if (this.getBin(transaction) != transaction.bin)\n      this._bin = transaction.bin //Only prepopulate non-default bins into next transaction\n  }\n\n  aboveMinQty(order, transaction) {\n    let qty = transaction.qty[this.role.shipments]\n    if ( ! qty) return false\n    console.log('aboveMinQty', transaction)\n    let price      = transaction.drug.price.goodrx || transaction.drug.price.nadac || 0\n    let defaultQty = price > 1 ? 1 : 1 //keep expensive meds\n    let aboveMinQty = qty >= (+order.minQty || defaultQty)\n    if ( ! aboveMinQty) console.log('Ordered drug but qty', qty, 'is less than', +order.minQty || defaultQty)\n    return aboveMinQty\n  }\n\n  aboveMinExp(order, transaction) {\n    let exp = transaction.exp[this.role.shipments]\n    if ( ! exp) return ! order.minDays\n    let minDays = order.minDays || 60\n    let aboveMinExp = new Date(exp) - Date.now() >= minDays*24*60*60*1000\n    if ( ! aboveMinExp) console.log('Ordered drug but expiration', exp, 'is before', minDays)\n    return aboveMinExp\n  }\n\n  belowMaxInventory(order, transaction) {\n    let newInventory = transaction.qty[this.role.shipments] + order.inventory\n    let maxInventory = order.maxInventory || 3000\n    let belowMaxInventory = isNaN(newInventory) ? true : newInventory < maxInventory //in case of an inventory error let's keep the drug\n    if ( ! belowMaxInventory) console.log('Ordered drug but inventory', newInventory, 'would be above max of', maxInventory) //\n    return belowMaxInventory\n  }\n\n  getOrder(transaction) {\n    return this.ordered[this.shipment.account.to._id][transaction.drug.generic]\n  }\n\n  isWanted(order, transaction) {\n    return order ? this.belowMaxInventory(order, transaction) && this.aboveMinQty(order, transaction) && this.aboveMinExp(order, transaction) : false\n  }\n\n  //If qty is 30 and user types \"3\" then destroyed message will display before user can type \"0\"\n  //this code puts a delay on the destroyed message and then clears it out if the user does type a \"0\"\n  //an alternative would be wait to trigger autocheck until enter is pressed but this would delay all messages\n  setDestroyedMessage(order) {\n    if (order && order.destroyedMessage && ! this.destroyedMessage)\n      this.destroyedMessage = setTimeout(_ => {\n        delete this.destroyedMessage\n        this.snackbar.show(order.destroyedMessage)\n      }, 500)\n  }\n\n  clearDestroyedMessage() {\n    clearTimeout(this.destroyedMessage)\n    delete this.destroyedMessage\n  }\n\n  //TODO should this only be run for the recipient?  Right now when donating to someone else this still runs and displays order messages\n  autoCheck($index) {\n    let transaction = this.transactions[$index]\n    let isChecked   = transaction.isChecked\n    let order       = this.getOrder(transaction)\n\n    if(this.isWanted(order, transaction) == isChecked)\n      return ! isChecked && transaction.qty.to > 0 && this.setDestroyedMessage(order) //isChecked may have never alternated for a destroyed drug so need to check\n\n    if (isChecked)\n      this.setDestroyedMessage(order)\n\n    if ( ! isChecked) {//manual check has not switched the boolean yet\n      this.snackbar.show(order.verifiedMessage || 'Drug is ordered')\n      this.clearDestroyedMessage()\n    }\n\n    this.manualCheck($index)\n  }\n\n  manualCheck($index) {\n    let transaction = this.transactions[$index]\n    transaction.isChecked = ! transaction.isChecked\n    //If user is not moving items, the shipment exists, and they are the recipient, then autosave their verificaton\n    //offsetParent is null when buttons are hidden.  This keeps us from duplicating the show logic of the buttons here\n    this.moveItemsButton.offsetParent\n      ? this.toggleSelectedCheck(transaction)\n      : this.toggleVerifiedCheck(transaction)\n  }\n\n  toggleVerifiedCheck(transaction) {\n\n    let verifiedAt = transaction.verifiedAt\n    let bin = transaction.bin\n\n    if (verifiedAt) {\n      transaction.verifiedAt = null\n      transaction.bin = null\n    } else {\n      transaction.verifiedAt = new Date().toJSON()\n      transaction.bin = this.getBin(transaction)\n    }\n\n    this.saveTransaction(transaction).catch(err => {\n      transaction.isChecked  = ! transaction.isChecked\n      transaction.verifiedAt = verifiedAt\n      transaction.bin = bin\n    })\n  }\n\n  toggleSelectedCheck(transaction) {\n    let index = this.diffs.indexOf(transaction)\n    ~ index\n      ? this.diffs.splice(index, 1)\n      : this.diffs.push(transaction)\n  }\n\n  search() {\n    this.drugSearch().then(drugs => {\n      this.drugs = drugs\n      this.drug  = drugs[0]\n    })\n  }\n\n  //Enter in the autocomplete adds the selected transaction\n  //TODO support up/down arrow keys to pick different transaction?\n  autocompleteShortcuts($event) {\n\n    this.scrollSelect($event, this.drug, this.drugs, drug => this.drug = drug)\n\n    //Enter with a selected drug.  Force term to be falsey so a barcode scan which is entering digits does not trigger\n    if ($event.which == 13) {//Barcode scan means search might not be done yet\n      Promise.resolve(this._search).then(_ => this.addTransaction(this.drug))\n      return false //Enter was also triggering exp to qty focus\n    }\n\n    if ($event.which == 106 || ($event.shiftKey && $event.which == 56)) //* clearing autocomplete field with an asterick (to match exp date clearing and make numberpad compatible)\n      this.term = \"\"\n\n    return true  //still allow typing into autocomplete\n  }\n\n  addTransaction(drug, transaction) {\n\n    if ( ! drug)\n      return this.snackbar.show(`Cannot find drug matching this search`)\n\n    this.drug = drug\n\n    if (drug.warning) //not imported from CSV\n      this.dialog.showModal()\n\n    transaction = transaction || {\n      qty:{from:null, to:null},\n      exp:{\n        from:this.transactions[0] ? this.transactions[0].exp.from : null,\n        to:this.transactions[0] ? this.transactions[0].exp.to : null\n      }\n    }\n\n    transaction.drug = {\n      _id:drug._id,\n      brand:drug.brand,\n      generic:drug.generic,\n      generics:drug.generics,\n      form:drug.form,\n      price:drug.price,\n      pkg:drug.pkg\n    }\n\n    transaction.user       = {_id:this.user}\n    transaction.shipment   = {_id:this.shipment._id || this.account._id}\n\n    this.term = '' //Reset search's auto-complete\n\n    //Assume db query works.\n    this.transactions.unshift(transaction) //Add the drug to the view\n\n    let order        = this.getOrder(transaction)\n    let isPharMerica = false ///pharmerica.*/i.test(this.shipment.account.from.name)\n\n    //We set current inventory when adding a new transaction.  This is a tradeoff of frequency vs accurracy.  This will be inaccurate\n    //if user goes back and adjusts previous quantities to be higher since \"updating\" transaction would not trigger this code.  However,\n    //this is rare enough to be okay.  We also don't want to have to fetch current inventory on every input event.\n    order && this.db.transaction.query('inventory', {startkey:[drug.generic], endkey:[drug.generic+'\\uffff']})\n    .then(inventory => {\n      console.log('inventory', inventory)\n      order.inventory = inventory.rows[0] ? inventory.rows[0].value.total : 0\n      console.log('order.inventory', order.inventory)\n    })\n\n    isPharMerica && ! order //Kiah's idea of not making people duplicate logs for PharMerica, saving us some time\n      ? this.snackbar.show(`Destroy, record already exists`)\n      : setTimeout(_ => this.focusInput('#exp_0'), 50) // Select the row.  Wait for repeat.for to refresh (needed for dev env not live)\n\n    return this._saveTransaction = Promise.resolve(this._saveTransaction).then(_ => {\n      return this.db.transaction.post(transaction)\n      .catch(err => {\n        this.snackbar.error(`Transaction could not be added: `, err)\n        this.transactions.shift()\n      })\n    })\n  }\n\n  dialogClose() {\n    this.dialog.close()\n    this.focusInput('#qty_0')\n  }\n\n  exportCSV() {\n    let name = 'Shipment '+this.shipment._id+'.csv'\n    this.csv.fromJSON(name, this.transactions.map(transaction => {\n      return {\n        '':transaction,\n        'next':JSON.stringify(transaction.next || []),\n        'drug._id':\" \"+transaction.drug._id,\n        'drug.generics':transaction.drug.generics.map(generic => generic.name+\" \"+generic.strength).join(';'),\n        shipment:this.shipment\n      }\n    }))\n  }\n\n  importCSV() {\n    this.csv.toJSON(this.$file.files[0], parsed => {\n      this.$file.value = ''\n      return Promise.all(parsed.map(transaction => {\n        transaction._err        = undefined\n        transaction._id          = undefined\n        transaction._rev         = undefined\n        transaction.shipment._id = this.shipment._id\n        transaction.next         = JSON.parse(transaction.next)\n        //This will add drugs upto the point where a drug cannot be found rather than rejecting all\n        return this.db.drug.get(transaction.drug._id)\n        .then(drug => this.addTransaction(drug, transaction))\n        .then(_ => undefined) //do not download successes\n        .catch(err => {\n          transaction._err = 'Upload Error: '+JSON.stringify(err)\n          return transaction //do download errors\n        })\n      }))\n    })\n    .then(rows => this.snackbar.show('Import Succesful'))\n    .catch(err => this.snackbar.error('Import Error', err))\n  }\n\n  // setAttachment(attachment) {\n  //   attachment._id  = this.attachment.name\n  //   attachment._rev = this.shipment._rev\n  //   this.db.shipment.attachment.put({_id:this.shipment._id, attachment:attachment})\n  //   .then(res => {\n  //     this.shipment._rev   = res.rev\n  //     this.attachment.type = attachment.type\n  //     //TODO use service worker to rename this URL so title bar isn't nasty\n  //     //http://stackoverflow.com/questions/283956/is-there-any-way-to-specify-a-suggested-filename-when-using-data-uri\n  //     this.attachment.url  = URL.createObjectURL(attachment)\n  //     console.log('setAttachment', attachment, _)\n  //   })\n  // }\n  //\n  // getAttachment() {\n  //   this.db.shipment.attachment.get({_id:this.shipment._id, name:this.attachment.name})\n  //   .then(attachment => {\n  //     this.attachment.type = attachment.type\n  //     this.attachment.url  = URL.createObjectURL(attachment)\n  //     console.log('getAttachment', attachment, this.attachment.url)\n  //   })\n  //   .catch(this.attachment.url = null)\n  // }\n}\n",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"sourceRoot":".."}