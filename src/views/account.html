<template>
  <require from='elems/md-shadow'></require>
  <require from='elems/md-drawer'></require>
  <require from='elems/md-table'></require>
  <require from="elems/md-input"></require>
  <require from="elems/md-select"></require>
  <require from="elems/md-button"></require>
  <require from="elems/md-switch"></require>
  <require from="elems/md-checkbox"></require>
  <require from="elems/md-snackbar"></require>
  <md-drawer>
    <md-input value.bind="filter" style="padding:0 8px">Filter Users</md-input>
    <a
      if.bind=" ! filter"
      class="mdl-navigation__link ${ ! user.email ? 'mdl-navigation__link--current' : ''}"
      click.delegate="selectUser({name:{}, account:{_id:session.account._id}})">
      <div class="mdl-typography--title">New User</div>
    </a>
    <a
      repeat.for="user of users | userFilter:filter"
      class="mdl-navigation__link ${ user.email == $parent.user.email ? 'mdl-navigation__link--current' : ''}"
      click.delegate="selectUser(user)">
      <div class="mdl-typography--title">${ user.name.first+' '+user.name.last}</div>
    </a>
  </md-drawer>
  <section class="mdl-grid au-animate">
    <form md-shadow="2" class="mdl-card mdl-cell mdl-cell--4-col full-height">
      <div class="mdl-card__title">
        <div class="mdl-card__title-text">
          User Information
        </div>
      </div>
      <div class="mdl-card__supporting-text" style="font-size:16px;" input.delegate="saveUser() & debounce:1000">
        <md-input style="width:49%" value.bind="user.name.first" required>First Name</md-input>
        <md-input style="width:49%" value.bind="user.name.last" required>Last Name</md-input>
        <md-input style="width:100%" value.bind="user.email" type="email" pattern="[\w._]{2,}@\w{3,}\.(com|org|net|gov)" required>Email</md-input>
        <md-input style="width:100%" value.bind="user.phone" type="tel" pattern="^\d{3}[.-]?\d{3}[.-]?\d{4}$" required>Phone</md-input>
        <md-input style="width:100%" value.bind="user.password" if.bind=" ! user._id" required>Password</md-input>
      </div>
      <div class="mdl-card__actions">
        <md-button color raised style="width:100%" if.bind="! user._id" form click.delegate="addUser()">Create User</md-button>
        <md-button color raised style="width:100%" if.bind="user._id == session._id" click.delegate="logout()" disabled.bind="disableLogout">${ disableLogout || 'Uninstall' }</md-button>
        <md-button color="accent" raised style="width:100%" if.bind="user._id && user._id != session._id" click.delegate="deleteUser()">Delete User</md-button>
      </div>
    </form>
    <div md-shadow="2" class="mdl-card mdl-cell mdl-cell--8-col full-height">
      <table md-table style="margin:8px 16px; width:calc(100% - 32px)">
        <thead>
          <tr>
            <th class="mdl-data-table__cell--non-numeric">Authorized</th>
            <th class="mdl-data-table__cell--non-numeric">
              <md-select
                value.bind="type"
                options.bind="['From', 'To']"
                style="width:50px; font-weight:bold; margin-bottom:-26px">
              </md-select>
            </th>
            <th class="mdl-data-table__cell--non-numeric">License</th>
            <th class="mdl-data-table__cell--non-numeric">Joined</th>
            <th class="mdl-data-table__cell--non-numeric">Location</th>
          </tr>
        </thead>
        <tr repeat.for="account of accounts" if.bind="account != $parent.account">
          <td class="mdl-data-table__cell--non-numeric">
            <md-checkbox
              if.bind="type != 'To'"
              checked.one-time="$parent.account.authorized.indexOf(account._id) != -1"
              click.delegate="authorize(account._id)">
            </md-checkbox>
            <md-checkbox
              if.bind="type == 'To'"
              checked.one-time="account.authorized.indexOf($parent.account._id) != -1"
              disabled.bind="true">
            </md-checkbox>
          </td>
          <td class="mdl-data-table__cell--non-numeric">${ account.name }</td>
          <td class="mdl-data-table__cell--non-numeric">${ account.license }</td>
          <td class="mdl-data-table__cell--non-numeric">${ account.createdAt | date }</td>
          <td class="mdl-data-table__cell--non-numeric">${ account.city+', '+account.state }</td>
        </tr>
      </table>
    </div>
  </section>
  <md-snackbar ref="snackbar"></md-snackbar>
</template>
