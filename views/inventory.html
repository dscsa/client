<template>
  <require from='elems/md-shadow'></require>
  <require from='elems/md-drawer'></require>
  <require from='elems/md-table'></require>
  <require from="elems/md-input"></require>
  <require from="elems/md-select"></require>
  <require from="elems/md-button"></require>
  <require from="elems/md-switch"></require>
  <require from="elems/md-snackbar"></require>
  <md-drawer>
    <md-input value.bind="filter" style="padding:0 8px;">Filter Inventory</md-input>
  </md-drawer>
  <section class="mdl-grid au-animate">
    <div md-shadow="2" class="mdl-card mdl-cell mdl-cell--4-col full-height"> <!-- ${ !repack || 'background:rgba(0,88,123,.3)' } -->
      <div
        class="mdl-card__supporting-text"
        style="font-size:13px;">
        <div repeat.for="transaction of group.transactions" input.delegate="saveTransaction(transaction) & debounce:1000">
          <div style="display:inline-block; width:calc(100% - 90px)">
            <a if.bind="transaction.history[0].transaction._id" href.bind="'/#/records/'+transaction.history[0].transaction._id">${transaction.history[0].transaction._id}</a>
            ${ transaction.history[0].transaction._id ? '' : 'inventory' }
            <a if.bind="!mode" style="float:right">
              <i class="material-icons" style="font-size:18px; vertical-align:text-top; padding-right:5px">print</i>
            </a>
          </div>
          <span style="white-space:nowrap;">
            <md-input
              disabled.bind="mode"
              pattern="(0?[1-9]|1[012])/\d{2}"
              style="width:40px"
              value.bind="transaction.exp.from | date"
              placeholder="Exp">
            </md-input>
            <md-input
              if.bind=" ! mode"
              type="number"
              style="width:40px"
              value.bind="transaction.qty.from | number"
              input.trigger="sumGroup()"
              placeholder="Qty">
            </md-input>
            <md-input
              if.bind="mode"
              type="number"
              style="width:40px"
              value.bind="repack[$index]"
              input.delegate="sumRepack()"
              placeholder="Qty"
              max.bind="transaction.qty.from">
            </md-input>
          </span>
        </div>
        <img style="width:100%" if.bind="image" src.bind="image">
      </div>
      <div class="mdl-card__actions mdl-grid">
        <md-switch
          checked.bind="mode"
          click.delegate="toggleRepack()"
          style="flex:1; align-self:flex-end">
        </md-switch>
        <md-button
          color raised
          if.bind="mode"
          disabled.bind="group.transactions.length < 2"
          click.delegate="repackage()"
          style="width:140px">
          Repackage ${ repack.total }
        </md-button>
      </div>
    </div>
    <div md-shadow="2" class="mdl-card mdl-cell mdl-cell--8-col full-height"> <!-- ${ !repack || 'background:rgba(0,88,123,.3)' } -->
      <table md-table style="margin:8px 16px; width:calc(100% - 32px)">
        <thead>
          <tr>
            <th class="mdl-data-table__cell--non-numeric">Drug</th>
            <th class="mdl-data-table__cell--non-numeric">Ndc</th>
            <th>Items</th>
            <th>Qty</th>
          </tr>
        </thead>
        <tr repeat.for="group of groups | filter:filter" click.delegate="select(group)" class="${ $parent.group != group || 'is-selected'}">
          <td style="text-align:left; white-space: normal;" innerHTML.bind="group.transactions[0] | drugName:filter"></td>
          <td class="mdl-data-table__cell--non-numeric">
            ${ group.transactions[0].drug._id }
          </td>
          <td>${ group.transactions.length }</td>
          <td>${ group.total}</td>
        </tr>
      </table>
    </div>
    <md-snackbar ref="snackbar"></md-snackbar>
  </section>
</template>
